!function(e){function r(n){if(t[n])return t[n].exports;var o=t[n]={exports:{},id:n,loaded:!1};return e[n].call(o.exports,o,o.exports,r),o.loaded=!0,o.exports}var t={};return r.m=e,r.c=t,r.p="dist/",r(0)}([function(e,r,t){e.exports=t(1)},function(e,r,t){var n=t(2),o=t(20),i=t(21),s=function(e){if(!e||0===e.length)throw new i;this._sources=e};s.prototype={get:function(e){var r=this;return new o(function(t){var o={jsonGraph:{}};return n(r._sources,0,e,o,t)})},set:function(e){var r=this._sources[0];return r.set(e)},call:function(e,r,t,n){}},e.exports=s},function(e,r,t){var n=t(3),o={dispose:function(){}},i=t(4),s=t(5),a=s.optimizePathSets,f=s.collapse,u=10;e.exports=function c(e,r,t,s,p,l){var h=e[r],v=t;if(l=l||new n,r>1&&v&&v.length&&(v=a(s.jsonGraph,v,u),v.length&&(v=f(v))),!h||!v||0===v.length)return s.unhandledPaths=v,p.onNext(s),p.onCompleted(),l.currentDisposable=o,l;var d;return l.currentDisposable=h.get(v).subscribe(function(e){d=e},function(e){return l.disposed?void 0:((r>0||d)&&(d&&i(s,d),p.onNext(s)),Array.isArray(e)?void p.onError(e):void p.onError(v.map(function(r){return{path:r,value:e}})))},function(){if(!l.disposed){0===r?s={jsonGraph:d.jsonGraph}:i(s,d);var t=d.unhandledPaths;t&&t.length?c(e,r+1,t,s,p,l):(p.onNext(s),p.onCompleted())}}),l}},function(e,r){var t=function(e){this.disposed=!1,this.currentDisposable=e};t.prototype={dispose:function(){if(!this.disposed&&this.currentDisposable){this.disposed=!0;var e=this.currentDisposable;e.dispose?e.dispose():e()}}},e.exports=t},function(e,r){function t(e,r){n(e.jsonGraph,r.jsonGraph)}function n(e,r,t,o){if(r.$type||"object"!=typeof r||null===r)return void(t[o]=r);var i,s,a=Object.keys(r);for(i=0,s=a.length;s>i;++i){var f=a[i];e[f]||(e[f]={}),n(e[f],r[f],e,f)}}e.exports=t},function(e,r,t){e.exports={iterateKeySet:t(6),toTree:t(7),toTreeWithUnion:t(8),pathsComplementFromTree:t(9),pathsComplementFromLengthTree:t(11),hasIntersection:t(10),toPaths:t(12),collapse:t(13),optimizePathSets:t(14)}},function(e,r){function t(e,r){var t=r.from=e.from||0,n=r.to=e.to||"number"==typeof e.length&&r.from+e.length-1||0;r.rangeOffset=r.from,r.loaded=!0,t>n&&(r.empty=!0)}function n(e,r){r.done=!1;var t=r.isObject=!(!e||"object"!=typeof e);r.isArray=t&&o(e),r.arrayOffset=0}var o=Array.isArray;e.exports=function(e,r){if(void 0===r.isArray&&n(e,r),r.isArray){var o;do{r.loaded&&r.rangeOffset>r.to&&(++r.arrayOffset,r.loaded=!1);var i=r.arrayOffset,s=e.length;if(i>=s){r.done=!0;break}var a=e[r.arrayOffset],f=typeof a;if("object"===f){if(r.loaded||t(a,r),r.empty)continue;o=r.rangeOffset++}else++r.arrayOffset,o=a}while(void 0===o);return o}return r.isObject?(r.loaded||t(e,r),r.rangeOffset>r.to?void(r.done=!0):r.rangeOffset++):(r.done=!0,e)}},function(e,r,t){function n(e,r,t){var i,s=r[t],a={},f=t+1;i=o(s,a);do{var u=e[i];u||(f===r.length?e[i]=null:u=e[i]={}),f<r.length&&n(u,r,f),a.done||(i=o(s,a))}while(!a.done)}var o=t(6);Array.isArray;e.exports=function(e){return e.reduce(function(e,r){return n(e,r,0),e},{})}},function(e,r){},function(e,r,t){var n=t(10);e.exports=function(e,r){for(var t=[],o=-1,i=0,s=e.length;s>i;++i)n(r,e[i],0)||(t[++o]=e[i]);return t}},function(e,r,t){var n=t(6);e.exports=function o(e,r,t){for(var i=e,s=!0;s&&t<r.length;++t){var a=r[t],f=typeof a;if(a&&"object"===f){var u={},c=n(a,u),p=t+1;do{var l=i[c];s=void 0!==l,s&&(s=o(l,r,p)),c=n(a,u)}while(s&&!u.done);break}i=i[a],s=void 0!==i}return s}},function(e,r,t){var n=t(10);e.exports=function(e,r){for(var t=[],o=-1,i=0,s=e.length;s>i;++i){var a=e[i];n(r[a.length],a,0)||(t[++o]=a)}return t}},function(e,r){function t(e){return null!==e&&typeof e===p}function n(e,r,t){var o,i,s,c,p,l,h,v,d,g,y,b,x,m,j=f(String(r)),w=Object.create(null),O=[],A=-1,k=0,$=[],E=0;if(c=[],p=-1,t-1>r){for(l=a(e,c);++p<l;)o=c[p],i=n(e[o],r+1,t),s=i.code,w[s]?i=w[s]:(O[k++]=s,i=w[s]={keys:[],sets:i.sets}),j=f(j+o+s),u(o)&&i.keys.push(parseInt(o,10))||i.keys.push(o);for(;++A<k;)if(o=O[A],i=w[o],c=i.keys,l=c.length,l>0)for(h=i.sets,v=-1,d=h.length,x=c[0];++v<d;){for(g=h[v],y=-1,b=g.length,m=new Array(b+1),m[0]=l>1&&c||x;++y<b;)m[y+1]=g[y];$[E++]=m}}else for(l=a(e,c),l>1?$[E++]=[c]:$[E++]=c;++p<l;)j=f(j+c[p]);return{code:j,sets:$}}function o(e){for(var r=-1,t=e.length;++r<t;){var n=e[r];c(n)&&(e[r]=i(n))}return e}function i(e){for(var r=-1,t=e.length-1,n=t>0;++r<=t;){var o=e[r];if(!u(o)){n=!1;break}e[r]=parseInt(o,10)}if(n===!0){e.sort(s);var i=e[0],a=e[t];if(t>=a-i)return{from:i,to:a}}return e}function s(e,r){return e-r}function a(e,r,t){var n=0;for(var o in e)r[n++]=o;return n>1&&r.sort(t),n}function f(e){for(var r=5381,t=-1,n=e.length;++t<n;)r=(r<<5)+r+e.charCodeAt(t);return String(r)}function u(e){return!c(e)&&e-parseFloat(e)+1>=0}var c=Array.isArray,p="object";e.exports=function(e){var r,i=[],s=0;for(var a in e)if(u(a)&&t(r=e[a]))for(var f=n(r,0,parseInt(a,10)).sets,c=-1,p=f.length;++c<p;)i[s++]=o(f[c]);return i}},function(e,r,t){var n=t(12),o=t(7);e.exports=function(e){var r=e.reduce(function(e,r){var t=r.length;return e[t]||(e[t]=[]),e[t].push(r),e},{});return Object.keys(r).forEach(function(e){r[e]=o(r[e])}),n(r)}},function(e,r,t){function n(e,r,t,a,c,p,l){if(void 0===e)return void(c[c.length]=s(p,t,a));if(!(null===e||e.$type&&e.$type!==f||"object"!=typeof e||e.$type===f&&a===t.length)){var h=t[a],v="object"==typeof h,d=a+1,g=!1,y=h;v&&(g={},y=o(h,g));var b,x;do{b=e[y];var m=p.length;if(null!==y&&(p[m]=y),b&&b.$type===f&&d<t.length){var j=u(r,b.value,l);b=j[0],x=i(j[1])}else x=p;n(b,r,t,d,c,x,l),p.length=m,g&&!g.done&&(y=o(h,g))}while(g&&!g.done)}}var o=t(6),i=t(15),s=t(16),a=t(17),f=a.$ref,u=t(18);e.exports=function(e,r,t){var o=[];return r.forEach(function(r){n(e,e,r,0,o,[],t)}),o}},function(e,r){function t(e,r){for(var t=[],n=e.length,o=r||0;n>o;o++)t[o]=e[o];return t}e.exports=t},function(e,r){e.exports=function(e,r,t){var n,o,i,s=[];for(n=0,i=e.length;i>n;++n)s[n]=e[n];for(o=t||0,i=r.length;i>o;++o,++n)s[n]=r[o];return s}},function(e,r){e.exports={$ref:"ref",$atom:"atom",$error:"error"}},function(e,r,t){var n=t(15),o=t(17).$ref,i=t(19);e.exports=function(e,r,t){for(var s,a,f,u=e,c=r,p=-1,l=c.length,h=0;++p<l;){if(s=c[p],a=u[s],f=a&&a.$type,!a||f&&f!==o){u=a;break}if(f&&f===o&&l>p+1){var v=new Error(i.innerReferences);throw v.throwToNext=!0,v}if(p+1===l&&(f===o&&(p=-1,c=a.value,l=c.length,a=e,h++),h>t))throw new Error(i.circularReference);u=a}return[u,n(c)]}},function(e,r){e.exports={innerReferences:"References with inner references are not allowed.",circularReference:"There appears to be a circular reference, maximum reference following exceeded."}},function(e,r){function t(e){this._subscribe=e}var n=function(){},o={dispose:n};t.prototype.subscribe=function(e,r,t){var i=e;i&&"object"==typeof i||(i={onNext:e||n,onError:r||n,onCompleted:t||n});var s=this._subscribe(i);switch(typeof s){case"function":return{dispose:s};case"object":return s||o;default:return o}},e.exports=t},function(e,r){function t(){this.message=n,this.stack=(new Error).stack}var n="The DataSourceChainer requires at least one dataSource in its constructor.";t.prototype=new Error,t.message=n,e.exports=t}]);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vZmFsY29yLWRhdGFzb3VyY2UtY2hhaW5lci5qcyIsIndlYnBhY2s6Ly8vd2VicGFjay9ib290c3RyYXAgYWQ3Njk3YmQ4Njg1MmFkNjY1MWQiLCJ3ZWJwYWNrOi8vLy4vc3JjL2luZGV4LmpzIiwid2VicGFjazovLy8uL3NyYy9EYXRhU291cmNlQ2hhaW5lci5qcyIsIndlYnBhY2s6Ly8vLi9zcmMvZ2V0UmVxdWVzdEN5Y2xlLmpzIiwid2VicGFjazovLy8uL3NyYy9Bc3NpZ25hYmxlRGlzcG9zYWJsZS5qcyIsIndlYnBhY2s6Ly8vLi9zcmMvY2FjaGUvbWVyZ2VKU09OR3JhcGhFbnZlbG9wZXMuanMiLCJ3ZWJwYWNrOi8vLy4vfi9mYWxjb3ItcGF0aC11dGlscy9saWIvaW5kZXguanMiLCJ3ZWJwYWNrOi8vLy4vfi9mYWxjb3ItcGF0aC11dGlscy9saWIvaXRlcmF0ZUtleVNldC5qcyIsIndlYnBhY2s6Ly8vLi9+L2ZhbGNvci1wYXRoLXV0aWxzL2xpYi90b1RyZWUuanMiLCJ3ZWJwYWNrOi8vLy4vfi9mYWxjb3ItcGF0aC11dGlscy9saWIvcGF0aHNDb21wbGVtZW50RnJvbVRyZWUuanMiLCJ3ZWJwYWNrOi8vLy4vfi9mYWxjb3ItcGF0aC11dGlscy9saWIvaGFzSW50ZXJzZWN0aW9uLmpzIiwid2VicGFjazovLy8uL34vZmFsY29yLXBhdGgtdXRpbHMvbGliL3BhdGhzQ29tcGxlbWVudEZyb21MZW5ndGhUcmVlLmpzIiwid2VicGFjazovLy8uL34vZmFsY29yLXBhdGgtdXRpbHMvbGliL3RvUGF0aHMuanMiLCJ3ZWJwYWNrOi8vLy4vfi9mYWxjb3ItcGF0aC11dGlscy9saWIvY29sbGFwc2UuanMiLCJ3ZWJwYWNrOi8vLy4vfi9mYWxjb3ItcGF0aC11dGlscy9saWIvb3B0aW1pemVQYXRoU2V0cy5qcyIsIndlYnBhY2s6Ly8vLi9+L2ZhbGNvci1wYXRoLXV0aWxzL2xpYi9zdXBwb3J0L2Nsb25lQXJyYXkuanMiLCJ3ZWJwYWNrOi8vLy4vfi9mYWxjb3ItcGF0aC11dGlscy9saWIvc3VwcG9ydC9jYXRBbmRTbGljZS5qcyIsIndlYnBhY2s6Ly8vLi9+L2ZhbGNvci1wYXRoLXV0aWxzL2xpYi9zdXBwb3J0L3R5cGVzLmpzIiwid2VicGFjazovLy8uL34vZmFsY29yLXBhdGgtdXRpbHMvbGliL2ZvbGxvd1JlZmVyZW5jZS5qcyIsIndlYnBhY2s6Ly8vLi9+L2ZhbGNvci1wYXRoLXV0aWxzL2xpYi9lcnJvcnMvaW5kZXguanMiLCJ3ZWJwYWNrOi8vLy4vc3JjL1N1YnNjcmliYWJsZS5qcyIsIndlYnBhY2s6Ly8vLi9zcmMvZXJyb3JzL0F0TGVhc3RPbmVEYXRhU291cmNlRXJyb3IuanMiXSwibmFtZXMiOlsibW9kdWxlcyIsIl9fd2VicGFja19yZXF1aXJlX18iLCJtb2R1bGVJZCIsImluc3RhbGxlZE1vZHVsZXMiLCJleHBvcnRzIiwibW9kdWxlIiwiaWQiLCJsb2FkZWQiLCJjYWxsIiwibSIsImMiLCJwIiwiZ2V0UmVxdWVzdEN5Y2xlIiwiU3Vic2NyaWJhYmxlIiwiQXRMZWFzdE9uZURhdGFTb3VyY2VFcnJvciIsIkRhdGFTb3VyY2VDaGFpbmVyIiwic291cmNlcyIsImxlbmd0aCIsInRoaXMiLCJfc291cmNlcyIsInByb3RvdHlwZSIsImdldCIsInBhdGhzIiwic2VsZiIsIm9ic2VydmVyIiwic2VlZCIsImpzb25HcmFwaCIsInNldCIsInNvdXJjZSIsImNhbGxQYXRoIiwiYXJncyIsInN1ZmZpeGVzIiwiQXNzaWduYWJsZURpc3Bvc2FibGUiLCJFTVBUWV9ESVNQT1NBQkxFIiwiZGlzcG9zZSIsIm1lcmdlSlNPTkdyYXBoRW52ZWxvcGVzIiwicGF0aFV0aWxzIiwib3B0aW1pemVQYXRoU2V0cyIsImNvbGxhcHNlIiwiTUFYX1JFRkVSRU5DRVNfVE9fRk9MTE9XIiwic291cmNlSW5kZXgiLCJyZW1haW5pbmdQYXRoc0FyZyIsImRpc3Bvc2FibGUiLCJjdXJyZW50U291cmNlIiwicmVtYWluaW5nUGF0aHMiLCJ1bmhhbmRsZWRQYXRocyIsIm9uTmV4dCIsIm9uQ29tcGxldGVkIiwiY3VycmVudERpc3Bvc2FibGUiLCJqc29uR3JhcGhGcm9tU291cmNlIiwic3Vic2NyaWJlIiwianNvbkdyYXBoRW52ZWxvcCIsImRhdGFTb3VyY2VFcnJvciIsImRpc3Bvc2VkIiwiQXJyYXkiLCJpc0FycmF5Iiwib25FcnJvciIsIm1hcCIsInBhdGgiLCJ2YWx1ZSIsImRpc29zYWJsZUNhbGxiYWNrIiwianNvbkdyYXBoQ2FjaGUiLCJpbmNvbWluZ0pTT05HcmFwaEVudmVsb3BlIiwibWVyZ2VKU09OR3JhcGgiLCJqc29uR3JhcGhUb01lcmdlSW50byIsImNhY2hlVG9NZXJnZUZyb20iLCJmcm9tUGFyZW50Q2FjaGUiLCJmcm9tS2V5IiwiJHR5cGUiLCJpIiwibGVuIiwia2V5cyIsIk9iamVjdCIsImtleSIsIml0ZXJhdGVLZXlTZXQiLCJ0b1RyZWUiLCJ0b1RyZWVXaXRoVW5pb24iLCJwYXRoc0NvbXBsZW1lbnRGcm9tVHJlZSIsInBhdGhzQ29tcGxlbWVudEZyb21MZW5ndGhUcmVlIiwiaGFzSW50ZXJzZWN0aW9uIiwidG9QYXRocyIsImluaXRpYWxpemVSYW5nZSIsIm1lbW8iLCJmcm9tIiwidG8iLCJyYW5nZU9mZnNldCIsImVtcHR5IiwiaW5pdGlhbGl6ZU5vdGUiLCJub3RlIiwiZG9uZSIsImlzT2JqZWN0IiwiYXJyYXlPZmZzZXQiLCJrZXlTZXQiLCJ1bmRlZmluZWQiLCJuZXh0VmFsdWUiLCJpZHgiLCJlbCIsInR5cGUiLCJpbm5lclRvVHJlZSIsImRlcHRoIiwiaXRlcmF0b3JOb3RlIiwibmV4dERlcHRoIiwibmV4dCIsInJlZHVjZSIsImFjYyIsInRyZWUiLCJvdXQiLCJvdXRMZW5ndGgiLCJjdXJyZW50IiwiaW50ZXJzZWN0cyIsImtleVR5cGUiLCJpbm5lcktleSIsInR5cGVPZk9iamVjdCIsImNvbGxhcHNlUGF0aE1hcCIsInBhdGhtYXAiLCJzdWJQYXRoIiwic3ViQ29kZSIsInN1YktleXMiLCJzdWJLZXlzSW5kZXgiLCJzdWJLZXlzQ291bnQiLCJzdWJTZXRzIiwic3ViU2V0c0luZGV4Iiwic3ViU2V0c0NvdW50IiwicGF0aHNldCIsInBhdGhzZXRJbmRleCIsInBhdGhzZXRDb3VudCIsImZpcnN0U3ViS2V5IiwicGF0aHNldENsb25lIiwiY29kZSIsImdldEhhc2hDb2RlIiwiU3RyaW5nIiwic3VicyIsImNyZWF0ZSIsImNvZGVzIiwiY29kZXNJbmRleCIsImNvZGVzQ291bnQiLCJwYXRoc2V0cyIsInBhdGhzZXRzQ291bnQiLCJnZXRTb3J0ZWRLZXlzIiwic2V0cyIsImlzTnVtYmVyIiwicHVzaCIsInBhcnNlSW50IiwiY29sbGFwc2VQYXRoU2V0SW5kZXhlcyIsImtleXNldEluZGV4Iiwia2V5c2V0Q291bnQiLCJrZXlzZXQiLCJjb2xsYXBzZUluZGV4Iiwia2V5SW5kZXgiLCJrZXlDb3VudCIsImlzU3BhcnNlUmFuZ2UiLCJzb3J0Iiwic29ydExpc3RBc2NlbmRpbmciLCJhIiwiYiIsImluZGV4IiwiY291bnQiLCJjaGFyQ29kZUF0IiwidmFsIiwicGFyc2VGbG9hdCIsImxlbmd0aHMiLCJhbGxQYXRocyIsImFsbFBhdGhzTGVuZ3RoIiwicGF0aHNJbmRleCIsInBhdGhzQ291bnQiLCJjb2xsYXBzZU1hcCIsImZvckVhY2giLCJjb2xsYXBzZUtleSIsIm9wdGltaXplUGF0aFNldCIsImNhY2hlIiwiY2FjaGVSb290IiwicGF0aFNldCIsIm9wdGltaXplZFBhdGgiLCJtYXhSZWZGb2xsb3ciLCJjYXRBbmRTbGljZSIsIiRyZWYiLCJpc0tleVNldCIsIm5leHRPcHRpbWl6ZWQiLCJvcHRpbWl6ZWRQYXRoTGVuZ3RoIiwicmVmUmVzdWx0cyIsImZvbGxvd1JlZmVyZW5jZSIsImNsb25lQXJyYXkiLCIkdHlwZXMiLCJvcHRpbWl6ZWQiLCJhcnIiLCJzbGljZSIsImoiLCIkYXRvbSIsIiRlcnJvciIsImVycm9ycyIsInJlZiIsInJlZlBhdGgiLCJyZWZlcmVuY2VDb3VudCIsImVyciIsIkVycm9yIiwiaW5uZXJSZWZlcmVuY2VzIiwidGhyb3dUb05leHQiLCJjaXJjdWxhclJlZmVyZW5jZSIsIl9zdWJzY3JpYmUiLCJub09wIiwiZW1wdHlEaXNwb3NhYmxlIiwic3Vic2NyaXB0aW9uIiwibWVzc2FnZSIsIk1FU1NBR0UiLCJzdGFjayJdLCJtYXBwaW5ncyI6IkNBQVMsU0FBVUEsR0NJbkIsUUFBQUMsR0FBQUMsR0FHQSxHQUFBQyxFQUFBRCxHQUNBLE1BQUFDLEdBQUFELEdBQUFFLE9BR0EsSUFBQUMsR0FBQUYsRUFBQUQsSUFDQUUsV0FDQUUsR0FBQUosRUFDQUssUUFBQSxFQVVBLE9BTkFQLEdBQUFFLEdBQUFNLEtBQUFILEVBQUFELFFBQUFDLElBQUFELFFBQUFILEdBR0FJLEVBQUFFLFFBQUEsRUFHQUYsRUFBQUQsUUF2QkEsR0FBQUQsS0FxQ0EsT0FUQUYsR0FBQVEsRUFBQVQsRUFHQUMsRUFBQVMsRUFBQVAsRUFHQUYsRUFBQVUsRUFBQSxRQUdBVixFQUFBLEtETU0sU0FBU0ksRUFBUUQsRUFBU0gsR0U1Q2hDSSxFQUFBRCxRQUFBSCxFQUFBLElGbURNLFNBQVNJLEVBQVFELEVBQVNILEdHbkRoQyxHQUFBVyxHQUFBWCxFQUFBLEdBQ0FZLEVBQUFaLEVBQUEsSUFDQWEsRUFBQWIsRUFBQSxJQWdCQWMsRUFBQSxTQUFBQyxHQUVBLElBQUFBLEdBQUEsSUFBQUEsRUFBQUMsT0FDQSxTQUFBSCxFQUVBSSxNQUFBQyxTQUFBSCxFQUdBRCxHQUFBSyxXQVlBQyxJQUFBLFNBQUFDLEdBQ0EsR0FBQUMsR0FBQUwsSUFDQSxXQUFBTCxHQUFBLFNBQUFXLEdBQ0EsR0FBQUMsSUFDQUMsYUFJQSxPQUFBZCxHQUFBVyxFQUFBSixTQUFBLEVBQ0FHLEVBQUFHLEVBQUFELE1BU0FHLElBQUEsU0FBQUQsR0FDQSxHQUFBRSxHQUFBVixLQUFBQyxTQUFBLEVBQ0EsT0FBQVMsR0FBQUQsSUFBQUQsSUFHQWxCLEtBQUEsU0FBQXFCLEVBQUFDLEVBQUFDLEVBQUFULE1BSUFqQixFQUFBRCxRQUFBVyxHSDBETSxTQUFTVixFQUFRRCxFQUFTSCxHSTNI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QXFCLE9BQUFMLEVBQUFRLGtCQUdBekYsR0FBQU4sRUFHQSxPQUFBTSxFQUFBeUUsRUFBQVUsTW5COGhDTSxTQUFTMUwsRUFBUUQsR29CbmxDdkJDLEVBQUFELFNBQ0ErTCxnQkFBQSxvREFDQUUsa0JBQUEsb0ZwQjZsQ00sU0FBU2hNLEVBQVFELEdxQnhsQ3ZCLFFBQUFTLEdBQUFxQyxHQUNBaEMsS0FBQW9MLFdBQUFwSixFQVRBLEdBQUFxSixHQUFBLGFBQ0FDLEdBQXVCdEssUUFBQXFLLEVBV3ZCMUwsR0FBQU8sVUFBQThCLFVBQUEsU0FBQXVHLEVBQUFDLEVBQUFoSixHQUNBLEdBQUFjLEdBQUFpSSxDQUNBakksSUFBQSxnQkFBQUEsS0FDQUEsR0FDQXNCLE9BQUEyRyxHQUFBOEMsRUFDQS9JLFFBQUFrRyxHQUFBNkMsRUFDQXhKLFlBQUFyQyxHQUFBNkwsR0FHQSxJQUFBRSxHQUFBdkwsS0FBQW9MLFdBQUE5SyxFQUVBLGNBQUFpTCxJQUNBLGVBQ0EsT0FBb0J2SyxRQUFBdUssRUFDcEIsY0FDQSxNQUFBQSxJQUFBRCxDQUNBLFNBQ0EsTUFBQUEsS0FJQW5NLEVBQUFELFFBQUFTLEdyQndtQ00sU0FBU1IsRUFBUUQsR3NCbG9DdkIsUUFBQVUsS0FDQUksS0FBQXdMLFFBQUFDLEVBQ0F6TCxLQUFBMEwsT0FBQSxHQUFBVixRQUFBVSxNQVRBLEdBQUFELEdBQUEsNEVBWUE3TCxHQUFBTSxVQUFBLEdBQUE4SyxPQUNBcEwsRUFBQTRMLFFBQUFDLEVBRUF0TSxFQUFBRCxRQUFBVSIsImZpbGUiOiJmYWxjb3ItZGF0YXNvdXJjZS1jaGFpbmVyLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLyoqKioqKi8gKGZ1bmN0aW9uKG1vZHVsZXMpIHsgLy8gd2VicGFja0Jvb3RzdHJhcFxuLyoqKioqKi8gXHQvLyBUaGUgbW9kdWxlIGNhY2hlXG4vKioqKioqLyBcdHZhciBpbnN0YWxsZWRNb2R1bGVzID0ge307XG4vKioqKioqL1xuLyoqKioqKi8gXHQvLyBUaGUgcmVxdWlyZSBmdW5jdGlvblxuLyoqKioqKi8gXHRmdW5jdGlvbiBfX3dlYnBhY2tfcmVxdWlyZV9fKG1vZHVsZUlkKSB7XG4vKioqKioqL1xuLyoqKioqKi8gXHRcdC8vIENoZWNrIGlmIG1vZHVsZSBpcyBpbiBjYWNoZVxuLyoqKioqKi8gXHRcdGlmKGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdKVxuLyoqKioqKi8gXHRcdFx0cmV0dXJuIGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdLmV4cG9ydHM7XG4vKioqKioqL1xuLyoqKioqKi8gXHRcdC8vIENyZWF0ZSBhIG5ldyBtb2R1bGUgKGFuZCBwdXQgaXQgaW50byB0aGUgY2FjaGUpXG4vKioqKioqLyBcdFx0dmFyIG1vZHVsZSA9IGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdID0ge1xuLyoqKioqKi8gXHRcdFx0ZXhwb3J0czoge30sXG4vKioqKioqLyBcdFx0XHRpZDogbW9kdWxlSWQsXG4vKioqKioqLyBcdFx0XHRsb2FkZWQ6IGZhbHNlXG4vKioqKioqLyBcdFx0fTtcbi8qKioqKiovXG4vKioqKioqLyBcdFx0Ly8gRXhlY3V0ZSB0aGUgbW9kdWxlIGZ1bmN0aW9uXG4vKioqKioqLyBcdFx0bW9kdWxlc1ttb2R1bGVJZF0uY2FsbChtb2R1bGUuZXhwb3J0cywgbW9kdWxlLCBtb2R1bGUuZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXyk7XG4vKioqKioqL1xuLyoqKioqKi8gXHRcdC8vIEZsYWcgdGhlIG1vZHVsZSBhcyBsb2FkZWRcbi8qKioqKiovIFx0XHRtb2R1bGUubG9hZGVkID0gdHJ1ZTtcbi8qKioqKiovXG4vKioqKioqLyBcdFx0Ly8gUmV0dXJuIHRoZSBleHBvcnRzIG9mIHRoZSBtb2R1bGVcbi8qKioqKiovIFx0XHRyZXR1cm4gbW9kdWxlLmV4cG9ydHM7XG4vKioqKioqLyBcdH1cbi8qKioqKiovXG4vKioqKioqL1xuLyoqKioqKi8gXHQvLyBleHBvc2UgdGhlIG1vZHVsZXMgb2JqZWN0IChfX3dlYnBhY2tfbW9kdWxlc19fKVxuLyoqKioqKi8gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLm0gPSBtb2R1bGVzO1xuLyoqKioqKi9cbi8qKioqKiovIFx0Ly8gZXhwb3NlIHRoZSBtb2R1bGUgY2FjaGVcbi8qKioqKiovIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5jID0gaW5zdGFsbGVkTW9kdWxlcztcbi8qKioqKiovXG4vKioqKioqLyBcdC8vIF9fd2VicGFja19wdWJsaWNfcGF0aF9fXG4vKioqKioqLyBcdF9fd2VicGFja19yZXF1aXJlX18ucCA9IFwiZGlzdC9cIjtcbi8qKioqKiovXG4vKioqKioqLyBcdC8vIExvYWQgZW50cnkgbW9kdWxlIGFuZCByZXR1cm4gZXhwb3J0c1xuLyoqKioqKi8gXHRyZXR1cm4gX193ZWJwYWNrX3JlcXVpcmVfXygwKTtcbi8qKioqKiovIH0pXG4vKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqL1xuLyoqKioqKi8gKFtcbi8qIDAgKi9cbi8qKiovIGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykge1xuXG5cdG1vZHVsZS5leHBvcnRzID0gX193ZWJwYWNrX3JlcXVpcmVfXygxKTtcblxuXG4vKioqLyB9LFxuLyogMSAqL1xuLyoqKi8gZnVuY3Rpb24obW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7XG5cblx0dmFyIGdldFJlcXVlc3RDeWNsZSA9IF9fd2VicGFja19yZXF1aXJlX18oMik7XG5cdHZhciBTdWJzY3JpYmFibGUgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDIwKTtcblx0dmFyIEF0TGVhc3RPbmVEYXRhU291cmNlRXJyb3IgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDIxKTtcblx0XG5cdC8qKlxuXHQgKiBEYXRhU291cmNlQ2hhaW5lciB0YWtlcyBpbiBhIGxpc3Qgb2YgZGF0YVNvdXJjZXMgYW5kIGNhbGxzIHRoZW0gb25lIGF0IGEgdGltZVxuXHQgKiB1bnRpbCB0aGUgZ2V0L3NldC9jYWxsIG9wZXJhdGlvbiBoYXMgYmVlbiBzYXRpc2lmaWVkLiAgSWYgdGhlIGxpc3Qgb2Ygc291cmNlc1xuXHQgKiBoYXZlIGJlZW4gZXhoYXVzdGVkLCB0aGVuIHRoZSBzb3VyY2Ugd2lsbCBlaXRoZXIgZW1pdCB0aGUgSlNPTkdyYXBoRW52ZWxvcGVcblx0ICogd2l0aCB1bmhhbmRsZWRQYXRocyBrZXkgb3IgZm9yd2FyZCBvbiAnZnVuY3Rpb24gZG9lcyBub3QgZXhpc3QnIGVycm9yIChjYWxsXG5cdCAqIG9ubHkpLlxuXHQgKlxuXHQgKiBUaGUgb3JkZXIgb2YgZGF0YVNvdXJjZSBjYWxsaW5nIGlzIGxpc3Qgb3JkZXJpbmcuIFRoZSBpbnRlcmZhY2UgY2FuIGJlIGZvdW5kXG5cdCAqIGhlcmU6IGh0dHA6Ly9uZXRmbGl4LmdpdGh1Yi5pby9mYWxjb3IvZG9jL0RhdGFTb3VyY2UuaHRtbFxuXHQgKlxuXHQgKiBAcGFyYW0ge0FycmF5LjxEYXRhU291cmNlPn0gc291cmNlcyAtIFRoZSBsaXN0IG9mIHNvdXJjZXMgdG8gY2FsbC5cblx0ICogQGF1Z21lbnRzIERhdGFTb3VyY2Vcblx0ICogQHB1YmxpY1xuXHQgKi9cblx0dmFyIERhdGFTb3VyY2VDaGFpbmVyID0gZnVuY3Rpb24gRGF0YVNvdXJjZUNoYWluZXIoc291cmNlcykge1xuXHQgICAgLy8gVGhlcmUgaGFzIHRvIGJlIGF0IGxlYXN0IG9uZSBkYXRhU291cmNlLlxuXHQgICAgaWYgKCFzb3VyY2VzIHx8IHNvdXJjZXMubGVuZ3RoID09PSAwKSB7XG5cdCAgICAgICAgdGhyb3cgbmV3IEF0TGVhc3RPbmVEYXRhU291cmNlRXJyb3IoKTtcblx0ICAgIH1cblx0ICAgIHRoaXMuX3NvdXJjZXMgPSBzb3VyY2VzO1xuXHR9O1xuXHRcblx0RGF0YVNvdXJjZUNoYWluZXIucHJvdG90eXBlID0ge1xuXHQgICAgLyoqXG5cdCAgICAgKiBBIGdldCByZXNwb25zZSBpcyBjb25zaWRlcmVkIF9jb21wbGV0ZWRfIGJhc2VkIG9uIHRoZSBmb2xsb3dpbmcgdGhyZWVcblx0ICAgICAqIGNvbmRpdGlvbnM6XG5cdCAgICAgKiAtIFRoZSB1bmhhbmRsZWRQYXRocyBrZXkgaXMgZW1wdHkgb3Igbm9uLWV4aXN0ZW50LlxuXHQgICAgICogLSBUaGUgY2hhaW4gb2YgZGF0YVNvdXJjZXMgaGF2ZSBiZWVuIGV4aGF1c3RlZC5cblx0ICAgICAqIC0gVGhlcmUgd2FzIGFuIGBvbkVycm9yYCBmcm9tIHRoZSBkYXRhU291cmNlLiAgV2Ugbm8gbG9uZ2VyIGhhdmUgdGhlXG5cdCAgICAgKiAgIGNvbnRleHQgZm9yIGNoYWluaW5nLiAgQW4gb25FcnJvciBmcm9tIGEgZGF0YVNvdXJjZSBpcyBhIGNhdGFzdHJvcGhpY1xuXHQgICAgICogICBlcnJvciwgbm90IGFuIGVycm9yIHdpdGhpbiB0aGUgZGF0YVNvdXJjZSdzIGpzb25HcmFwaEVudmVsb3BlXG5cdCAgICAgKiAgIChpbWFnaW5lIGEgNTAwIGZyb20gdGhlIEh0dHBEYXRhU291cmNlKS5cblx0ICAgICAqIEBwYXJhbSB7QXJyYXkuPFBhdGg+fSBwYXRocyAtXG5cdCAgICAgKi9cblx0ICAgIGdldDogZnVuY3Rpb24gZ2V0KHBhdGhzKSB7XG5cdCAgICAgICAgdmFyIHNlbGYgPSB0aGlzO1xuXHQgICAgICAgIHJldHVybiBuZXcgU3Vic2NyaWJhYmxlKGZ1bmN0aW9uIGdldFN1YnNjcmliZShvYnNlcnZlcikge1xuXHQgICAgICAgICAgICB2YXIgc2VlZCA9IHtcblx0ICAgICAgICAgICAgICAgIGpzb25HcmFwaDoge31cblx0ICAgICAgICAgICAgfTtcblx0XG5cdCAgICAgICAgICAgIC8vIFBlcmZvcm1zIHRoZSBpbnRlcm5hbCBnZXQgcmVxdWVzdCBsb29wLlxuXHQgICAgICAgICAgICByZXR1cm4gZ2V0UmVxdWVzdEN5Y2xlKHNlbGYuX3NvdXJjZXMsIDAsXG5cdCAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGF0aHMsIHNlZWQsIG9ic2VydmVyKTtcblx0ICAgICAgICB9KTtcblx0ICAgIH0sXG5cdFxuXHQgICAgLyoqXG5cdCAgICAgKiBTZXQgd2lsbCBzaW1wbHkgcGFzcyB0aHJvdWdoIHRoZSBzZXQgY29tbWFuZCB0byB0aGUgZmlyc3QgZGF0YVNvdXJjZVxuXHQgICAgICogaW4gdGhlIGNoYWluLlxuXHQgICAgICogQHBhcmFtIHtKU09OR3JhcGhFbnZlbG9wZX0ganNvbkdyYXBoIC1cblx0ICAgICAqL1xuXHQgICAgc2V0OiBmdW5jdGlvbiBzZXQoanNvbkdyYXBoKSB7XG5cdCAgICAgICAgdmFyIHNvdXJjZSA9IHRoaXMuX3NvdXJjZXNbMF07XG5cdCAgICAgICAgcmV0dXJuIHNvdXJjZS5zZXQoanNvbkdyYXBoKTtcblx0ICAgIH0sXG5cdFxuXHQgICAgY2FsbDogZnVuY3Rpb24gY2FsbChjYWxsUGF0aCwgYXJncywgc3VmZml4ZXMsIHBhdGhzKSB7XG5cdCAgICB9XG5cdH07XG5cdFxuXHRtb2R1bGUuZXhwb3J0cyA9IERhdGFTb3VyY2VDaGFpbmVyO1xuXG5cbi8qKiovIH0sXG4vKiAyICovXG4vKioqLyBmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHtcblxuXHR2YXIgQXNzaWduYWJsZURpc3Bvc2FibGUgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDMpO1xuXHR2YXIgRU1QVFlfRElTUE9TQUJMRSA9IHtkaXNwb3NlOiBmdW5jdGlvbiBlbXB0eSgpIHt9fTtcblx0dmFyIG1lcmdlSlNPTkdyYXBoRW52ZWxvcGVzID0gX193ZWJwYWNrX3JlcXVpcmVfXyg0KTtcblx0dmFyIHBhdGhVdGlscyA9IF9fd2VicGFja19yZXF1aXJlX18oNSk7XG5cdHZhciBvcHRpbWl6ZVBhdGhTZXRzID0gcGF0aFV0aWxzLm9wdGltaXplUGF0aFNldHM7XG5cdHZhciBjb2xsYXBzZSA9IHBhdGhVdGlscy5jb2xsYXBzZTtcblx0dmFyIE1BWF9SRUZFUkVOQ0VTX1RPX0ZPTExPVyA9IDEwO1xuXHRcblx0LyoqXG5cdCAqIFBlcmZvcm1zIHRoZSByZXF1ZXN0aW5nIG9mIHRoZSBkYXRhIGZyb20gZWFjaCBkYXRhU291cmNlIHVudGlsIGV4aGF1c3RlZFxuXHQgKiBvciBjb21wbGV0ZWQuXG5cdCAqIEBwcml2YXRlXG5cdCAqL1xuXHQvLyBUT0RPOiBDbGVhbiB1cCB0aGlzIGZ1bmN0aW9uIGFzIGl0cyB2ZXJ5IGxhcmdlLlxuXHRtb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uIGdldFJlcXVlc3RDeWNsZShzb3VyY2VzLCBzb3VyY2VJbmRleCxcblx0ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVtYWluaW5nUGF0aHNBcmcsIHNlZWQsXG5cdCAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9ic2VydmVyLCBkaXNwb3NhYmxlKSB7XG5cdFxuXHQgICAgdmFyIGN1cnJlbnRTb3VyY2UgPSBzb3VyY2VzW3NvdXJjZUluZGV4XTtcblx0ICAgIHZhciByZW1haW5pbmdQYXRocyA9IHJlbWFpbmluZ1BhdGhzQXJnO1xuXHQgICAgZGlzcG9zYWJsZSA9IGRpc3Bvc2FibGUgfHwgbmV3IEFzc2lnbmFibGVEaXNwb3NhYmxlKCk7XG5cdFxuXHQgICAgLy8gSWYgdGhlIHNvdXJjZSBpbmRleCBpcyBncmVhdGVyIHRoYW4gMSB0aGVuIHdlIG5lZWQgdG8gYXR0ZW1wdCB0b1xuXHQgICAgLy8gb3B0aW1pemUgLyByZWR1Y2UgcmVtYWluaW5nIHBhdGhzIHdpdGggb3VyIHBhcnRpYWxseSBjb21wbGV0ZSBjYWNoZS5cblx0ICAgIGlmIChzb3VyY2VJbmRleCA+IDEgJiYgcmVtYWluaW5nUGF0aHMgJiYgcmVtYWluaW5nUGF0aHMubGVuZ3RoKSB7XG5cdCAgICAgICAgcmVtYWluaW5nUGF0aHMgPSBvcHRpbWl6ZVBhdGhTZXRzKHNlZWQuanNvbkdyYXBoLCByZW1haW5pbmdQYXRocyxcblx0ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgTUFYX1JFRkVSRU5DRVNfVE9fRk9MTE9XKTtcblx0ICAgICAgICBpZiAocmVtYWluaW5nUGF0aHMubGVuZ3RoKSB7XG5cdCAgICAgICAgICAgIHJlbWFpbmluZ1BhdGhzID0gY29sbGFwc2UocmVtYWluaW5nUGF0aHMpO1xuXHQgICAgICAgIH1cblx0ICAgIH1cblx0XG5cdCAgICAvLyBTb3VyY2VzIG9yIHJlbWFpbmluZyBwYXRocyBoYXZlIGJlZW4gZXhoYXVzdGVkLiAgVGltZSB0byBvbk5leHQgL1xuXHQgICAgLy8gb25Db21wbGV0ZVxuXHQgICAgaWYgKCFjdXJyZW50U291cmNlIHx8ICFyZW1haW5pbmdQYXRocyB8fCByZW1haW5pbmdQYXRocy5sZW5ndGggPT09IDApIHtcblx0ICAgICAgICBzZWVkLnVuaGFuZGxlZFBhdGhzID0gcmVtYWluaW5nUGF0aHM7XG5cdCAgICAgICAgb2JzZXJ2ZXIub25OZXh0KHNlZWQpO1xuXHQgICAgICAgIG9ic2VydmVyLm9uQ29tcGxldGVkKCk7XG5cdCAgICAgICAgZGlzcG9zYWJsZS5jdXJyZW50RGlzcG9zYWJsZSA9IEVNUFRZX0RJU1BPU0FCTEU7XG5cdCAgICAgICAgcmV0dXJuIGRpc3Bvc2FibGU7XG5cdCAgICB9XG5cdFxuXHQgICAgLy8gUmVxdWVzdCBmcm9tIHRoZSBjdXJyZW50IHNvdXJjZS5cblx0ICAgIHZhciBqc29uR3JhcGhGcm9tU291cmNlO1xuXHQgICAgZGlzcG9zYWJsZS5jdXJyZW50RGlzcG9zYWJsZSA9IGN1cnJlbnRTb3VyY2UuXG5cdCAgICAgICAgZ2V0KHJlbWFpbmluZ1BhdGhzKS5cblx0ICAgICAgICBzdWJzY3JpYmUoXG5cdCAgICAgICAgICAgIC8vIEFuIG9uTmV4dCBzaW1wbHkganVzdCBob2xkcyBvbnRvIHRoZSB2YWx1ZSB0aGF0IHdhcyBnaXZlblxuXHQgICAgICAgICAgICAvLyBhbmQgd2lsbCBwZXJmb3JtIHRoZSBtZXJnaW5nIHdoZW4gY29tcGxldGUuXG5cdCAgICAgICAgICAgIGZ1bmN0aW9uIG9uTmV4dChqc29uR3JhcGhFbnZlbG9wKSB7XG5cdCAgICAgICAgICAgICAgICBqc29uR3JhcGhGcm9tU291cmNlID0ganNvbkdyYXBoRW52ZWxvcDtcblx0ICAgICAgICAgICAgfSxcblx0XG5cdCAgICAgICAgICAgIC8vIFRoaXMgaXMgdGhlIGNhc2Ugb2YgdGhlIGNhdGFzdHJvcGhpYyBlcnJvci4gIFdlIGFyZSBubyBsb25nZXJcblx0ICAgICAgICAgICAgLy8gYWJsZSB0byByZWN1cnNlIG9uIG91ciBkYXRhU291cmNlcy4gIElmIHRoZXJlIGFyZSByZW1haW5pbmdcblx0ICAgICAgICAgICAgLy8gdmFsdWVzIC8gaGF2ZSBiZWVuIG9uTmV4dCdkIHRoZW4gd2UgbmVlZCB0byBtZXJnZSBhbmQgcmVwb3J0XG5cdCAgICAgICAgICAgIC8vIHRoZW4gb25FcnJvci5cblx0ICAgICAgICAgICAgZnVuY3Rpb24gb25FcnJvcihkYXRhU291cmNlRXJyb3IpIHtcblx0ICAgICAgICAgICAgICAgIC8vIEV4aXQgY29uZGl0aW9uLlxuXHQgICAgICAgICAgICAgICAgaWYgKGRpc3Bvc2FibGUuZGlzcG9zZWQpIHtcblx0ICAgICAgICAgICAgICAgICAgICByZXR1cm47XG5cdCAgICAgICAgICAgICAgICB9XG5cdFxuXHQgICAgICAgICAgICAgICAgLy8gTWVyZ2UgYW5kIG9uTmV4dCB0aGUgc2VlZCB2YWx1ZSB0byB0aGUgb2JzZXJ2ZXIuXG5cdCAgICAgICAgICAgICAgICBpZiAoc291cmNlSW5kZXggPiAwIHx8IGpzb25HcmFwaEZyb21Tb3VyY2UpIHtcblx0ICAgICAgICAgICAgICAgICAgICBpZiAoanNvbkdyYXBoRnJvbVNvdXJjZSkge1xuXHQgICAgICAgICAgICAgICAgICAgICAgICBtZXJnZUpTT05HcmFwaEVudmVsb3BlcyhzZWVkLCBqc29uR3JhcGhGcm9tU291cmNlKTtcblx0ICAgICAgICAgICAgICAgICAgICB9XG5cdCAgICAgICAgICAgICAgICAgICAgb2JzZXJ2ZXIub25OZXh0KHNlZWQpO1xuXHQgICAgICAgICAgICAgICAgfVxuXHRcblx0ICAgICAgICAgICAgICAgIC8vIEFzc3VtZXMgdGhhdCB0aGUgYXJyYXkgaXMgYW4gYXJyYXkgb2YgcGF0aCB2YWx1ZXMuXG5cdCAgICAgICAgICAgICAgICBpZiAoQXJyYXkuaXNBcnJheShkYXRhU291cmNlRXJyb3IpKSB7XG5cdCAgICAgICAgICAgICAgICAgICAgb2JzZXJ2ZXIub25FcnJvcihkYXRhU291cmNlRXJyb3IpO1xuXHQgICAgICAgICAgICAgICAgICAgIHJldHVybjtcblx0ICAgICAgICAgICAgICAgIH1cblx0XG5cdCAgICAgICAgICAgICAgICBvYnNlcnZlci5vbkVycm9yKHJlbWFpbmluZ1BhdGhzLm1hcChmdW5jdGlvbiB0b1BWKHBhdGgpIHtcblx0ICAgICAgICAgICAgICAgICAgICByZXR1cm4ge1xuXHQgICAgICAgICAgICAgICAgICAgICAgICBwYXRoOiBwYXRoLFxuXHQgICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZTogZGF0YVNvdXJjZUVycm9yXG5cdCAgICAgICAgICAgICAgICAgICAgfTtcblx0ICAgICAgICAgICAgICAgIH0pKTtcblx0ICAgICAgICAgICAgfSxcblx0XG5cdCAgICAgICAgICAgIC8vIFdlIGhhdmUgY29tcGxldGVkIHN1Y2Nlc3NmdWxseS4gIFdoYXRldmVyIGhhcyBiZWVuIG9uTmV4dCBzaG91bGRcblx0ICAgICAgICAgICAgLy8gYmUgbWVyZ2VkIGludG8gdGhlIGVudmVsb3BlLiAgSWYgdGhlcmUgYXJlIHVuaGFuZGxlZFBhdGhzIHRoZW5cblx0ICAgICAgICAgICAgLy8gd2UgbmVlZCB0byByZWN1cnNlLCBlbHNlIG9uTmV4dCAvIG9uQ29tcGxldGVkLlxuXHQgICAgICAgICAgICBmdW5jdGlvbiBvbkNvbXBsZXRlZCgpIHtcblx0ICAgICAgICAgICAgICAgIC8vIEV4aXQgY29uZGl0aW9uLlxuXHQgICAgICAgICAgICAgICAgaWYgKGRpc3Bvc2FibGUuZGlzcG9zZWQpIHtcblx0ICAgICAgICAgICAgICAgICAgICByZXR1cm47XG5cdCAgICAgICAgICAgICAgICB9XG5cdFxuXHQgICAgICAgICAgICAgICAgLy8gV2UgbmVlZCB0byBtZXJnZSB0aGUgcmVzdWx0cyBpbnRvIG91ciBzZWVkLCBpZiB0aGUgc291cmNlXG5cdCAgICAgICAgICAgICAgICAvLyBpcyB0aGUgc2Vjb25kIG9yIGxhdGVyIHNvdXJjZS5cblx0ICAgICAgICAgICAgICAgIGlmIChzb3VyY2VJbmRleCA9PT0gMCkge1xuXHQgICAgICAgICAgICAgICAgICAgIHNlZWQgPSB7XG5cdCAgICAgICAgICAgICAgICAgICAgICAgIGpzb25HcmFwaDoganNvbkdyYXBoRnJvbVNvdXJjZS5qc29uR3JhcGhcblx0ICAgICAgICAgICAgICAgICAgICB9O1xuXHQgICAgICAgICAgICAgICAgfVxuXHRcblx0ICAgICAgICAgICAgICAgIGVsc2Uge1xuXHQgICAgICAgICAgICAgICAgICAgIG1lcmdlSlNPTkdyYXBoRW52ZWxvcGVzKHNlZWQsIGpzb25HcmFwaEZyb21Tb3VyY2UpO1xuXHQgICAgICAgICAgICAgICAgfVxuXHRcblx0ICAgICAgICAgICAgICAgIC8vIGFyZSB0aGVyZSB1bmhhbmRsZWRQYXRocz9cblx0ICAgICAgICAgICAgICAgIHZhciB1bmhhbmRsZWRQYXRocyA9IGpzb25HcmFwaEZyb21Tb3VyY2UudW5oYW5kbGVkUGF0aHM7XG5cdCAgICAgICAgICAgICAgICBpZiAodW5oYW5kbGVkUGF0aHMgJiYgdW5oYW5kbGVkUGF0aHMubGVuZ3RoKSB7XG5cdFxuXHQgICAgICAgICAgICAgICAgICAgIC8vIEFzeW5jIFJlcXVlc3QgUmVjdXJzaW9uLlxuXHQgICAgICAgICAgICAgICAgICAgIGdldFJlcXVlc3RDeWNsZShzb3VyY2VzLCBzb3VyY2VJbmRleCArIDEsIHVuaGFuZGxlZFBhdGhzLFxuXHQgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWVkLCBvYnNlcnZlciwgZGlzcG9zYWJsZSk7XG5cdCAgICAgICAgICAgICAgICB9XG5cdFxuXHQgICAgICAgICAgICAgICAgLy8gV2UgaGF2ZSBmaW5pc2hlZCBoZXJlLlxuXHQgICAgICAgICAgICAgICAgZWxzZSB7XG5cdCAgICAgICAgICAgICAgICAgICAgb2JzZXJ2ZXIub25OZXh0KHNlZWQpO1xuXHQgICAgICAgICAgICAgICAgICAgIG9ic2VydmVyLm9uQ29tcGxldGVkKCk7XG5cdCAgICAgICAgICAgICAgICB9XG5cdCAgICAgICAgICAgIH0pO1xuXHRcblx0XG5cdCAgICByZXR1cm4gZGlzcG9zYWJsZTtcblx0fTtcblxuXG4vKioqLyB9LFxuLyogMyAqL1xuLyoqKi8gZnVuY3Rpb24obW9kdWxlLCBleHBvcnRzKSB7XG5cblx0LyoqXG5cdCAqIFdpbGwgYWxsb3cgZm9yIHN0YXRlIHRyYWNraW5nIG9mIHRoZSBjdXJyZW50IGRpc3Bvc2FibGUuICBBbHNvIGZ1bGZpbGxzIHRoZVxuXHQgKiBkaXNwb3NhYmxlIGludGVyZmFjZS5cblx0ICogQHByaXZhdGVcblx0ICovXG5cdHZhciBBc3NpZ25hYmxlRGlzcG9zYWJsZSA9IGZ1bmN0aW9uIEFzc2lnbmFibGVEaXNwb3NhYmxlKGRpc29zYWJsZUNhbGxiYWNrKSB7XG5cdCAgICB0aGlzLmRpc3Bvc2VkID0gZmFsc2U7XG5cdCAgICB0aGlzLmN1cnJlbnREaXNwb3NhYmxlID0gZGlzb3NhYmxlQ2FsbGJhY2s7XG5cdH07XG5cdFxuXHRBc3NpZ25hYmxlRGlzcG9zYWJsZS5wcm90b3R5cGUgPSB7XG5cdFxuXHQgICAgLyoqXG5cdCAgICAgKiBEaXNwb3NlcyBvZiB0aGUgY3VycmVudCBkaXNwb3NhYmxlLiAgVGhpcyB3b3VsZCBiZSB0aGUgZ2V0UmVxdWVzdEN5Y2xlXG5cdCAgICAgKiBkaXNwb3NhYmxlLlxuXHQgICAgICovXG5cdCAgICBkaXNwb3NlOiBmdW5jdGlvbiBkaXNwb3NlKCkge1xuXHQgICAgICAgIGlmICh0aGlzLmRpc3Bvc2VkIHx8ICF0aGlzLmN1cnJlbnREaXNwb3NhYmxlKSB7XG5cdCAgICAgICAgICAgIHJldHVybjtcblx0ICAgICAgICB9XG5cdCAgICAgICAgdGhpcy5kaXNwb3NlZCA9IHRydWU7XG5cdFxuXHQgICAgICAgIC8vIElmIHRoZSBjdXJyZW50IGRpc3Bvc2FibGUgZnVsZmlsbHMgdGhlIGRpc3Bvc2FibGUgaW50ZXJmYWNlIG9yIGp1c3Rcblx0ICAgICAgICAvLyBhIGRpc3Bvc2FibGUgZnVuY3Rpb24uXG5cdCAgICAgICAgdmFyIGN1cnJlbnREaXNwb3NhYmxlID0gdGhpcy5jdXJyZW50RGlzcG9zYWJsZTtcblx0ICAgICAgICBpZiAoY3VycmVudERpc3Bvc2FibGUuZGlzcG9zZSkge1xuXHQgICAgICAgICAgICBjdXJyZW50RGlzcG9zYWJsZS5kaXNwb3NlKCk7XG5cdCAgICAgICAgfVxuXHRcblx0ICAgICAgICBlbHNlIHtcblx0ICAgICAgICAgICAgY3VycmVudERpc3Bvc2FibGUoKTtcblx0ICAgICAgICB9XG5cdCAgICB9XG5cdH07XG5cdFxuXHRtb2R1bGUuZXhwb3J0cyA9IEFzc2lnbmFibGVEaXNwb3NhYmxlO1xuXHRcblxuXG4vKioqLyB9LFxuLyogNCAqL1xuLyoqKi8gZnVuY3Rpb24obW9kdWxlLCBleHBvcnRzKSB7XG5cblx0Ly8gTWVyZ2VzIHRoZSBqc29uR3JhcGhFbnZlbG9wZXMuXG5cdGZ1bmN0aW9uIG1lcmdlSlNPTkdyYXBoRW52ZWxvcGVzKGpzb25HcmFwaENhY2hlLCBpbmNvbWluZ0pTT05HcmFwaEVudmVsb3BlKSB7XG5cdCAgICBtZXJnZUpTT05HcmFwaChqc29uR3JhcGhDYWNoZS5qc29uR3JhcGgsXG5cdCAgICAgICAgICAgICAgICAgICBpbmNvbWluZ0pTT05HcmFwaEVudmVsb3BlLmpzb25HcmFwaCk7XG5cdFxuXHQgICAgLy8gTk9URTogTm8gbmVlZCB0byBjb3B5IHBhdGhzIGJlY2F1c2UgXCJwYXRoc1wiIGRvIG5vdCBuZWVkIHRvIGV4aXN0IG9uXG5cdCAgICAvLyBkYXRhU291cmNlIHJlc3BvbnNlcy5cblx0fVxuXHRcblx0ZnVuY3Rpb24gbWVyZ2VKU09OR3JhcGgoanNvbkdyYXBoVG9NZXJnZUludG8sIGNhY2hlVG9NZXJnZUZyb20sXG5cdCAgICAgICAgICAgICAgICAgICBmcm9tUGFyZW50Q2FjaGUsIGZyb21LZXkpIHtcblx0XG5cdFxuXHQgICAgLy8gVGhlIGJhc2UgY2FzZSBpcyB3aGVuIHRoZSBjdXJyZW50IGNhY2hlIHBvc2l0aW9uIGlzIGEgbGVhZiBub2RlLiAgV2hpY2hcblx0ICAgIC8vIGlzIGEgbm9uIG9iamVjdCAvIG51bGwgb3IgdGhlcmUgaXMgYSAkdHlwZSBrZXkuXG5cdCAgICBpZiAoY2FjaGVUb01lcmdlRnJvbS4kdHlwZSB8fFxuXHQgICAgICAgIHR5cGVvZiBjYWNoZVRvTWVyZ2VGcm9tICE9PSAnb2JqZWN0JyB8fFxuXHQgICAgICAgIGNhY2hlVG9NZXJnZUZyb20gPT09IG51bGwpIHtcblx0XG5cdCAgICAgICAgZnJvbVBhcmVudENhY2hlW2Zyb21LZXldID0gY2FjaGVUb01lcmdlRnJvbTtcblx0ICAgICAgICByZXR1cm47XG5cdCAgICB9XG5cdFxuXHRcblx0ICAgIC8vIEluZHVjdGl2ZSBjYXNlOiBpdGVyYXRlIG9uIGFsbCB0aGUga2V5cyBhbmQgcGVyZm9ybSBhIHNpbXBsZSBtZXJnZS5cblx0ICAgIHZhciBrZXlzID0gT2JqZWN0LmtleXMoY2FjaGVUb01lcmdlRnJvbSk7XG5cdCAgICB2YXIgaSwgbGVuO1xuXHRcblx0ICAgIGZvciAoaSA9IDAsIGxlbiA9IGtleXMubGVuZ3RoOyBpIDwgbGVuOyArK2kpIHtcblx0ICAgICAgICB2YXIga2V5ID0ga2V5c1tpXTtcblx0ICAgICAgICBpZiAoIWpzb25HcmFwaFRvTWVyZ2VJbnRvW2tleV0pIHtcblx0ICAgICAgICAgICAganNvbkdyYXBoVG9NZXJnZUludG9ba2V5XSA9IHt9O1xuXHQgICAgICAgIH1cblx0XG5cdCAgICAgICAgbWVyZ2VKU09OR3JhcGgoanNvbkdyYXBoVG9NZXJnZUludG9ba2V5XSwgY2FjaGVUb01lcmdlRnJvbVtrZXldLFxuXHQgICAgICAgICAgICAgICAgICAgICAgIGpzb25HcmFwaFRvTWVyZ2VJbnRvLCBrZXkpO1xuXHQgICAgfVxuXHR9XG5cdFxuXHRtb2R1bGUuZXhwb3J0cyA9IG1lcmdlSlNPTkdyYXBoRW52ZWxvcGVzO1xuXG5cbi8qKiovIH0sXG4vKiA1ICovXG4vKioqLyBmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHtcblxuXHRtb2R1bGUuZXhwb3J0cyA9IHtcblx0ICAgIGl0ZXJhdGVLZXlTZXQ6IF9fd2VicGFja19yZXF1aXJlX18oNiksXG5cdCAgICB0b1RyZWU6IF9fd2VicGFja19yZXF1aXJlX18oNyksXG5cdCAgICB0b1RyZWVXaXRoVW5pb246IF9fd2VicGFja19yZXF1aXJlX18oOCksXG5cdCAgICBwYXRoc0NvbXBsZW1lbnRGcm9tVHJlZTogX193ZWJwYWNrX3JlcXVpcmVfXyg5KSxcblx0ICAgIHBhdGhzQ29tcGxlbWVudEZyb21MZW5ndGhUcmVlOiBfX3dlYnBhY2tfcmVxdWlyZV9fKDExKSxcblx0ICAgIGhhc0ludGVyc2VjdGlvbjogX193ZWJwYWNrX3JlcXVpcmVfXygxMCksXG5cdCAgICB0b1BhdGhzOiBfX3dlYnBhY2tfcmVxdWlyZV9fKDEyKSxcblx0ICAgIGNvbGxhcHNlOiBfX3dlYnBhY2tfcmVxdWlyZV9fKDEzKSxcblx0ICAgIG9wdGltaXplUGF0aFNldHM6IF9fd2VicGFja19yZXF1aXJlX18oMTQpXG5cdH07XG5cblxuLyoqKi8gfSxcbi8qIDYgKi9cbi8qKiovIGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cykge1xuXG5cdHZhciBpc0FycmF5ID0gQXJyYXkuaXNBcnJheTtcblx0XG5cdC8qKlxuXHQgKiBUYWtlcyBpbiBhIGtleVNldCBhbmQgYSBub3RlIGF0dGVtcHRzIHRvIGl0ZXJhdGUgb3ZlciBpdC5cblx0ICogSWYgdGhlIHZhbHVlIGlzIGEgcHJpbWl0aXZlLCB0aGUga2V5IHdpbGwgYmUgcmV0dXJuZWQgYW5kIHRoZSBub3RlIHdpbGxcblx0ICogYmUgbWFya2VkIGRvbmVcblx0ICogSWYgdGhlIHZhbHVlIGlzIGFuIG9iamVjdCwgdGhlbiBlYWNoIHZhbHVlIG9mIHRoZSByYW5nZSB3aWxsIGJlIHJldHVybmVkXG5cdCAqIGFuZCB3aGVuIGZpbmlzaGVkIHRoZSBub3RlIHdpbGwgYmUgbWFya2VkIGRvbmUuXG5cdCAqIElmIHRoZSB2YWx1ZSBpcyBhbiBhcnJheSwgZWFjaCB2YWx1ZSB3aWxsIGJlIGl0ZXJhdGVkIG92ZXIsIGlmIGFueSBvZiB0aGVcblx0ICogaW5uZXIgdmFsdWVzIGFyZSByYW5nZXMsIHRob3NlIHdpbGwgYmUgaXRlcmF0ZWQgb3Zlci4gIFdoZW4gZnVsbHkgZG9uZSxcblx0ICogdGhlIG5vdGUgd2lsbCBiZSBtYXJrZWQgZG9uZS5cblx0ICpcblx0ICogQHBhcmFtIHtPYmplY3R8QXJyYXl8U3RyaW5nfE51bWJlcn0ga2V5U2V0IC1cblx0ICogQHBhcmFtIHtPYmplY3R9IG5vdGUgLSBUaGUgbm9uIGZpbGxlZCBub3RlXG5cdCAqIEByZXR1cm5zIHtTdHJpbmd8TnVtYmVyfHVuZGVmaW5lZH0gLSBUaGUgY3VycmVudCBpdGVyYXRpb24gdmFsdWUuXG5cdCAqIElmIHVuZGVmaW5lZCwgdGhlbiB0aGUga2V5U2V0IGlzIGVtcHR5XG5cdCAqIEBwdWJsaWNcblx0ICovXG5cdG1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24gaXRlcmF0ZUtleVNldChrZXlTZXQsIG5vdGUpIHtcblx0ICAgIGlmIChub3RlLmlzQXJyYXkgPT09IHVuZGVmaW5lZCkge1xuXHQgICAgICAgIGluaXRpYWxpemVOb3RlKGtleVNldCwgbm90ZSk7XG5cdCAgICB9XG5cdFxuXHQgICAgLy8gQXJyYXkgaXRlcmF0aW9uXG5cdCAgICBpZiAobm90ZS5pc0FycmF5KSB7XG5cdCAgICAgICAgdmFyIG5leHRWYWx1ZTtcblx0XG5cdCAgICAgICAgLy8gQ3ljbGUgdGhyb3VnaCB0aGUgYXJyYXkgYW5kIHBsdWNrIG91dCB0aGUgbmV4dCB2YWx1ZS5cblx0ICAgICAgICBkbyB7XG5cdCAgICAgICAgICAgIGlmIChub3RlLmxvYWRlZCAmJiBub3RlLnJhbmdlT2Zmc2V0ID4gbm90ZS50bykge1xuXHQgICAgICAgICAgICAgICAgKytub3RlLmFycmF5T2Zmc2V0O1xuXHQgICAgICAgICAgICAgICAgbm90ZS5sb2FkZWQgPSBmYWxzZTtcblx0ICAgICAgICAgICAgfVxuXHRcblx0ICAgICAgICAgICAgdmFyIGlkeCA9IG5vdGUuYXJyYXlPZmZzZXQsIGxlbmd0aCA9IGtleVNldC5sZW5ndGg7XG5cdCAgICAgICAgICAgIGlmIChpZHggPj0gbGVuZ3RoKSB7XG5cdCAgICAgICAgICAgICAgICBub3RlLmRvbmUgPSB0cnVlO1xuXHQgICAgICAgICAgICAgICAgYnJlYWs7XG5cdCAgICAgICAgICAgIH1cblx0XG5cdCAgICAgICAgICAgIHZhciBlbCA9IGtleVNldFtub3RlLmFycmF5T2Zmc2V0XTtcblx0ICAgICAgICAgICAgdmFyIHR5cGUgPSB0eXBlb2YgZWw7XG5cdFxuXHQgICAgICAgICAgICAvLyBJbm5lciByYW5nZSBpdGVyYXRpb24uXG5cdCAgICAgICAgICAgIGlmICh0eXBlID09PSAnb2JqZWN0Jykge1xuXHQgICAgICAgICAgICAgICAgaWYgKCFub3RlLmxvYWRlZCkge1xuXHQgICAgICAgICAgICAgICAgICAgIGluaXRpYWxpemVSYW5nZShlbCwgbm90ZSk7XG5cdCAgICAgICAgICAgICAgICB9XG5cdFxuXHQgICAgICAgICAgICAgICAgLy8gRW1wdHkgdG8vZnJvbVxuXHQgICAgICAgICAgICAgICAgaWYgKG5vdGUuZW1wdHkpIHtcblx0ICAgICAgICAgICAgICAgICAgICBjb250aW51ZTtcblx0ICAgICAgICAgICAgICAgIH1cblx0XG5cdCAgICAgICAgICAgICAgICBuZXh0VmFsdWUgPSBub3RlLnJhbmdlT2Zmc2V0Kys7XG5cdCAgICAgICAgICAgIH1cblx0XG5cdCAgICAgICAgICAgIC8vIFByaW1pdGl2ZSBpdGVyYXRpb24gaW4gYXJyYXkuXG5cdCAgICAgICAgICAgIGVsc2Uge1xuXHQgICAgICAgICAgICAgICAgKytub3RlLmFycmF5T2Zmc2V0O1xuXHQgICAgICAgICAgICAgICAgbmV4dFZhbHVlID0gZWw7XG5cdCAgICAgICAgICAgIH1cblx0ICAgICAgICB9IHdoaWxlIChuZXh0VmFsdWUgPT09IHVuZGVmaW5lZCk7XG5cdFxuXHQgICAgICAgIHJldHVybiBuZXh0VmFsdWU7XG5cdCAgICB9XG5cdFxuXHQgICAgLy8gUmFuZ2UgaXRlcmF0aW9uXG5cdCAgICBlbHNlIGlmIChub3RlLmlzT2JqZWN0KSB7XG5cdCAgICAgICAgaWYgKCFub3RlLmxvYWRlZCkge1xuXHQgICAgICAgICAgICBpbml0aWFsaXplUmFuZ2Uoa2V5U2V0LCBub3RlKTtcblx0ICAgICAgICB9XG5cdCAgICAgICAgaWYgKG5vdGUucmFuZ2VPZmZzZXQgPiBub3RlLnRvKSB7XG5cdCAgICAgICAgICAgIG5vdGUuZG9uZSA9IHRydWU7XG5cdCAgICAgICAgICAgIHJldHVybiB1bmRlZmluZWQ7XG5cdCAgICAgICAgfVxuXHRcblx0ICAgICAgICByZXR1cm4gbm90ZS5yYW5nZU9mZnNldCsrO1xuXHQgICAgfVxuXHRcblx0ICAgIC8vIFByaW1pdGl2ZSB2YWx1ZVxuXHQgICAgZWxzZSB7XG5cdCAgICAgICAgbm90ZS5kb25lID0gdHJ1ZTtcblx0ICAgICAgICByZXR1cm4ga2V5U2V0O1xuXHQgICAgfVxuXHR9O1xuXHRcblx0ZnVuY3Rpb24gaW5pdGlhbGl6ZVJhbmdlKGtleSwgbWVtbykge1xuXHQgICAgdmFyIGZyb20gPSBtZW1vLmZyb20gPSBrZXkuZnJvbSB8fCAwO1xuXHQgICAgdmFyIHRvID0gbWVtby50byA9IGtleS50byB8fFxuXHQgICAgICAgICh0eXBlb2Yga2V5Lmxlbmd0aCA9PT0gJ251bWJlcicgJiZcblx0ICAgICAgICBtZW1vLmZyb20gKyBrZXkubGVuZ3RoIC0gMSB8fCAwKTtcblx0ICAgIG1lbW8ucmFuZ2VPZmZzZXQgPSBtZW1vLmZyb207XG5cdCAgICBtZW1vLmxvYWRlZCA9IHRydWU7XG5cdCAgICBpZiAoZnJvbSA+IHRvKSB7XG5cdCAgICAgICAgbWVtby5lbXB0eSA9IHRydWU7XG5cdCAgICB9XG5cdH1cblx0XG5cdGZ1bmN0aW9uIGluaXRpYWxpemVOb3RlKGtleSwgbm90ZSkge1xuXHQgICAgbm90ZS5kb25lID0gZmFsc2U7XG5cdCAgICB2YXIgaXNPYmplY3QgPSBub3RlLmlzT2JqZWN0ID0gISEoa2V5ICYmIHR5cGVvZiBrZXkgPT09ICdvYmplY3QnKTtcblx0ICAgIG5vdGUuaXNBcnJheSA9IGlzT2JqZWN0ICYmIGlzQXJyYXkoa2V5KTtcblx0ICAgIG5vdGUuYXJyYXlPZmZzZXQgPSAwO1xuXHR9XG5cblxuLyoqKi8gfSxcbi8qIDcgKi9cbi8qKiovIGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykge1xuXG5cdHZhciBpdGVyYXRlS2V5U2V0ID0gX193ZWJwYWNrX3JlcXVpcmVfXyg2KTtcblx0dmFyIGlzQXJyYXkgPSBBcnJheS5pc0FycmF5O1xuXHRcblx0LyoqXG5cdCAqIEBwYXJhbSB7QXJyYXl9IHBhdGhzIC1cblx0ICogQHJldHVybnMge09iamVjdH0gLVxuXHQgKi9cblx0bW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiB0b1RyZWUocGF0aHMpIHtcblx0ICAgIHJldHVybiBwYXRocy5yZWR1Y2UoZnVuY3Rpb24oYWNjLCBwYXRoKSB7XG5cdCAgICAgICAgaW5uZXJUb1RyZWUoYWNjLCBwYXRoLCAwKTtcblx0ICAgICAgICByZXR1cm4gYWNjO1xuXHQgICAgfSwge30pO1xuXHR9O1xuXHRcblx0ZnVuY3Rpb24gaW5uZXJUb1RyZWUoc2VlZCwgcGF0aCwgZGVwdGgpIHtcblx0XG5cdCAgICB2YXIga2V5U2V0ID0gcGF0aFtkZXB0aF07XG5cdCAgICB2YXIgaXRlcmF0b3JOb3RlID0ge307XG5cdCAgICB2YXIga2V5O1xuXHQgICAgdmFyIG5leHREZXB0aCA9IGRlcHRoICsgMTtcblx0XG5cdCAgICBrZXkgPSBpdGVyYXRlS2V5U2V0KGtleVNldCwgaXRlcmF0b3JOb3RlKTtcblx0XG5cdCAgICBkbyB7XG5cdFxuXHQgICAgICAgIHZhciBuZXh0ID0gc2VlZFtrZXldO1xuXHQgICAgICAgIGlmICghbmV4dCkge1xuXHQgICAgICAgICAgICBpZiAobmV4dERlcHRoID09PSBwYXRoLmxlbmd0aCkge1xuXHQgICAgICAgICAgICAgICAgc2VlZFtrZXldID0gbnVsbDtcblx0ICAgICAgICAgICAgfSBlbHNlIHtcblx0ICAgICAgICAgICAgICAgIG5leHQgPSBzZWVkW2tleV0gPSB7fTtcblx0ICAgICAgICAgICAgfVxuXHQgICAgICAgIH1cblx0XG5cdCAgICAgICAgaWYgKG5leHREZXB0aCA8IHBhdGgubGVuZ3RoKSB7XG5cdCAgICAgICAgICAgIGlubmVyVG9UcmVlKG5leHQsIHBhdGgsIG5leHREZXB0aCk7XG5cdCAgICAgICAgfVxuXHRcblx0ICAgICAgICBpZiAoIWl0ZXJhdG9yTm90ZS5kb25lKSB7XG5cdCAgICAgICAgICAgIGtleSA9IGl0ZXJhdGVLZXlTZXQoa2V5U2V0LCBpdGVyYXRvck5vdGUpO1xuXHQgICAgICAgIH1cblx0ICAgIH0gd2hpbGUgKCFpdGVyYXRvck5vdGUuZG9uZSk7XG5cdH1cblx0XG5cblxuLyoqKi8gfSxcbi8qIDggKi9cbi8qKiovIGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cykge1xuXG5cblxuLyoqKi8gfSxcbi8qIDkgKi9cbi8qKiovIGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykge1xuXG5cdHZhciBoYXNJbnRlcnNlY3Rpb24gPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDEwKTtcblx0XG5cdC8qKlxuXHQgKiBDb21wYXJlcyB0aGUgcGF0aHMgcGFzc2VkIGluIHdpdGggdGhlIHRyZWUuICBBbnkgb2YgdGhlIHBhdGhzIHRoYXQgYXJlIGluXG5cdCAqIHRoZSB0cmVlIHdpbGwgYmUgc3RyaXBwZWQgZnJvbSB0aGUgcGF0aHMuXG5cdCAqXG5cdCAqICoqRG9lcyBub3QgbXV0YXRlKiogdGhlIGluY29taW5nIHBhdGhzIG9iamVjdC5cblx0ICogKipQcm9wZXIgc3Vic2V0Kiogb25seSBtYXRjaGluZy5cblx0ICpcblx0ICogQHBhcmFtIHtBcnJheX0gcGF0aHMgLSBBIGxpc3Qgb2YgcGF0aHMgKGNvbXBsZXggb3Igc2ltcGxlKSB0byBzdHJpcCB0aGVcblx0ICogaW50ZXJzZWN0aW9uXG5cdCAqIEBwYXJhbSB7T2JqZWN0fSB0cmVlIC1cblx0ICogQHB1YmxpY1xuXHQgKi9cblx0bW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiBwYXRoc0NvbXBsZW1lbnRGcm9tVHJlZShwYXRocywgdHJlZSkge1xuXHQgICAgdmFyIG91dCA9IFtdO1xuXHQgICAgdmFyIG91dExlbmd0aCA9IC0xO1xuXHRcblx0ICAgIGZvciAodmFyIGkgPSAwLCBsZW4gPSBwYXRocy5sZW5ndGg7IGkgPCBsZW47ICsraSkge1xuXHQgICAgICAgIC8vIElmIHRoaXMgZG9lcyBub3QgaW50ZXJzZWN0IHRoZW4gYWRkIGl0IHRvIHRoZSBvdXRwdXQuXG5cdCAgICAgICAgaWYgKCFoYXNJbnRlcnNlY3Rpb24odHJlZSwgcGF0aHNbaV0sIDApKSB7XG5cdCAgICAgICAgICAgIG91dFsrK291dExlbmd0aF0gPSBwYXRoc1tpXTtcblx0ICAgICAgICB9XG5cdCAgICB9XG5cdCAgICByZXR1cm4gb3V0O1xuXHR9O1xuXHRcblxuXG4vKioqLyB9LFxuLyogMTAgKi9cbi8qKiovIGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykge1xuXG5cdHZhciBpdGVyYXRlS2V5U2V0ID0gX193ZWJwYWNrX3JlcXVpcmVfXyg2KTtcblx0XG5cdC8qKlxuXHQgKiBUZXN0cyB0byBzZWUgaWYgdGhlIGludGVyc2VjdGlvbiBzaG91bGQgYmUgc3RyaXBwZWQgZnJvbSB0aGVcblx0ICogdG90YWwgcGF0aHMuICBUaGUgb25seSB3YXkgdGhpcyBoYXBwZW5zIGN1cnJlbnRseSBpcyBpZiB0aGUgZW50aXJldHlcblx0ICogb2YgdGhlIHBhdGggaXMgY29udGFpbmVkIGluIHRoZSB0cmVlLlxuXHQgKiBAcHJpdmF0ZVxuXHQgKi9cblx0bW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiBoYXNJbnRlcnNlY3Rpb24odHJlZSwgcGF0aCwgZGVwdGgpIHtcblx0ICAgIHZhciBjdXJyZW50ID0gdHJlZTtcblx0ICAgIHZhciBpbnRlcnNlY3RzID0gdHJ1ZTtcblx0XG5cdCAgICAvLyBDb250aW51ZSBpdGVyYXRpdmVseSBnb2luZyBkb3duIGEgcGF0aCB1bnRpbCBhIGNvbXBsZXgga2V5IGlzXG5cdCAgICAvLyBlbmNvdW50ZXJlZCwgdGhlbiByZWN1cnNlLlxuXHQgICAgZm9yICg7aW50ZXJzZWN0cyAmJiBkZXB0aCA8IHBhdGgubGVuZ3RoOyArK2RlcHRoKSB7XG5cdCAgICAgICAgdmFyIGtleSA9IHBhdGhbZGVwdGhdO1xuXHQgICAgICAgIHZhciBrZXlUeXBlID0gdHlwZW9mIGtleTtcblx0XG5cdCAgICAgICAgLy8gV2UgaGF2ZSB0byBpdGVyYXRlIGtleSBzZXRcblx0ICAgICAgICBpZiAoa2V5ICYmIGtleVR5cGUgPT09ICdvYmplY3QnKSB7XG5cdCAgICAgICAgICAgIHZhciBub3RlID0ge307XG5cdCAgICAgICAgICAgIHZhciBpbm5lcktleSA9IGl0ZXJhdGVLZXlTZXQoa2V5LCBub3RlKTtcblx0ICAgICAgICAgICAgdmFyIG5leHREZXB0aCA9IGRlcHRoICsgMTtcblx0XG5cdCAgICAgICAgICAgIC8vIExvb3AgdGhyb3VnaCB0aGUgaW5uZXJLZXlzIHNldHRpbmcgdGhlIGludGVyc2VjdHMgZmxhZ1xuXHQgICAgICAgICAgICAvLyB0byBlYWNoIHJlc3VsdC4gIEJyZWFrIG91dCBvbiBmYWxzZS5cblx0ICAgICAgICAgICAgZG8ge1xuXHQgICAgICAgICAgICAgICAgdmFyIG5leHQgPSBjdXJyZW50W2lubmVyS2V5XTtcblx0ICAgICAgICAgICAgICAgIGludGVyc2VjdHMgPSBuZXh0ICE9PSB1bmRlZmluZWQ7XG5cdFxuXHQgICAgICAgICAgICAgICAgaWYgKGludGVyc2VjdHMpIHtcblx0ICAgICAgICAgICAgICAgICAgICBpbnRlcnNlY3RzID0gaGFzSW50ZXJzZWN0aW9uKG5leHQsIHBhdGgsIG5leHREZXB0aCk7XG5cdCAgICAgICAgICAgICAgICB9XG5cdCAgICAgICAgICAgICAgICBpbm5lcktleSA9IGl0ZXJhdGVLZXlTZXQoa2V5LCBub3RlKTtcblx0ICAgICAgICAgICAgfSB3aGlsZSAoaW50ZXJzZWN0cyAmJiAhbm90ZS5kb25lKTtcblx0XG5cdCAgICAgICAgICAgIC8vIFNpbmNlIHdlIHJlY3Vyc2VkLCB3ZSBzaGFsbCBub3QgcGFzcyBhbnkgZnVydGhlciFcblx0ICAgICAgICAgICAgYnJlYWs7XG5cdCAgICAgICAgfVxuXHRcblx0ICAgICAgICAvLyBJdHMgYSBzaW1wbGUga2V5LCBqdXN0IG1vdmUgZm9yd2FyZCB3aXRoIHRoZSB0ZXN0aW5nLlxuXHQgICAgICAgIGN1cnJlbnQgPSBjdXJyZW50W2tleV07XG5cdCAgICAgICAgaW50ZXJzZWN0cyA9IGN1cnJlbnQgIT09IHVuZGVmaW5lZDtcblx0ICAgIH1cblx0XG5cdCAgICByZXR1cm4gaW50ZXJzZWN0cztcblx0fTtcblxuXG4vKioqLyB9LFxuLyogMTEgKi9cbi8qKiovIGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykge1xuXG5cdHZhciBoYXNJbnRlcnNlY3Rpb24gPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDEwKTtcblx0XG5cdC8qKlxuXHQgKiBDb21wYXJlcyB0aGUgcGF0aHMgcGFzc2VkIGluIHdpdGggdGhlIHRyZWUuICBBbnkgb2YgdGhlIHBhdGhzIHRoYXQgYXJlIGluXG5cdCAqIHRoZSB0cmVlIHdpbGwgYmUgc3RyaXBwZWQgZnJvbSB0aGUgcGF0aHMuXG5cdCAqXG5cdCAqICoqRG9lcyBub3QgbXV0YXRlKiogdGhlIGluY29taW5nIHBhdGhzIG9iamVjdC5cblx0ICogKipQcm9wZXIgc3Vic2V0Kiogb25seSBtYXRjaGluZy5cblx0ICpcblx0ICogQHBhcmFtIHtBcnJheX0gcGF0aHMgLSBBIGxpc3Qgb2YgcGF0aHMgKGNvbXBsZXggb3Igc2ltcGxlKSB0byBzdHJpcCB0aGVcblx0ICogaW50ZXJzZWN0aW9uXG5cdCAqIEBwYXJhbSB7T2JqZWN0fSB0cmVlIC1cblx0ICogQHB1YmxpY1xuXHQgKi9cblx0bW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiBwYXRoc0NvbXBsZW1lbnRGcm9tTGVuZ3RoVHJlZShwYXRocywgdHJlZSkge1xuXHQgICAgdmFyIG91dCA9IFtdO1xuXHQgICAgdmFyIG91dExlbmd0aCA9IC0xO1xuXHRcblx0ICAgIGZvciAodmFyIGkgPSAwLCBsZW4gPSBwYXRocy5sZW5ndGg7IGkgPCBsZW47ICsraSkge1xuXHQgICAgICAgIC8vIElmIHRoaXMgZG9lcyBub3QgaW50ZXJzZWN0IHRoZW4gYWRkIGl0IHRvIHRoZSBvdXRwdXQuXG5cdCAgICAgICAgdmFyIHBhdGggPSBwYXRoc1tpXTtcblx0ICAgICAgICBpZiAoIWhhc0ludGVyc2VjdGlvbih0cmVlW3BhdGgubGVuZ3RoXSwgcGF0aCwgMCkpIHtcblx0ICAgICAgICAgICAgb3V0Wysrb3V0TGVuZ3RoXSA9IHBhdGg7XG5cdCAgICAgICAgfVxuXHQgICAgfVxuXHQgICAgcmV0dXJuIG91dDtcblx0fTtcblx0XG5cblxuLyoqKi8gfSxcbi8qIDEyICovXG4vKioqLyBmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMpIHtcblxuXHR2YXIgaXNBcnJheSA9IEFycmF5LmlzQXJyYXk7XG5cdHZhciB0eXBlT2ZPYmplY3QgPSBcIm9iamVjdFwiO1xuXHRcblx0LyoganNoaW50IGZvcmluOiBmYWxzZSAqL1xuXHRtb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uIHRvUGF0aHMobGVuZ3Rocykge1xuXHQgICAgdmFyIHBhdGhtYXA7XG5cdCAgICB2YXIgYWxsUGF0aHMgPSBbXTtcblx0ICAgIHZhciBhbGxQYXRoc0xlbmd0aCA9IDA7XG5cdCAgICBmb3IgKHZhciBsZW5ndGggaW4gbGVuZ3Rocykge1xuXHQgICAgICAgIGlmIChpc051bWJlcihsZW5ndGgpICYmIGlzT2JqZWN0KHBhdGhtYXAgPSBsZW5ndGhzW2xlbmd0aF0pKSB7XG5cdCAgICAgICAgICAgIHZhciBwYXRocyA9IGNvbGxhcHNlUGF0aE1hcChwYXRobWFwLCAwLCBwYXJzZUludChsZW5ndGgsIDEwKSkuc2V0cztcblx0ICAgICAgICAgICAgdmFyIHBhdGhzSW5kZXggPSAtMTtcblx0ICAgICAgICAgICAgdmFyIHBhdGhzQ291bnQgPSBwYXRocy5sZW5ndGg7XG5cdCAgICAgICAgICAgIHdoaWxlICgrK3BhdGhzSW5kZXggPCBwYXRoc0NvdW50KSB7XG5cdCAgICAgICAgICAgICAgICBhbGxQYXRoc1thbGxQYXRoc0xlbmd0aCsrXSA9IGNvbGxhcHNlUGF0aFNldEluZGV4ZXMocGF0aHNbcGF0aHNJbmRleF0pO1xuXHQgICAgICAgICAgICB9XG5cdCAgICAgICAgfVxuXHQgICAgfVxuXHQgICAgcmV0dXJuIGFsbFBhdGhzO1xuXHR9O1xuXHRcblx0ZnVuY3Rpb24gaXNPYmplY3QodmFsdWUpIHtcblx0ICAgIHJldHVybiB2YWx1ZSAhPT0gbnVsbCAmJiB0eXBlb2YgdmFsdWUgPT09IHR5cGVPZk9iamVjdDtcblx0fVxuXHRcblx0ZnVuY3Rpb24gY29sbGFwc2VQYXRoTWFwKHBhdGhtYXAsIGRlcHRoLCBsZW5ndGgpIHtcblx0XG5cdCAgICB2YXIga2V5O1xuXHQgICAgdmFyIGNvZGUgPSBnZXRIYXNoQ29kZShTdHJpbmcoZGVwdGgpKTtcblx0ICAgIHZhciBzdWJzID0gT2JqZWN0LmNyZWF0ZShudWxsKTtcblx0XG5cdCAgICB2YXIgY29kZXMgPSBbXTtcblx0ICAgIHZhciBjb2Rlc0luZGV4ID0gLTE7XG5cdCAgICB2YXIgY29kZXNDb3VudCA9IDA7XG5cdFxuXHQgICAgdmFyIHBhdGhzZXRzID0gW107XG5cdCAgICB2YXIgcGF0aHNldHNDb3VudCA9IDA7XG5cdFxuXHQgICAgdmFyIHN1YlBhdGgsIHN1YkNvZGUsXG5cdCAgICAgICAgc3ViS2V5cywgc3ViS2V5c0luZGV4LCBzdWJLZXlzQ291bnQsXG5cdCAgICAgICAgc3ViU2V0cywgc3ViU2V0c0luZGV4LCBzdWJTZXRzQ291bnQsXG5cdCAgICAgICAgcGF0aHNldCwgcGF0aHNldEluZGV4LCBwYXRoc2V0Q291bnQsXG5cdCAgICAgICAgZmlyc3RTdWJLZXksIHBhdGhzZXRDbG9uZTtcblx0XG5cdCAgICBzdWJLZXlzID0gW107XG5cdCAgICBzdWJLZXlzSW5kZXggPSAtMTtcblx0XG5cdCAgICBpZiAoZGVwdGggPCBsZW5ndGggLSAxKSB7XG5cdFxuXHQgICAgICAgIHN1YktleXNDb3VudCA9IGdldFNvcnRlZEtleXMocGF0aG1hcCwgc3ViS2V5cyk7XG5cdFxuXHQgICAgICAgIHdoaWxlICgrK3N1YktleXNJbmRleCA8IHN1YktleXNDb3VudCkge1xuXHQgICAgICAgICAgICBrZXkgPSBzdWJLZXlzW3N1YktleXNJbmRleF07XG5cdCAgICAgICAgICAgIHN1YlBhdGggPSBjb2xsYXBzZVBhdGhNYXAocGF0aG1hcFtrZXldLCBkZXB0aCArIDEsIGxlbmd0aCk7XG5cdCAgICAgICAgICAgIHN1YkNvZGUgPSBzdWJQYXRoLmNvZGU7XG5cdCAgICAgICAgICAgIGlmKHN1YnNbc3ViQ29kZV0pIHtcblx0ICAgICAgICAgICAgICAgIHN1YlBhdGggPSBzdWJzW3N1YkNvZGVdO1xuXHQgICAgICAgICAgICB9IGVsc2Uge1xuXHQgICAgICAgICAgICAgICAgY29kZXNbY29kZXNDb3VudCsrXSA9IHN1YkNvZGU7XG5cdCAgICAgICAgICAgICAgICBzdWJQYXRoID0gc3Vic1tzdWJDb2RlXSA9IHtcblx0ICAgICAgICAgICAgICAgICAgICBrZXlzOiBbXSxcblx0ICAgICAgICAgICAgICAgICAgICBzZXRzOiBzdWJQYXRoLnNldHNcblx0ICAgICAgICAgICAgICAgIH07XG5cdCAgICAgICAgICAgIH1cblx0ICAgICAgICAgICAgY29kZSA9IGdldEhhc2hDb2RlKGNvZGUgKyBrZXkgKyBzdWJDb2RlKTtcblx0XG5cdCAgICAgICAgICAgIGlzTnVtYmVyKGtleSkgJiZcblx0ICAgICAgICAgICAgICAgIHN1YlBhdGgua2V5cy5wdXNoKHBhcnNlSW50KGtleSwgMTApKSB8fFxuXHQgICAgICAgICAgICAgICAgc3ViUGF0aC5rZXlzLnB1c2goa2V5KTtcblx0ICAgICAgICB9XG5cdFxuXHQgICAgICAgIHdoaWxlKCsrY29kZXNJbmRleCA8IGNvZGVzQ291bnQpIHtcblx0XG5cdCAgICAgICAgICAgIGtleSA9IGNvZGVzW2NvZGVzSW5kZXhdO1xuXHQgICAgICAgICAgICBzdWJQYXRoID0gc3Vic1trZXldO1xuXHQgICAgICAgICAgICBzdWJLZXlzID0gc3ViUGF0aC5rZXlzO1xuXHQgICAgICAgICAgICBzdWJLZXlzQ291bnQgPSBzdWJLZXlzLmxlbmd0aDtcblx0XG5cdCAgICAgICAgICAgIGlmIChzdWJLZXlzQ291bnQgPiAwKSB7XG5cdFxuXHQgICAgICAgICAgICAgICAgc3ViU2V0cyA9IHN1YlBhdGguc2V0cztcblx0ICAgICAgICAgICAgICAgIHN1YlNldHNJbmRleCA9IC0xO1xuXHQgICAgICAgICAgICAgICAgc3ViU2V0c0NvdW50ID0gc3ViU2V0cy5sZW5ndGg7XG5cdCAgICAgICAgICAgICAgICBmaXJzdFN1YktleSA9IHN1YktleXNbMF07XG5cdFxuXHQgICAgICAgICAgICAgICAgd2hpbGUgKCsrc3ViU2V0c0luZGV4IDwgc3ViU2V0c0NvdW50KSB7XG5cdFxuXHQgICAgICAgICAgICAgICAgICAgIHBhdGhzZXQgPSBzdWJTZXRzW3N1YlNldHNJbmRleF07XG5cdCAgICAgICAgICAgICAgICAgICAgcGF0aHNldEluZGV4ID0gLTE7XG5cdCAgICAgICAgICAgICAgICAgICAgcGF0aHNldENvdW50ID0gcGF0aHNldC5sZW5ndGg7XG5cdCAgICAgICAgICAgICAgICAgICAgcGF0aHNldENsb25lID0gbmV3IEFycmF5KHBhdGhzZXRDb3VudCArIDEpO1xuXHQgICAgICAgICAgICAgICAgICAgIHBhdGhzZXRDbG9uZVswXSA9IHN1YktleXNDb3VudCA+IDEgJiYgc3ViS2V5cyB8fCBmaXJzdFN1YktleTtcblx0XG5cdCAgICAgICAgICAgICAgICAgICAgd2hpbGUgKCsrcGF0aHNldEluZGV4IDwgcGF0aHNldENvdW50KSB7XG5cdCAgICAgICAgICAgICAgICAgICAgICAgIHBhdGhzZXRDbG9uZVtwYXRoc2V0SW5kZXggKyAxXSA9IHBhdGhzZXRbcGF0aHNldEluZGV4XTtcblx0ICAgICAgICAgICAgICAgICAgICB9XG5cdFxuXHQgICAgICAgICAgICAgICAgICAgIHBhdGhzZXRzW3BhdGhzZXRzQ291bnQrK10gPSBwYXRoc2V0Q2xvbmU7XG5cdCAgICAgICAgICAgICAgICB9XG5cdCAgICAgICAgICAgIH1cblx0ICAgICAgICB9XG5cdCAgICB9IGVsc2Uge1xuXHQgICAgICAgIHN1YktleXNDb3VudCA9IGdldFNvcnRlZEtleXMocGF0aG1hcCwgc3ViS2V5cyk7XG5cdCAgICAgICAgaWYgKHN1YktleXNDb3VudCA+IDEpIHtcblx0ICAgICAgICAgICAgcGF0aHNldHNbcGF0aHNldHNDb3VudCsrXSA9IFtzdWJLZXlzXTtcblx0ICAgICAgICB9IGVsc2Uge1xuXHQgICAgICAgICAgICBwYXRoc2V0c1twYXRoc2V0c0NvdW50KytdID0gc3ViS2V5cztcblx0ICAgICAgICB9XG5cdCAgICAgICAgd2hpbGUgKCsrc3ViS2V5c0luZGV4IDwgc3ViS2V5c0NvdW50KSB7XG5cdCAgICAgICAgICAgIGNvZGUgPSBnZXRIYXNoQ29kZShjb2RlICsgc3ViS2V5c1tzdWJLZXlzSW5kZXhdKTtcblx0ICAgICAgICB9XG5cdCAgICB9XG5cdFxuXHQgICAgcmV0dXJuIHtcblx0ICAgICAgICBjb2RlOiBjb2RlLFxuXHQgICAgICAgIHNldHM6IHBhdGhzZXRzXG5cdCAgICB9O1xuXHR9XG5cdFxuXHRmdW5jdGlvbiBjb2xsYXBzZVBhdGhTZXRJbmRleGVzKHBhdGhzZXQpIHtcblx0XG5cdCAgICB2YXIga2V5c2V0SW5kZXggPSAtMTtcblx0ICAgIHZhciBrZXlzZXRDb3VudCA9IHBhdGhzZXQubGVuZ3RoO1xuXHRcblx0ICAgIHdoaWxlICgrK2tleXNldEluZGV4IDwga2V5c2V0Q291bnQpIHtcblx0ICAgICAgICB2YXIga2V5c2V0ID0gcGF0aHNldFtrZXlzZXRJbmRleF07XG5cdCAgICAgICAgaWYgKGlzQXJyYXkoa2V5c2V0KSkge1xuXHQgICAgICAgICAgICBwYXRoc2V0W2tleXNldEluZGV4XSA9IGNvbGxhcHNlSW5kZXgoa2V5c2V0KTtcblx0ICAgICAgICB9XG5cdCAgICB9XG5cdFxuXHQgICAgcmV0dXJuIHBhdGhzZXQ7XG5cdH1cblx0XG5cdC8qKlxuXHQgKiBDb2xsYXBzZSByYW5nZSBpbmRleGVycywgZS5nLiB3aGVuIHRoZXJlIGlzIGEgY29udGludW91c1xuXHQgKiByYW5nZSBpbiBhbiBhcnJheSwgdHVybiBpdCBpbnRvIGFuIG9iamVjdCBpbnN0ZWFkOlxuXHQgKlxuXHQgKiBbMSwyLDMsNCw1LDZdID0+IHtcImZyb21cIjoxLCBcInRvXCI6Nn1cblx0ICpcblx0ICogQHByaXZhdGVcblx0ICovXG5cdGZ1bmN0aW9uIGNvbGxhcHNlSW5kZXgoa2V5c2V0KSB7XG5cdFxuXHQgICAgLy8gRG8gd2UgbmVlZCB0byBkZWR1cGUgYW4gaW5kZXhlciBrZXlzZXQgaWYgdGhleSdyZSBkdXBsaWNhdGUgY29uc2VjdXRpdmUgaW50ZWdlcnM/XG5cdCAgICAvLyB2YXIgaGFzaCA9IHt9O1xuXHQgICAgdmFyIGtleUluZGV4ID0gLTE7XG5cdCAgICB2YXIga2V5Q291bnQgPSBrZXlzZXQubGVuZ3RoIC0gMTtcblx0ICAgIHZhciBpc1NwYXJzZVJhbmdlID0ga2V5Q291bnQgPiAwO1xuXHRcblx0ICAgIHdoaWxlICgrK2tleUluZGV4IDw9IGtleUNvdW50KSB7XG5cdFxuXHQgICAgICAgIHZhciBrZXkgPSBrZXlzZXRba2V5SW5kZXhdO1xuXHRcblx0ICAgICAgICBpZiAoIWlzTnVtYmVyKGtleSkgLyogfHwgaGFzaFtrZXldID09PSB0cnVlKi8gKSB7XG5cdCAgICAgICAgICAgIGlzU3BhcnNlUmFuZ2UgPSBmYWxzZTtcblx0ICAgICAgICAgICAgYnJlYWs7XG5cdCAgICAgICAgfVxuXHQgICAgICAgIC8vIGhhc2hba2V5XSA9IHRydWU7XG5cdCAgICAgICAgLy8gQ2FzdCBudW1iZXIgaW5kZXhlcyB0byBpbnRlZ2Vycy5cblx0ICAgICAgICBrZXlzZXRba2V5SW5kZXhdID0gcGFyc2VJbnQoa2V5LCAxMCk7XG5cdCAgICB9XG5cdFxuXHQgICAgaWYgKGlzU3BhcnNlUmFuZ2UgPT09IHRydWUpIHtcblx0XG5cdCAgICAgICAga2V5c2V0LnNvcnQoc29ydExpc3RBc2NlbmRpbmcpO1xuXHRcblx0ICAgICAgICB2YXIgZnJvbSA9IGtleXNldFswXTtcblx0ICAgICAgICB2YXIgdG8gPSBrZXlzZXRba2V5Q291bnRdO1xuXHRcblx0ICAgICAgICAvLyBJZiB3ZSByZS1pbnRyb2R1Y2UgZGVkdXBlZCBpbnRlZ2VyIGluZGV4ZXJzLCBjaGFuZ2UgdGhpcyBjb21wYXJzb24gdG8gXCI9PT1cIi5cblx0ICAgICAgICBpZiAodG8gLSBmcm9tIDw9IGtleUNvdW50KSB7XG5cdCAgICAgICAgICAgIHJldHVybiB7XG5cdCAgICAgICAgICAgICAgICBmcm9tOiBmcm9tLFxuXHQgICAgICAgICAgICAgICAgdG86IHRvXG5cdCAgICAgICAgICAgIH07XG5cdCAgICAgICAgfVxuXHQgICAgfVxuXHRcblx0ICAgIHJldHVybiBrZXlzZXQ7XG5cdH1cblx0XG5cdGZ1bmN0aW9uIHNvcnRMaXN0QXNjZW5kaW5nKGEsIGIpIHtcblx0ICAgIHJldHVybiBhIC0gYjtcblx0fVxuXHRcblx0LyoganNoaW50IGZvcmluOiBmYWxzZSAqL1xuXHRmdW5jdGlvbiBnZXRTb3J0ZWRLZXlzKG1hcCwga2V5cywgc29ydCkge1xuXHQgICAgdmFyIGxlbiA9IDA7XG5cdCAgICBmb3IgKHZhciBrZXkgaW4gbWFwKSB7XG5cdCAgICAgICAga2V5c1tsZW4rK10gPSBrZXk7XG5cdCAgICB9XG5cdCAgICBpZiAobGVuID4gMSkge1xuXHQgICAgICAgIGtleXMuc29ydChzb3J0KTtcblx0ICAgIH1cblx0ICAgIHJldHVybiBsZW47XG5cdH1cblx0XG5cdGZ1bmN0aW9uIGdldEhhc2hDb2RlKGtleSkge1xuXHQgICAgdmFyIGNvZGUgPSA1MzgxO1xuXHQgICAgdmFyIGluZGV4ID0gLTE7XG5cdCAgICB2YXIgY291bnQgPSBrZXkubGVuZ3RoO1xuXHQgICAgd2hpbGUgKCsraW5kZXggPCBjb3VudCkge1xuXHQgICAgICAgIGNvZGUgPSAoY29kZSA8PCA1KSArIGNvZGUgKyBrZXkuY2hhckNvZGVBdChpbmRleCk7XG5cdCAgICB9XG5cdCAgICByZXR1cm4gU3RyaW5nKGNvZGUpO1xuXHR9XG5cdFxuXHQvKipcblx0ICogUmV0dXJuIHRydWUgaWYgYXJndW1lbnQgaXMgYSBudW1iZXIgb3IgY2FuIGJlIGNhc3QgdG8gYSBudW1iZXJcblx0ICogQHByaXZhdGVcblx0ICovXG5cdGZ1bmN0aW9uIGlzTnVtYmVyKHZhbCkge1xuXHQgICAgLy8gcGFyc2VGbG9hdCBOYU5zIG51bWVyaWMtY2FzdCBmYWxzZSBwb3NpdGl2ZXMgKG51bGx8dHJ1ZXxmYWxzZXxcIlwiKVxuXHQgICAgLy8gLi4uYnV0IG1pc2ludGVycHJldHMgbGVhZGluZy1udW1iZXIgc3RyaW5ncywgcGFydGljdWxhcmx5IGhleCBsaXRlcmFscyAoXCIweC4uLlwiKVxuXHQgICAgLy8gc3VidHJhY3Rpb24gZm9yY2VzIGluZmluaXRpZXMgdG8gTmFOXG5cdCAgICAvLyBhZGRpbmcgMSBjb3JyZWN0cyBsb3NzIG9mIHByZWNpc2lvbiBmcm9tIHBhcnNlRmxvYXQgKCMxNTEwMClcblx0ICAgIHJldHVybiAhaXNBcnJheSh2YWwpICYmICh2YWwgLSBwYXJzZUZsb2F0KHZhbCkgKyAxKSA+PSAwO1xuXHR9XG5cdFxuXG5cbi8qKiovIH0sXG4vKiAxMyAqL1xuLyoqKi8gZnVuY3Rpb24obW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7XG5cblx0dmFyIHRvUGF0aHMgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDEyKTtcblx0dmFyIHRvVHJlZSA9IF9fd2VicGFja19yZXF1aXJlX18oNyk7XG5cdFxuXHRtb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uIGNvbGxhcHNlKHBhdGhzKSB7XG5cdCAgICB2YXIgY29sbGFwc2VNYXAgPSBwYXRocy5cblx0ICAgICAgICByZWR1Y2UoZnVuY3Rpb24oYWNjLCBwYXRoKSB7XG5cdCAgICAgICAgICAgIHZhciBsZW4gPSBwYXRoLmxlbmd0aDtcblx0ICAgICAgICAgICAgaWYgKCFhY2NbbGVuXSkge1xuXHQgICAgICAgICAgICAgICAgYWNjW2xlbl0gPSBbXTtcblx0ICAgICAgICAgICAgfVxuXHQgICAgICAgICAgICBhY2NbbGVuXS5wdXNoKHBhdGgpO1xuXHQgICAgICAgICAgICByZXR1cm4gYWNjO1xuXHQgICAgICAgIH0sIHt9KTtcblx0XG5cdCAgICBPYmplY3QuXG5cdCAgICAgICAga2V5cyhjb2xsYXBzZU1hcCkuXG5cdCAgICAgICAgZm9yRWFjaChmdW5jdGlvbihjb2xsYXBzZUtleSkge1xuXHQgICAgICAgICAgICBjb2xsYXBzZU1hcFtjb2xsYXBzZUtleV0gPSB0b1RyZWUoY29sbGFwc2VNYXBbY29sbGFwc2VLZXldKTtcblx0ICAgICAgICB9KTtcblx0XG5cdCAgICByZXR1cm4gdG9QYXRocyhjb2xsYXBzZU1hcCk7XG5cdH07XG5cblxuLyoqKi8gfSxcbi8qIDE0ICovXG4vKioqLyBmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHtcblxuXHR2YXIgaXRlcmF0ZUtleVNldCA9IF9fd2VicGFja19yZXF1aXJlX18oNik7XG5cdHZhciBjbG9uZUFycmF5ID0gX193ZWJwYWNrX3JlcXVpcmVfXygxNSk7XG5cdHZhciBjYXRBbmRTbGljZSA9IF9fd2VicGFja19yZXF1aXJlX18oMTYpO1xuXHR2YXIgJHR5cGVzID0gX193ZWJwYWNrX3JlcXVpcmVfXygxNyk7XG5cdHZhciAkcmVmID0gJHR5cGVzLiRyZWY7XG5cdHZhciBmb2xsb3dSZWZlcmVuY2UgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDE4KTtcblx0XG5cdC8qKlxuXHQgKiBUaGUgZmFzdGVzdCBwb3NzaWJsZSBvcHRpbWl6ZSBvZiBwYXRocy5cblx0ICpcblx0ICogV2hhdCBpdCBkb2VzOlxuXHQgKiAtIEFueSBhdG9tIHNob3J0LWNpcmN1aXQgLyBmb3VuZCB2YWx1ZSB3aWxsIGJlIHJlbW92ZWQgZnJvbSB0aGUgcGF0aC5cblx0ICogLSBBbGwgcGF0aHMgd2lsbCBiZSBleHBsb2RlZCB3aGljaCBtZWFucyB0aGF0IGNvbGxhcHNlIHdpbGwgbmVlZCB0byBiZVxuXHQgKiAgIHJhbiBhZnRlcndvcmRzLlxuXHQgKiAtIEFueSBtaXNzaW5nIHBhdGggd2lsbCBiZSBvcHRpbWl6ZWQgYXMgbXVjaCBhcyBwb3NzaWJsZS5cblx0ICovXG5cdG1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24gb3B0aW1pemVQYXRoU2V0cyhjYWNoZSwgcGF0aHMsIG1heFJlZkZvbGxvdykge1xuXHQgICAgdmFyIG9wdGltaXplZCA9IFtdO1xuXHQgICAgcGF0aHMuZm9yRWFjaChmdW5jdGlvbihwKSB7XG5cdCAgICAgICAgb3B0aW1pemVQYXRoU2V0KGNhY2hlLCBjYWNoZSwgcCwgMCwgb3B0aW1pemVkLCBbXSwgbWF4UmVmRm9sbG93KTtcblx0ICAgIH0pO1xuXHRcblx0ICAgIHJldHVybiBvcHRpbWl6ZWQ7XG5cdH07XG5cdFxuXHRcblx0LyoqXG5cdCAqIG9wdGltaXplcyBvbmUgcGF0aFNldCBhdCBhIHRpbWUuXG5cdCAqL1xuXHRmdW5jdGlvbiBvcHRpbWl6ZVBhdGhTZXQoY2FjaGUsIGNhY2hlUm9vdCwgcGF0aFNldCxcblx0ICAgICAgICAgICAgICAgICAgICAgICAgIGRlcHRoLCBvdXQsIG9wdGltaXplZFBhdGgsIG1heFJlZkZvbGxvdykge1xuXHRcblx0ICAgIC8vIGF0IG1pc3NpbmcsIHJlcG9ydCBvcHRpbWl6ZWQgcGF0aC5cblx0ICAgIGlmIChjYWNoZSA9PT0gdW5kZWZpbmVkKSB7XG5cdCAgICAgICAgb3V0W291dC5sZW5ndGhdID0gY2F0QW5kU2xpY2Uob3B0aW1pemVkUGF0aCwgcGF0aFNldCwgZGVwdGgpO1xuXHQgICAgICAgIHJldHVybjtcblx0ICAgIH1cblx0XG5cdCAgICAvLyBhbGwgb3RoZXIgc2VudGluZWxzIGFyZSBzaG9ydCBjaXJjdWl0ZWQuXG5cdCAgICAvLyBPciB3ZSBmb3VuZCBhIHByaW1pdGl2ZSAod2hpY2ggaW5jbHVkZXMgbnVsbClcblx0ICAgIGlmIChjYWNoZSA9PT0gbnVsbCB8fCAoY2FjaGUuJHR5cGUgJiYgY2FjaGUuJHR5cGUgIT09ICRyZWYpIHx8XG5cdCAgICAgICAgICAgICh0eXBlb2YgY2FjaGUgIT09ICdvYmplY3QnKSkge1xuXHQgICAgICAgIHJldHVybjtcblx0ICAgIH1cblx0XG5cdCAgICAvLyBJZiB0aGUgcmVmZXJlbmNlIGlzIHRoZSBsYXN0IGl0ZW0gaW4gdGhlIHBhdGggdGhlbiBkbyBub3Rcblx0ICAgIC8vIGNvbnRpbnVlIHRvIHNlYXJjaCBpdC5cblx0ICAgIGlmIChjYWNoZS4kdHlwZSA9PT0gJHJlZiAmJiBkZXB0aCA9PT0gcGF0aFNldC5sZW5ndGgpIHtcblx0ICAgICAgICByZXR1cm47XG5cdCAgICB9XG5cdFxuXHQgICAgdmFyIGtleVNldCA9IHBhdGhTZXRbZGVwdGhdO1xuXHQgICAgdmFyIGlzS2V5U2V0ID0gdHlwZW9mIGtleVNldCA9PT0gJ29iamVjdCc7XG5cdCAgICB2YXIgbmV4dERlcHRoID0gZGVwdGggKyAxO1xuXHQgICAgdmFyIGl0ZXJhdG9yTm90ZSA9IGZhbHNlO1xuXHQgICAgdmFyIGtleSA9IGtleVNldDtcblx0ICAgIGlmIChpc0tleVNldCkge1xuXHQgICAgICAgIGl0ZXJhdG9yTm90ZSA9IHt9O1xuXHQgICAgICAgIGtleSA9IGl0ZXJhdGVLZXlTZXQoa2V5U2V0LCBpdGVyYXRvck5vdGUpO1xuXHQgICAgfVxuXHQgICAgdmFyIG5leHQsIG5leHRPcHRpbWl6ZWQ7XG5cdCAgICBkbyB7XG5cdCAgICAgICAgbmV4dCA9IGNhY2hlW2tleV07XG5cdCAgICAgICAgdmFyIG9wdGltaXplZFBhdGhMZW5ndGggPSBvcHRpbWl6ZWRQYXRoLmxlbmd0aDtcblx0ICAgICAgICBpZiAoa2V5ICE9PSBudWxsKSB7XG5cdCAgICAgICAgICAgIG9wdGltaXplZFBhdGhbb3B0aW1pemVkUGF0aExlbmd0aF0gPSBrZXk7XG5cdCAgICAgICAgfVxuXHRcblx0ICAgICAgICBpZiAobmV4dCAmJiBuZXh0LiR0eXBlID09PSAkcmVmICYmIG5leHREZXB0aCA8IHBhdGhTZXQubGVuZ3RoKSB7XG5cdCAgICAgICAgICAgIHZhciByZWZSZXN1bHRzID1cblx0ICAgICAgICAgICAgICAgIGZvbGxvd1JlZmVyZW5jZShjYWNoZVJvb3QsIG5leHQudmFsdWUsIG1heFJlZkZvbGxvdyk7XG5cdCAgICAgICAgICAgIG5leHQgPSByZWZSZXN1bHRzWzBdO1xuXHRcblx0ICAgICAgICAgICAgLy8gbXVzdCBjbG9uZSB0byBhdm9pZCB0aGUgbXV0YXRpb24gZnJvbSBhYm92ZSBkZXN0cm95aW5nIHRoZSBjYWNoZS5cblx0ICAgICAgICAgICAgbmV4dE9wdGltaXplZCA9IGNsb25lQXJyYXkocmVmUmVzdWx0c1sxXSk7XG5cdCAgICAgICAgfSBlbHNlIHtcblx0ICAgICAgICAgICAgbmV4dE9wdGltaXplZCA9IG9wdGltaXplZFBhdGg7XG5cdCAgICAgICAgfVxuXHRcblx0ICAgICAgICBvcHRpbWl6ZVBhdGhTZXQobmV4dCwgY2FjaGVSb290LCBwYXRoU2V0LCBuZXh0RGVwdGgsXG5cdCAgICAgICAgICAgICAgICAgICAgICAgIG91dCwgbmV4dE9wdGltaXplZCwgbWF4UmVmRm9sbG93KTtcblx0ICAgICAgICBvcHRpbWl6ZWRQYXRoLmxlbmd0aCA9IG9wdGltaXplZFBhdGhMZW5ndGg7XG5cdFxuXHQgICAgICAgIGlmIChpdGVyYXRvck5vdGUgJiYgIWl0ZXJhdG9yTm90ZS5kb25lKSB7XG5cdCAgICAgICAgICAgIGtleSA9IGl0ZXJhdGVLZXlTZXQoa2V5U2V0LCBpdGVyYXRvck5vdGUpO1xuXHQgICAgICAgIH1cblx0ICAgIH0gd2hpbGUgKGl0ZXJhdG9yTm90ZSAmJiAhaXRlcmF0b3JOb3RlLmRvbmUpO1xuXHR9XG5cdFxuXHRcblxuXG4vKioqLyB9LFxuLyogMTUgKi9cbi8qKiovIGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cykge1xuXG5cdGZ1bmN0aW9uIGNsb25lQXJyYXkoYXJyLCBpbmRleCkge1xuXHQgICAgdmFyIGEgPSBbXTtcblx0ICAgIHZhciBsZW4gPSBhcnIubGVuZ3RoO1xuXHQgICAgZm9yICh2YXIgaSA9IGluZGV4IHx8IDA7IGkgPCBsZW47IGkrKykge1xuXHQgICAgICAgIGFbaV0gPSBhcnJbaV07XG5cdCAgICB9XG5cdCAgICByZXR1cm4gYTtcblx0fVxuXHRcblx0bW9kdWxlLmV4cG9ydHMgPSBjbG9uZUFycmF5O1xuXHRcblxuXG4vKioqLyB9LFxuLyogMTYgKi9cbi8qKiovIGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cykge1xuXG5cdG1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24gY2F0QW5kU2xpY2UoYSwgYiwgc2xpY2UpIHtcblx0ICAgIHZhciBuZXh0ID0gW10sIGksIGosIGxlbjtcblx0ICAgIGZvciAoaSA9IDAsIGxlbiA9IGEubGVuZ3RoOyBpIDwgbGVuOyArK2kpIHtcblx0ICAgICAgICBuZXh0W2ldID0gYVtpXTtcblx0ICAgIH1cblx0XG5cdCAgICBmb3IgKGogPSBzbGljZSB8fCAwLCBsZW4gPSBiLmxlbmd0aDsgaiA8IGxlbjsgKytqLCArK2kpIHtcblx0ICAgICAgICBuZXh0W2ldID0gYltqXTtcblx0ICAgIH1cblx0XG5cdCAgICByZXR1cm4gbmV4dDtcblx0fTtcblx0XG5cblxuLyoqKi8gfSxcbi8qIDE3ICovXG4vKioqLyBmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMpIHtcblxuXHRtb2R1bGUuZXhwb3J0cyA9IHtcblx0ICAgICRyZWY6ICdyZWYnLFxuXHQgICAgJGF0b206ICdhdG9tJyxcblx0ICAgICRlcnJvcjogJ2Vycm9yJ1xuXHR9O1xuXHRcblxuXG4vKioqLyB9LFxuLyogMTggKi9cbi8qKiovIGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykge1xuXG5cdHZhciBjbG9uZUFycmF5ID0gX193ZWJwYWNrX3JlcXVpcmVfXygxNSk7XG5cdHZhciAkcmVmID0gX193ZWJwYWNrX3JlcXVpcmVfXygxNykuJHJlZjtcblx0dmFyIGVycm9ycyA9IF9fd2VicGFja19yZXF1aXJlX18oMTkpO1xuXHRcblx0LyoqXG5cdCAqIHBlcmZvcm1zIHRoZSBzaW1wbGlmaWVkIGNhY2hlIHJlZmVyZW5jZSBmb2xsb3cuICBUaGlzXG5cdCAqIGRpZmZlcnMgZnJvbSBnZXQgYXMgdGhlcmUgaXMganVzdCBmb2xsb3dpbmcgYW5kIHJlcG9ydGluZyxcblx0ICogbm90IG11Y2ggZWxzZS5cblx0ICpcblx0ICogQHBhcmFtIHtPYmplY3R9IGNhY2hlUm9vdFxuXHQgKiBAcGFyYW0ge0FycmF5fSByZWZcblx0ICovXG5cdG1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24gZm9sbG93UmVmZXJlbmNlKGNhY2hlUm9vdCwgcmVmLCBtYXhSZWZGb2xsb3cpIHtcblx0ICAgIHZhciBjdXJyZW50ID0gY2FjaGVSb290O1xuXHQgICAgdmFyIHJlZlBhdGggPSByZWY7XG5cdCAgICB2YXIgZGVwdGggPSAtMTtcblx0ICAgIHZhciBsZW5ndGggPSByZWZQYXRoLmxlbmd0aDtcblx0ICAgIHZhciBrZXksIG5leHQsIHR5cGU7XG5cdCAgICB2YXIgcmVmZXJlbmNlQ291bnQgPSAwO1xuXHRcblx0ICAgIHdoaWxlICgrK2RlcHRoIDwgbGVuZ3RoKSB7XG5cdCAgICAgICAga2V5ID0gcmVmUGF0aFtkZXB0aF07XG5cdCAgICAgICAgbmV4dCA9IGN1cnJlbnRba2V5XTtcblx0ICAgICAgICB0eXBlID0gbmV4dCAmJiBuZXh0LiR0eXBlO1xuXHRcblx0ICAgICAgICBpZiAoIW5leHQgfHwgdHlwZSAmJiB0eXBlICE9PSAkcmVmKSB7XG5cdCAgICAgICAgICAgIGN1cnJlbnQgPSBuZXh0O1xuXHQgICAgICAgICAgICBicmVhaztcblx0ICAgICAgICB9XG5cdFxuXHQgICAgICAgIC8vIFNob3cgc3RvcHBlciBleGNlcHRpb24uICBUaGlzIHJvdXRlIGlzIG1hbGZvcm1lZC5cblx0ICAgICAgICBpZiAodHlwZSAmJiB0eXBlID09PSAkcmVmICYmIGRlcHRoICsgMSA8IGxlbmd0aCkge1xuXHQgICAgICAgICAgICB2YXIgZXJyID0gbmV3IEVycm9yKGVycm9ycy5pbm5lclJlZmVyZW5jZXMpO1xuXHQgICAgICAgICAgICBlcnIudGhyb3dUb05leHQgPSB0cnVlO1xuXHQgICAgICAgICAgICB0aHJvdyBlcnI7XG5cdCAgICAgICAgfVxuXHRcblx0ICAgICAgICAvLyBwb3RlbnRpYWxseSBmb2xsb3cgcmVmZXJlbmNlXG5cdCAgICAgICAgaWYgKGRlcHRoICsgMSA9PT0gbGVuZ3RoKSB7XG5cdCAgICAgICAgICAgIGlmICh0eXBlID09PSAkcmVmKSB7XG5cdCAgICAgICAgICAgICAgICBkZXB0aCA9IC0xO1xuXHQgICAgICAgICAgICAgICAgcmVmUGF0aCA9IG5leHQudmFsdWU7XG5cdCAgICAgICAgICAgICAgICBsZW5ndGggPSByZWZQYXRoLmxlbmd0aDtcblx0ICAgICAgICAgICAgICAgIG5leHQgPSBjYWNoZVJvb3Q7XG5cdCAgICAgICAgICAgICAgICByZWZlcmVuY2VDb3VudCsrO1xuXHQgICAgICAgICAgICB9XG5cdFxuXHQgICAgICAgICAgICBpZiAocmVmZXJlbmNlQ291bnQgPiBtYXhSZWZGb2xsb3cpIHtcblx0ICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihlcnJvcnMuY2lyY3VsYXJSZWZlcmVuY2UpO1xuXHQgICAgICAgICAgICB9XG5cdCAgICAgICAgfVxuXHQgICAgICAgIGN1cnJlbnQgPSBuZXh0O1xuXHQgICAgfVxuXHRcblx0ICAgIHJldHVybiBbY3VycmVudCwgY2xvbmVBcnJheShyZWZQYXRoKV07XG5cdH07XG5cdFxuXG5cbi8qKiovIH0sXG4vKiAxOSAqL1xuLyoqKi8gZnVuY3Rpb24obW9kdWxlLCBleHBvcnRzKSB7XG5cblx0Lyplc2xpbnQtZGlzYWJsZSovXG5cdG1vZHVsZS5leHBvcnRzID0ge1xuXHQgICAgaW5uZXJSZWZlcmVuY2VzOiAnUmVmZXJlbmNlcyB3aXRoIGlubmVyIHJlZmVyZW5jZXMgYXJlIG5vdCBhbGxvd2VkLicsXG5cdCAgICBjaXJjdWxhclJlZmVyZW5jZTogJ1RoZXJlIGFwcGVhcnMgdG8gYmUgYSBjaXJjdWxhciByZWZlcmVuY2UsIG1heGltdW0gcmVmZXJlbmNlIGZvbGxvd2luZyBleGNlZWRlZC4nXG5cdH07XG5cdFxuXG5cbi8qKiovIH0sXG4vKiAyMCAqL1xuLyoqKi8gZnVuY3Rpb24obW9kdWxlLCBleHBvcnRzKSB7XG5cblx0dmFyIG5vT3AgPSBmdW5jdGlvbiBub09wKCkge307XG5cdHZhciBlbXB0eURpc3Bvc2FibGUgPSB7ZGlzcG9zZTogbm9PcH07XG5cdFxuXHQvKipcblx0ICogQSBNb2RlbFJlc3BvbnNlIGlzIGEgY29udGFpbmVyIGZvciB0aGUgcmVzdWx0cyBvZiBhIGdldCwgc2V0LCBvciBjYWxsIG9wZXJhdGlvbiBwZXJmb3JtZWQgb24gYSBNb2RlbC4gVGhlIE1vZGVsUmVzcG9uc2UgcHJvdmlkZXMgbWV0aG9kcyB3aGljaCBjYW4gYmUgdXNlZCB0byBzcGVjaWZ5IHRoZSBvdXRwdXQgZm9ybWF0IG9mIHRoZSBkYXRhIHJldHJpZXZlZCBmcm9tIGEgTW9kZWwsIGFzIHdlbGwgYXMgaG93IHRoYXQgZGF0YSBpcyBkZWxpdmVyZWQuXG5cdCAqIEBjb25zdHJ1Y3RvciBNb2RlbFJlc3BvbnNlXG5cdCAqIEBhdWdtZW50cyBPYnNlcnZhYmxlXG5cdCovXG5cdGZ1bmN0aW9uIFN1YnNjcmliYWJsZShzdWJzY3JpYmUpIHtcblx0ICAgIHRoaXMuX3N1YnNjcmliZSA9IHN1YnNjcmliZTtcblx0fVxuXHRcblx0U3Vic2NyaWJhYmxlLnByb3RvdHlwZS5zdWJzY3JpYmUgPSBmdW5jdGlvbiBzdWJzY3JpYmUoYSwgYiwgYykge1xuXHQgICAgdmFyIG9ic2VydmVyID0gYTtcblx0ICAgIGlmICghb2JzZXJ2ZXIgfHwgdHlwZW9mIG9ic2VydmVyICE9PSAnb2JqZWN0Jykge1xuXHQgICAgICAgIG9ic2VydmVyID0ge1xuXHQgICAgICAgICAgICBvbk5leHQ6IGEgfHwgbm9PcCxcblx0ICAgICAgICAgICAgb25FcnJvcjogYiB8fCBub09wLFxuXHQgICAgICAgICAgICBvbkNvbXBsZXRlZDogYyB8fCBub09wXG5cdCAgICAgICAgfTtcblx0ICAgIH1cblx0ICAgIHZhciBzdWJzY3JpcHRpb24gPSB0aGlzLl9zdWJzY3JpYmUob2JzZXJ2ZXIpO1xuXHRcblx0ICAgIHN3aXRjaCAodHlwZW9mIHN1YnNjcmlwdGlvbikge1xuXHQgICAgICAgIGNhc2UgJ2Z1bmN0aW9uJzpcblx0ICAgICAgICAgICAgcmV0dXJuIHsgZGlzcG9zZTogc3Vic2NyaXB0aW9uIH07XG5cdCAgICAgICAgY2FzZSAnb2JqZWN0Jzpcblx0ICAgICAgICAgICAgcmV0dXJuIHN1YnNjcmlwdGlvbiB8fCBlbXB0eURpc3Bvc2FibGU7XG5cdCAgICAgICAgZGVmYXVsdDpcblx0ICAgICAgICAgICAgcmV0dXJuIGVtcHR5RGlzcG9zYWJsZTtcblx0ICAgIH1cblx0fTtcblx0XG5cdG1vZHVsZS5leHBvcnRzID0gU3Vic2NyaWJhYmxlO1xuXHRcblxuXG4vKioqLyB9LFxuLyogMjEgKi9cbi8qKiovIGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cykge1xuXG5cdHZhciBNRVNTQUdFID0gJ1RoZSBEYXRhU291cmNlQ2hhaW5lciByZXF1aXJlcyBhdCBsZWFzdCBvbmUgZGF0YVNvdXJjZSAnICtcblx0ICAgICAgICAgICAgICAnaW4gaXRzIGNvbnN0cnVjdG9yLic7XG5cdC8qKlxuXHQgKiBBIGRhdGEgc291cmNlIGNoYWluZXIgd2FzIGluaXRpYWxpemVkIHdpdGhvdXQgYW55IHNvdXJjZXMuXG5cdCAqXG5cdCAqIEBwcml2YXRlXG5cdCAqL1xuXHRmdW5jdGlvbiBBdExlYXN0T25lRGF0YVNvdXJjZUVycm9yKCkge1xuXHQgICAgdGhpcy5tZXNzYWdlID0gTUVTU0FHRTtcblx0ICAgIHRoaXMuc3RhY2sgPSAobmV3IEVycm9yKCkpLnN0YWNrO1xuXHR9XG5cdFxuXHRBdExlYXN0T25lRGF0YVNvdXJjZUVycm9yLnByb3RvdHlwZSA9IG5ldyBFcnJvcigpO1xuXHRBdExlYXN0T25lRGF0YVNvdXJjZUVycm9yLm1lc3NhZ2UgPSBNRVNTQUdFO1xuXHRcblx0bW9kdWxlLmV4cG9ydHMgPSBBdExlYXN0T25lRGF0YVNvdXJjZUVycm9yO1xuXHRcblxuXG4vKioqLyB9XG4vKioqKioqLyBdKTtcblxuXG4vKiogV0VCUEFDSyBGT09URVIgKipcbiAqKiBmYWxjb3ItZGF0YXNvdXJjZS1jaGFpbmVyLmpzXG4gKiovIiwiIFx0Ly8gVGhlIG1vZHVsZSBjYWNoZVxuIFx0dmFyIGluc3RhbGxlZE1vZHVsZXMgPSB7fTtcblxuIFx0Ly8gVGhlIHJlcXVpcmUgZnVuY3Rpb25cbiBcdGZ1bmN0aW9uIF9fd2VicGFja19yZXF1aXJlX18obW9kdWxlSWQpIHtcblxuIFx0XHQvLyBDaGVjayBpZiBtb2R1bGUgaXMgaW4gY2FjaGVcbiBcdFx0aWYoaW5zdGFsbGVkTW9kdWxlc1ttb2R1bGVJZF0pXG4gXHRcdFx0cmV0dXJuIGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdLmV4cG9ydHM7XG5cbiBcdFx0Ly8gQ3JlYXRlIGEgbmV3IG1vZHVsZSAoYW5kIHB1dCBpdCBpbnRvIHRoZSBjYWNoZSlcbiBcdFx0dmFyIG1vZHVsZSA9IGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdID0ge1xuIFx0XHRcdGV4cG9ydHM6IHt9LFxuIFx0XHRcdGlkOiBtb2R1bGVJZCxcbiBcdFx0XHRsb2FkZWQ6IGZhbHNlXG4gXHRcdH07XG5cbiBcdFx0Ly8gRXhlY3V0ZSB0aGUgbW9kdWxlIGZ1bmN0aW9uXG4gXHRcdG1vZHVsZXNbbW9kdWxlSWRdLmNhbGwobW9kdWxlLmV4cG9ydHMsIG1vZHVsZSwgbW9kdWxlLmV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pO1xuXG4gXHRcdC8vIEZsYWcgdGhlIG1vZHVsZSBhcyBsb2FkZWRcbiBcdFx0bW9kdWxlLmxvYWRlZCA9IHRydWU7XG5cbiBcdFx0Ly8gUmV0dXJuIHRoZSBleHBvcnRzIG9mIHRoZSBtb2R1bGVcbiBcdFx0cmV0dXJuIG1vZHVsZS5leHBvcnRzO1xuIFx0fVxuXG5cbiBcdC8vIGV4cG9zZSB0aGUgbW9kdWxlcyBvYmplY3QgKF9fd2VicGFja19tb2R1bGVzX18pXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLm0gPSBtb2R1bGVzO1xuXG4gXHQvLyBleHBvc2UgdGhlIG1vZHVsZSBjYWNoZVxuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5jID0gaW5zdGFsbGVkTW9kdWxlcztcblxuIFx0Ly8gX193ZWJwYWNrX3B1YmxpY19wYXRoX19cbiBcdF9fd2VicGFja19yZXF1aXJlX18ucCA9IFwiZGlzdC9cIjtcblxuIFx0Ly8gTG9hZCBlbnRyeSBtb2R1bGUgYW5kIHJldHVybiBleHBvcnRzXG4gXHRyZXR1cm4gX193ZWJwYWNrX3JlcXVpcmVfXygwKTtcblxuXG5cbi8qKiBXRUJQQUNLIEZPT1RFUiAqKlxuICoqIHdlYnBhY2svYm9vdHN0cmFwIGFkNzY5N2JkODY4NTJhZDY2NTFkXG4gKiovIiwibW9kdWxlLmV4cG9ydHMgPSByZXF1aXJlKCcuL0RhdGFTb3VyY2VDaGFpbmVyJyk7XG5cblxuXG4vKioqKioqKioqKioqKioqKipcbiAqKiBXRUJQQUNLIEZPT1RFUlxuICoqIC4vc3JjL2luZGV4LmpzXG4gKiogbW9kdWxlIGlkID0gMFxuICoqIG1vZHVsZSBjaHVua3MgPSAwXG4gKiovIiwidmFyIGdldFJlcXVlc3RDeWNsZSA9IHJlcXVpcmUoJy4vZ2V0UmVxdWVzdEN5Y2xlJyk7XG52YXIgU3Vic2NyaWJhYmxlID0gcmVxdWlyZSgnLi9TdWJzY3JpYmFibGUnKTtcbnZhciBBdExlYXN0T25lRGF0YVNvdXJjZUVycm9yID0gcmVxdWlyZSgnLi9lcnJvcnMvQXRMZWFzdE9uZURhdGFTb3VyY2VFcnJvcicpO1xuXG4vKipcbiAqIERhdGFTb3VyY2VDaGFpbmVyIHRha2VzIGluIGEgbGlzdCBvZiBkYXRhU291cmNlcyBhbmQgY2FsbHMgdGhlbSBvbmUgYXQgYSB0aW1lXG4gKiB1bnRpbCB0aGUgZ2V0L3NldC9jYWxsIG9wZXJhdGlvbiBoYXMgYmVlbiBzYXRpc2lmaWVkLiAgSWYgdGhlIGxpc3Qgb2Ygc291cmNlc1xuICogaGF2ZSBiZWVuIGV4aGF1c3RlZCwgdGhlbiB0aGUgc291cmNlIHdpbGwgZWl0aGVyIGVtaXQgdGhlIEpTT05HcmFwaEVudmVsb3BlXG4gKiB3aXRoIHVuaGFuZGxlZFBhdGhzIGtleSBvciBmb3J3YXJkIG9uICdmdW5jdGlvbiBkb2VzIG5vdCBleGlzdCcgZXJyb3IgKGNhbGxcbiAqIG9ubHkpLlxuICpcbiAqIFRoZSBvcmRlciBvZiBkYXRhU291cmNlIGNhbGxpbmcgaXMgbGlzdCBvcmRlcmluZy4gVGhlIGludGVyZmFjZSBjYW4gYmUgZm91bmRcbiAqIGhlcmU6IGh0dHA6Ly9uZXRmbGl4LmdpdGh1Yi5pby9mYWxjb3IvZG9jL0RhdGFTb3VyY2UuaHRtbFxuICpcbiAqIEBwYXJhbSB7QXJyYXkuPERhdGFTb3VyY2U+fSBzb3VyY2VzIC0gVGhlIGxpc3Qgb2Ygc291cmNlcyB0byBjYWxsLlxuICogQGF1Z21lbnRzIERhdGFTb3VyY2VcbiAqIEBwdWJsaWNcbiAqL1xudmFyIERhdGFTb3VyY2VDaGFpbmVyID0gZnVuY3Rpb24gRGF0YVNvdXJjZUNoYWluZXIoc291cmNlcykge1xuICAgIC8vIFRoZXJlIGhhcyB0byBiZSBhdCBsZWFzdCBvbmUgZGF0YVNvdXJjZS5cbiAgICBpZiAoIXNvdXJjZXMgfHwgc291cmNlcy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgdGhyb3cgbmV3IEF0TGVhc3RPbmVEYXRhU291cmNlRXJyb3IoKTtcbiAgICB9XG4gICAgdGhpcy5fc291cmNlcyA9IHNvdXJjZXM7XG59O1xuXG5EYXRhU291cmNlQ2hhaW5lci5wcm90b3R5cGUgPSB7XG4gICAgLyoqXG4gICAgICogQSBnZXQgcmVzcG9uc2UgaXMgY29uc2lkZXJlZCBfY29tcGxldGVkXyBiYXNlZCBvbiB0aGUgZm9sbG93aW5nIHRocmVlXG4gICAgICogY29uZGl0aW9uczpcbiAgICAgKiAtIFRoZSB1bmhhbmRsZWRQYXRocyBrZXkgaXMgZW1wdHkgb3Igbm9uLWV4aXN0ZW50LlxuICAgICAqIC0gVGhlIGNoYWluIG9mIGRhdGFTb3VyY2VzIGhhdmUgYmVlbiBleGhhdXN0ZWQuXG4gICAgICogLSBUaGVyZSB3YXMgYW4gYG9uRXJyb3JgIGZyb20gdGhlIGRhdGFTb3VyY2UuICBXZSBubyBsb25nZXIgaGF2ZSB0aGVcbiAgICAgKiAgIGNvbnRleHQgZm9yIGNoYWluaW5nLiAgQW4gb25FcnJvciBmcm9tIGEgZGF0YVNvdXJjZSBpcyBhIGNhdGFzdHJvcGhpY1xuICAgICAqICAgZXJyb3IsIG5vdCBhbiBlcnJvciB3aXRoaW4gdGhlIGRhdGFTb3VyY2UncyBqc29uR3JhcGhFbnZlbG9wZVxuICAgICAqICAgKGltYWdpbmUgYSA1MDAgZnJvbSB0aGUgSHR0cERhdGFTb3VyY2UpLlxuICAgICAqIEBwYXJhbSB7QXJyYXkuPFBhdGg+fSBwYXRocyAtXG4gICAgICovXG4gICAgZ2V0OiBmdW5jdGlvbiBnZXQocGF0aHMpIHtcbiAgICAgICAgdmFyIHNlbGYgPSB0aGlzO1xuICAgICAgICByZXR1cm4gbmV3IFN1YnNjcmliYWJsZShmdW5jdGlvbiBnZXRTdWJzY3JpYmUob2JzZXJ2ZXIpIHtcbiAgICAgICAgICAgIHZhciBzZWVkID0ge1xuICAgICAgICAgICAgICAgIGpzb25HcmFwaDoge31cbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIC8vIFBlcmZvcm1zIHRoZSBpbnRlcm5hbCBnZXQgcmVxdWVzdCBsb29wLlxuICAgICAgICAgICAgcmV0dXJuIGdldFJlcXVlc3RDeWNsZShzZWxmLl9zb3VyY2VzLCAwLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXRocywgc2VlZCwgb2JzZXJ2ZXIpO1xuICAgICAgICB9KTtcbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICogU2V0IHdpbGwgc2ltcGx5IHBhc3MgdGhyb3VnaCB0aGUgc2V0IGNvbW1hbmQgdG8gdGhlIGZpcnN0IGRhdGFTb3VyY2VcbiAgICAgKiBpbiB0aGUgY2hhaW4uXG4gICAgICogQHBhcmFtIHtKU09OR3JhcGhFbnZlbG9wZX0ganNvbkdyYXBoIC1cbiAgICAgKi9cbiAgICBzZXQ6IGZ1bmN0aW9uIHNldChqc29uR3JhcGgpIHtcbiAgICAgICAgdmFyIHNvdXJjZSA9IHRoaXMuX3NvdXJjZXNbMF07XG4gICAgICAgIHJldHVybiBzb3VyY2Uuc2V0KGpzb25HcmFwaCk7XG4gICAgfSxcblxuICAgIGNhbGw6IGZ1bmN0aW9uIGNhbGwoY2FsbFBhdGgsIGFyZ3MsIHN1ZmZpeGVzLCBwYXRocykge1xuICAgIH1cbn07XG5cbm1vZHVsZS5leHBvcnRzID0gRGF0YVNvdXJjZUNoYWluZXI7XG5cblxuXG4vKioqKioqKioqKioqKioqKipcbiAqKiBXRUJQQUNLIEZPT1RFUlxuICoqIC4vc3JjL0RhdGFTb3VyY2VDaGFpbmVyLmpzXG4gKiogbW9kdWxlIGlkID0gMVxuICoqIG1vZHVsZSBjaHVua3MgPSAwXG4gKiovIiwidmFyIEFzc2lnbmFibGVEaXNwb3NhYmxlID0gcmVxdWlyZSgnLi9Bc3NpZ25hYmxlRGlzcG9zYWJsZScpO1xudmFyIEVNUFRZX0RJU1BPU0FCTEUgPSB7ZGlzcG9zZTogZnVuY3Rpb24gZW1wdHkoKSB7fX07XG52YXIgbWVyZ2VKU09OR3JhcGhFbnZlbG9wZXMgPSByZXF1aXJlKCcuL2NhY2hlL21lcmdlSlNPTkdyYXBoRW52ZWxvcGVzJyk7XG52YXIgcGF0aFV0aWxzID0gcmVxdWlyZSgnZmFsY29yLXBhdGgtdXRpbHMnKTtcbnZhciBvcHRpbWl6ZVBhdGhTZXRzID0gcGF0aFV0aWxzLm9wdGltaXplUGF0aFNldHM7XG52YXIgY29sbGFwc2UgPSBwYXRoVXRpbHMuY29sbGFwc2U7XG52YXIgTUFYX1JFRkVSRU5DRVNfVE9fRk9MTE9XID0gMTA7XG5cbi8qKlxuICogUGVyZm9ybXMgdGhlIHJlcXVlc3Rpbmcgb2YgdGhlIGRhdGEgZnJvbSBlYWNoIGRhdGFTb3VyY2UgdW50aWwgZXhoYXVzdGVkXG4gKiBvciBjb21wbGV0ZWQuXG4gKiBAcHJpdmF0ZVxuICovXG4vLyBUT0RPOiBDbGVhbiB1cCB0aGlzIGZ1bmN0aW9uIGFzIGl0cyB2ZXJ5IGxhcmdlLlxubW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiBnZXRSZXF1ZXN0Q3ljbGUoc291cmNlcywgc291cmNlSW5kZXgsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZW1haW5pbmdQYXRoc0FyZywgc2VlZCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9ic2VydmVyLCBkaXNwb3NhYmxlKSB7XG5cbiAgICB2YXIgY3VycmVudFNvdXJjZSA9IHNvdXJjZXNbc291cmNlSW5kZXhdO1xuICAgIHZhciByZW1haW5pbmdQYXRocyA9IHJlbWFpbmluZ1BhdGhzQXJnO1xuICAgIGRpc3Bvc2FibGUgPSBkaXNwb3NhYmxlIHx8IG5ldyBBc3NpZ25hYmxlRGlzcG9zYWJsZSgpO1xuXG4gICAgLy8gSWYgdGhlIHNvdXJjZSBpbmRleCBpcyBncmVhdGVyIHRoYW4gMSB0aGVuIHdlIG5lZWQgdG8gYXR0ZW1wdCB0b1xuICAgIC8vIG9wdGltaXplIC8gcmVkdWNlIHJlbWFpbmluZyBwYXRocyB3aXRoIG91ciBwYXJ0aWFsbHkgY29tcGxldGUgY2FjaGUuXG4gICAgaWYgKHNvdXJjZUluZGV4ID4gMSAmJiByZW1haW5pbmdQYXRocyAmJiByZW1haW5pbmdQYXRocy5sZW5ndGgpIHtcbiAgICAgICAgcmVtYWluaW5nUGF0aHMgPSBvcHRpbWl6ZVBhdGhTZXRzKHNlZWQuanNvbkdyYXBoLCByZW1haW5pbmdQYXRocyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIE1BWF9SRUZFUkVOQ0VTX1RPX0ZPTExPVyk7XG4gICAgICAgIGlmIChyZW1haW5pbmdQYXRocy5sZW5ndGgpIHtcbiAgICAgICAgICAgIHJlbWFpbmluZ1BhdGhzID0gY29sbGFwc2UocmVtYWluaW5nUGF0aHMpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgLy8gU291cmNlcyBvciByZW1haW5pbmcgcGF0aHMgaGF2ZSBiZWVuIGV4aGF1c3RlZC4gIFRpbWUgdG8gb25OZXh0IC9cbiAgICAvLyBvbkNvbXBsZXRlXG4gICAgaWYgKCFjdXJyZW50U291cmNlIHx8ICFyZW1haW5pbmdQYXRocyB8fCByZW1haW5pbmdQYXRocy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgc2VlZC51bmhhbmRsZWRQYXRocyA9IHJlbWFpbmluZ1BhdGhzO1xuICAgICAgICBvYnNlcnZlci5vbk5leHQoc2VlZCk7XG4gICAgICAgIG9ic2VydmVyLm9uQ29tcGxldGVkKCk7XG4gICAgICAgIGRpc3Bvc2FibGUuY3VycmVudERpc3Bvc2FibGUgPSBFTVBUWV9ESVNQT1NBQkxFO1xuICAgICAgICByZXR1cm4gZGlzcG9zYWJsZTtcbiAgICB9XG5cbiAgICAvLyBSZXF1ZXN0IGZyb20gdGhlIGN1cnJlbnQgc291cmNlLlxuICAgIHZhciBqc29uR3JhcGhGcm9tU291cmNlO1xuICAgIGRpc3Bvc2FibGUuY3VycmVudERpc3Bvc2FibGUgPSBjdXJyZW50U291cmNlLlxuICAgICAgICBnZXQocmVtYWluaW5nUGF0aHMpLlxuICAgICAgICBzdWJzY3JpYmUoXG4gICAgICAgICAgICAvLyBBbiBvbk5leHQgc2ltcGx5IGp1c3QgaG9sZHMgb250byB0aGUgdmFsdWUgdGhhdCB3YXMgZ2l2ZW5cbiAgICAgICAgICAgIC8vIGFuZCB3aWxsIHBlcmZvcm0gdGhlIG1lcmdpbmcgd2hlbiBjb21wbGV0ZS5cbiAgICAgICAgICAgIGZ1bmN0aW9uIG9uTmV4dChqc29uR3JhcGhFbnZlbG9wKSB7XG4gICAgICAgICAgICAgICAganNvbkdyYXBoRnJvbVNvdXJjZSA9IGpzb25HcmFwaEVudmVsb3A7XG4gICAgICAgICAgICB9LFxuXG4gICAgICAgICAgICAvLyBUaGlzIGlzIHRoZSBjYXNlIG9mIHRoZSBjYXRhc3Ryb3BoaWMgZXJyb3IuICBXZSBhcmUgbm8gbG9uZ2VyXG4gICAgICAgICAgICAvLyBhYmxlIHRvIHJlY3Vyc2Ugb24gb3VyIGRhdGFTb3VyY2VzLiAgSWYgdGhlcmUgYXJlIHJlbWFpbmluZ1xuICAgICAgICAgICAgLy8gdmFsdWVzIC8gaGF2ZSBiZWVuIG9uTmV4dCdkIHRoZW4gd2UgbmVlZCB0byBtZXJnZSBhbmQgcmVwb3J0XG4gICAgICAgICAgICAvLyB0aGVuIG9uRXJyb3IuXG4gICAgICAgICAgICBmdW5jdGlvbiBvbkVycm9yKGRhdGFTb3VyY2VFcnJvcikge1xuICAgICAgICAgICAgICAgIC8vIEV4aXQgY29uZGl0aW9uLlxuICAgICAgICAgICAgICAgIGlmIChkaXNwb3NhYmxlLmRpc3Bvc2VkKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAvLyBNZXJnZSBhbmQgb25OZXh0IHRoZSBzZWVkIHZhbHVlIHRvIHRoZSBvYnNlcnZlci5cbiAgICAgICAgICAgICAgICBpZiAoc291cmNlSW5kZXggPiAwIHx8IGpzb25HcmFwaEZyb21Tb3VyY2UpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGpzb25HcmFwaEZyb21Tb3VyY2UpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG1lcmdlSlNPTkdyYXBoRW52ZWxvcGVzKHNlZWQsIGpzb25HcmFwaEZyb21Tb3VyY2UpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIG9ic2VydmVyLm9uTmV4dChzZWVkKTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAvLyBBc3N1bWVzIHRoYXQgdGhlIGFycmF5IGlzIGFuIGFycmF5IG9mIHBhdGggdmFsdWVzLlxuICAgICAgICAgICAgICAgIGlmIChBcnJheS5pc0FycmF5KGRhdGFTb3VyY2VFcnJvcikpIHtcbiAgICAgICAgICAgICAgICAgICAgb2JzZXJ2ZXIub25FcnJvcihkYXRhU291cmNlRXJyb3IpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgb2JzZXJ2ZXIub25FcnJvcihyZW1haW5pbmdQYXRocy5tYXAoZnVuY3Rpb24gdG9QVihwYXRoKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBwYXRoOiBwYXRoLFxuICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWU6IGRhdGFTb3VyY2VFcnJvclxuICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIH0pKTtcbiAgICAgICAgICAgIH0sXG5cbiAgICAgICAgICAgIC8vIFdlIGhhdmUgY29tcGxldGVkIHN1Y2Nlc3NmdWxseS4gIFdoYXRldmVyIGhhcyBiZWVuIG9uTmV4dCBzaG91bGRcbiAgICAgICAgICAgIC8vIGJlIG1lcmdlZCBpbnRvIHRoZSBlbnZlbG9wZS4gIElmIHRoZXJlIGFyZSB1bmhhbmRsZWRQYXRocyB0aGVuXG4gICAgICAgICAgICAvLyB3ZSBuZWVkIHRvIHJlY3Vyc2UsIGVsc2Ugb25OZXh0IC8gb25Db21wbGV0ZWQuXG4gICAgICAgICAgICBmdW5jdGlvbiBvbkNvbXBsZXRlZCgpIHtcbiAgICAgICAgICAgICAgICAvLyBFeGl0IGNvbmRpdGlvbi5cbiAgICAgICAgICAgICAgICBpZiAoZGlzcG9zYWJsZS5kaXNwb3NlZCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgLy8gV2UgbmVlZCB0byBtZXJnZSB0aGUgcmVzdWx0cyBpbnRvIG91ciBzZWVkLCBpZiB0aGUgc291cmNlXG4gICAgICAgICAgICAgICAgLy8gaXMgdGhlIHNlY29uZCBvciBsYXRlciBzb3VyY2UuXG4gICAgICAgICAgICAgICAgaWYgKHNvdXJjZUluZGV4ID09PSAwKSB7XG4gICAgICAgICAgICAgICAgICAgIHNlZWQgPSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBqc29uR3JhcGg6IGpzb25HcmFwaEZyb21Tb3VyY2UuanNvbkdyYXBoXG4gICAgICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIG1lcmdlSlNPTkdyYXBoRW52ZWxvcGVzKHNlZWQsIGpzb25HcmFwaEZyb21Tb3VyY2UpO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIC8vIGFyZSB0aGVyZSB1bmhhbmRsZWRQYXRocz9cbiAgICAgICAgICAgICAgICB2YXIgdW5oYW5kbGVkUGF0aHMgPSBqc29uR3JhcGhGcm9tU291cmNlLnVuaGFuZGxlZFBhdGhzO1xuICAgICAgICAgICAgICAgIGlmICh1bmhhbmRsZWRQYXRocyAmJiB1bmhhbmRsZWRQYXRocy5sZW5ndGgpIHtcblxuICAgICAgICAgICAgICAgICAgICAvLyBBc3luYyBSZXF1ZXN0IFJlY3Vyc2lvbi5cbiAgICAgICAgICAgICAgICAgICAgZ2V0UmVxdWVzdEN5Y2xlKHNvdXJjZXMsIHNvdXJjZUluZGV4ICsgMSwgdW5oYW5kbGVkUGF0aHMsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWVkLCBvYnNlcnZlciwgZGlzcG9zYWJsZSk7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgLy8gV2UgaGF2ZSBmaW5pc2hlZCBoZXJlLlxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBvYnNlcnZlci5vbk5leHQoc2VlZCk7XG4gICAgICAgICAgICAgICAgICAgIG9ic2VydmVyLm9uQ29tcGxldGVkKCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG5cblxuICAgIHJldHVybiBkaXNwb3NhYmxlO1xufTtcblxuXG5cbi8qKioqKioqKioqKioqKioqKlxuICoqIFdFQlBBQ0sgRk9PVEVSXG4gKiogLi9zcmMvZ2V0UmVxdWVzdEN5Y2xlLmpzXG4gKiogbW9kdWxlIGlkID0gMlxuICoqIG1vZHVsZSBjaHVua3MgPSAwXG4gKiovIiwiLyoqXG4gKiBXaWxsIGFsbG93IGZvciBzdGF0ZSB0cmFja2luZyBvZiB0aGUgY3VycmVudCBkaXNwb3NhYmxlLiAgQWxzbyBmdWxmaWxscyB0aGVcbiAqIGRpc3Bvc2FibGUgaW50ZXJmYWNlLlxuICogQHByaXZhdGVcbiAqL1xudmFyIEFzc2lnbmFibGVEaXNwb3NhYmxlID0gZnVuY3Rpb24gQXNzaWduYWJsZURpc3Bvc2FibGUoZGlzb3NhYmxlQ2FsbGJhY2spIHtcbiAgICB0aGlzLmRpc3Bvc2VkID0gZmFsc2U7XG4gICAgdGhpcy5jdXJyZW50RGlzcG9zYWJsZSA9IGRpc29zYWJsZUNhbGxiYWNrO1xufTtcblxuQXNzaWduYWJsZURpc3Bvc2FibGUucHJvdG90eXBlID0ge1xuXG4gICAgLyoqXG4gICAgICogRGlzcG9zZXMgb2YgdGhlIGN1cnJlbnQgZGlzcG9zYWJsZS4gIFRoaXMgd291bGQgYmUgdGhlIGdldFJlcXVlc3RDeWNsZVxuICAgICAqIGRpc3Bvc2FibGUuXG4gICAgICovXG4gICAgZGlzcG9zZTogZnVuY3Rpb24gZGlzcG9zZSgpIHtcbiAgICAgICAgaWYgKHRoaXMuZGlzcG9zZWQgfHwgIXRoaXMuY3VycmVudERpc3Bvc2FibGUpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLmRpc3Bvc2VkID0gdHJ1ZTtcblxuICAgICAgICAvLyBJZiB0aGUgY3VycmVudCBkaXNwb3NhYmxlIGZ1bGZpbGxzIHRoZSBkaXNwb3NhYmxlIGludGVyZmFjZSBvciBqdXN0XG4gICAgICAgIC8vIGEgZGlzcG9zYWJsZSBmdW5jdGlvbi5cbiAgICAgICAgdmFyIGN1cnJlbnREaXNwb3NhYmxlID0gdGhpcy5jdXJyZW50RGlzcG9zYWJsZTtcbiAgICAgICAgaWYgKGN1cnJlbnREaXNwb3NhYmxlLmRpc3Bvc2UpIHtcbiAgICAgICAgICAgIGN1cnJlbnREaXNwb3NhYmxlLmRpc3Bvc2UoKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgY3VycmVudERpc3Bvc2FibGUoKTtcbiAgICAgICAgfVxuICAgIH1cbn07XG5cbm1vZHVsZS5leHBvcnRzID0gQXNzaWduYWJsZURpc3Bvc2FibGU7XG5cblxuXG5cbi8qKioqKioqKioqKioqKioqKlxuICoqIFdFQlBBQ0sgRk9PVEVSXG4gKiogLi9zcmMvQXNzaWduYWJsZURpc3Bvc2FibGUuanNcbiAqKiBtb2R1bGUgaWQgPSAzXG4gKiogbW9kdWxlIGNodW5rcyA9IDBcbiAqKi8iLCIvLyBNZXJnZXMgdGhlIGpzb25HcmFwaEVudmVsb3Blcy5cbmZ1bmN0aW9uIG1lcmdlSlNPTkdyYXBoRW52ZWxvcGVzKGpzb25HcmFwaENhY2hlLCBpbmNvbWluZ0pTT05HcmFwaEVudmVsb3BlKSB7XG4gICAgbWVyZ2VKU09OR3JhcGgoanNvbkdyYXBoQ2FjaGUuanNvbkdyYXBoLFxuICAgICAgICAgICAgICAgICAgIGluY29taW5nSlNPTkdyYXBoRW52ZWxvcGUuanNvbkdyYXBoKTtcblxuICAgIC8vIE5PVEU6IE5vIG5lZWQgdG8gY29weSBwYXRocyBiZWNhdXNlIFwicGF0aHNcIiBkbyBub3QgbmVlZCB0byBleGlzdCBvblxuICAgIC8vIGRhdGFTb3VyY2UgcmVzcG9uc2VzLlxufVxuXG5mdW5jdGlvbiBtZXJnZUpTT05HcmFwaChqc29uR3JhcGhUb01lcmdlSW50bywgY2FjaGVUb01lcmdlRnJvbSxcbiAgICAgICAgICAgICAgICAgICBmcm9tUGFyZW50Q2FjaGUsIGZyb21LZXkpIHtcblxuXG4gICAgLy8gVGhlIGJhc2UgY2FzZSBpcyB3aGVuIHRoZSBjdXJyZW50IGNhY2hlIHBvc2l0aW9uIGlzIGEgbGVhZiBub2RlLiAgV2hpY2hcbiAgICAvLyBpcyBhIG5vbiBvYmplY3QgLyBudWxsIG9yIHRoZXJlIGlzIGEgJHR5cGUga2V5LlxuICAgIGlmIChjYWNoZVRvTWVyZ2VGcm9tLiR0eXBlIHx8XG4gICAgICAgIHR5cGVvZiBjYWNoZVRvTWVyZ2VGcm9tICE9PSAnb2JqZWN0JyB8fFxuICAgICAgICBjYWNoZVRvTWVyZ2VGcm9tID09PSBudWxsKSB7XG5cbiAgICAgICAgZnJvbVBhcmVudENhY2hlW2Zyb21LZXldID0gY2FjaGVUb01lcmdlRnJvbTtcbiAgICAgICAgcmV0dXJuO1xuICAgIH1cblxuXG4gICAgLy8gSW5kdWN0aXZlIGNhc2U6IGl0ZXJhdGUgb24gYWxsIHRoZSBrZXlzIGFuZCBwZXJmb3JtIGEgc2ltcGxlIG1lcmdlLlxuICAgIHZhciBrZXlzID0gT2JqZWN0LmtleXMoY2FjaGVUb01lcmdlRnJvbSk7XG4gICAgdmFyIGksIGxlbjtcblxuICAgIGZvciAoaSA9IDAsIGxlbiA9IGtleXMubGVuZ3RoOyBpIDwgbGVuOyArK2kpIHtcbiAgICAgICAgdmFyIGtleSA9IGtleXNbaV07XG4gICAgICAgIGlmICghanNvbkdyYXBoVG9NZXJnZUludG9ba2V5XSkge1xuICAgICAgICAgICAganNvbkdyYXBoVG9NZXJnZUludG9ba2V5XSA9IHt9O1xuICAgICAgICB9XG5cbiAgICAgICAgbWVyZ2VKU09OR3JhcGgoanNvbkdyYXBoVG9NZXJnZUludG9ba2V5XSwgY2FjaGVUb01lcmdlRnJvbVtrZXldLFxuICAgICAgICAgICAgICAgICAgICAgICBqc29uR3JhcGhUb01lcmdlSW50bywga2V5KTtcbiAgICB9XG59XG5cbm1vZHVsZS5leHBvcnRzID0gbWVyZ2VKU09OR3JhcGhFbnZlbG9wZXM7XG5cblxuXG4vKioqKioqKioqKioqKioqKipcbiAqKiBXRUJQQUNLIEZPT1RFUlxuICoqIC4vc3JjL2NhY2hlL21lcmdlSlNPTkdyYXBoRW52ZWxvcGVzLmpzXG4gKiogbW9kdWxlIGlkID0gNFxuICoqIG1vZHVsZSBjaHVua3MgPSAwXG4gKiovIiwibW9kdWxlLmV4cG9ydHMgPSB7XG4gICAgaXRlcmF0ZUtleVNldDogcmVxdWlyZSgnLi9pdGVyYXRlS2V5U2V0JyksXG4gICAgdG9UcmVlOiByZXF1aXJlKCcuL3RvVHJlZScpLFxuICAgIHRvVHJlZVdpdGhVbmlvbjogcmVxdWlyZSgnLi90b1RyZWVXaXRoVW5pb24nKSxcbiAgICBwYXRoc0NvbXBsZW1lbnRGcm9tVHJlZTogcmVxdWlyZSgnLi9wYXRoc0NvbXBsZW1lbnRGcm9tVHJlZScpLFxuICAgIHBhdGhzQ29tcGxlbWVudEZyb21MZW5ndGhUcmVlOiByZXF1aXJlKCcuL3BhdGhzQ29tcGxlbWVudEZyb21MZW5ndGhUcmVlJyksXG4gICAgaGFzSW50ZXJzZWN0aW9uOiByZXF1aXJlKCcuL2hhc0ludGVyc2VjdGlvbicpLFxuICAgIHRvUGF0aHM6IHJlcXVpcmUoJy4vdG9QYXRocycpLFxuICAgIGNvbGxhcHNlOiByZXF1aXJlKCcuL2NvbGxhcHNlJyksXG4gICAgb3B0aW1pemVQYXRoU2V0czogcmVxdWlyZSgnLi9vcHRpbWl6ZVBhdGhTZXRzJylcbn07XG5cblxuXG4vKioqKioqKioqKioqKioqKipcbiAqKiBXRUJQQUNLIEZPT1RFUlxuICoqIC4vfi9mYWxjb3ItcGF0aC11dGlscy9saWIvaW5kZXguanNcbiAqKiBtb2R1bGUgaWQgPSA1XG4gKiogbW9kdWxlIGNodW5rcyA9IDBcbiAqKi8iLCJ2YXIgaXNBcnJheSA9IEFycmF5LmlzQXJyYXk7XG5cbi8qKlxuICogVGFrZXMgaW4gYSBrZXlTZXQgYW5kIGEgbm90ZSBhdHRlbXB0cyB0byBpdGVyYXRlIG92ZXIgaXQuXG4gKiBJZiB0aGUgdmFsdWUgaXMgYSBwcmltaXRpdmUsIHRoZSBrZXkgd2lsbCBiZSByZXR1cm5lZCBhbmQgdGhlIG5vdGUgd2lsbFxuICogYmUgbWFya2VkIGRvbmVcbiAqIElmIHRoZSB2YWx1ZSBpcyBhbiBvYmplY3QsIHRoZW4gZWFjaCB2YWx1ZSBvZiB0aGUgcmFuZ2Ugd2lsbCBiZSByZXR1cm5lZFxuICogYW5kIHdoZW4gZmluaXNoZWQgdGhlIG5vdGUgd2lsbCBiZSBtYXJrZWQgZG9uZS5cbiAqIElmIHRoZSB2YWx1ZSBpcyBhbiBhcnJheSwgZWFjaCB2YWx1ZSB3aWxsIGJlIGl0ZXJhdGVkIG92ZXIsIGlmIGFueSBvZiB0aGVcbiAqIGlubmVyIHZhbHVlcyBhcmUgcmFuZ2VzLCB0aG9zZSB3aWxsIGJlIGl0ZXJhdGVkIG92ZXIuICBXaGVuIGZ1bGx5IGRvbmUsXG4gKiB0aGUgbm90ZSB3aWxsIGJlIG1hcmtlZCBkb25lLlxuICpcbiAqIEBwYXJhbSB7T2JqZWN0fEFycmF5fFN0cmluZ3xOdW1iZXJ9IGtleVNldCAtXG4gKiBAcGFyYW0ge09iamVjdH0gbm90ZSAtIFRoZSBub24gZmlsbGVkIG5vdGVcbiAqIEByZXR1cm5zIHtTdHJpbmd8TnVtYmVyfHVuZGVmaW5lZH0gLSBUaGUgY3VycmVudCBpdGVyYXRpb24gdmFsdWUuXG4gKiBJZiB1bmRlZmluZWQsIHRoZW4gdGhlIGtleVNldCBpcyBlbXB0eVxuICogQHB1YmxpY1xuICovXG5tb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uIGl0ZXJhdGVLZXlTZXQoa2V5U2V0LCBub3RlKSB7XG4gICAgaWYgKG5vdGUuaXNBcnJheSA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIGluaXRpYWxpemVOb3RlKGtleVNldCwgbm90ZSk7XG4gICAgfVxuXG4gICAgLy8gQXJyYXkgaXRlcmF0aW9uXG4gICAgaWYgKG5vdGUuaXNBcnJheSkge1xuICAgICAgICB2YXIgbmV4dFZhbHVlO1xuXG4gICAgICAgIC8vIEN5Y2xlIHRocm91Z2ggdGhlIGFycmF5IGFuZCBwbHVjayBvdXQgdGhlIG5leHQgdmFsdWUuXG4gICAgICAgIGRvIHtcbiAgICAgICAgICAgIGlmIChub3RlLmxvYWRlZCAmJiBub3RlLnJhbmdlT2Zmc2V0ID4gbm90ZS50bykge1xuICAgICAgICAgICAgICAgICsrbm90ZS5hcnJheU9mZnNldDtcbiAgICAgICAgICAgICAgICBub3RlLmxvYWRlZCA9IGZhbHNlO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB2YXIgaWR4ID0gbm90ZS5hcnJheU9mZnNldCwgbGVuZ3RoID0ga2V5U2V0Lmxlbmd0aDtcbiAgICAgICAgICAgIGlmIChpZHggPj0gbGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgbm90ZS5kb25lID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdmFyIGVsID0ga2V5U2V0W25vdGUuYXJyYXlPZmZzZXRdO1xuICAgICAgICAgICAgdmFyIHR5cGUgPSB0eXBlb2YgZWw7XG5cbiAgICAgICAgICAgIC8vIElubmVyIHJhbmdlIGl0ZXJhdGlvbi5cbiAgICAgICAgICAgIGlmICh0eXBlID09PSAnb2JqZWN0Jykge1xuICAgICAgICAgICAgICAgIGlmICghbm90ZS5sb2FkZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgaW5pdGlhbGl6ZVJhbmdlKGVsLCBub3RlKTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAvLyBFbXB0eSB0by9mcm9tXG4gICAgICAgICAgICAgICAgaWYgKG5vdGUuZW1wdHkpIHtcbiAgICAgICAgICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgbmV4dFZhbHVlID0gbm90ZS5yYW5nZU9mZnNldCsrO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBQcmltaXRpdmUgaXRlcmF0aW9uIGluIGFycmF5LlxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgKytub3RlLmFycmF5T2Zmc2V0O1xuICAgICAgICAgICAgICAgIG5leHRWYWx1ZSA9IGVsO1xuICAgICAgICAgICAgfVxuICAgICAgICB9IHdoaWxlIChuZXh0VmFsdWUgPT09IHVuZGVmaW5lZCk7XG5cbiAgICAgICAgcmV0dXJuIG5leHRWYWx1ZTtcbiAgICB9XG5cbiAgICAvLyBSYW5nZSBpdGVyYXRpb25cbiAgICBlbHNlIGlmIChub3RlLmlzT2JqZWN0KSB7XG4gICAgICAgIGlmICghbm90ZS5sb2FkZWQpIHtcbiAgICAgICAgICAgIGluaXRpYWxpemVSYW5nZShrZXlTZXQsIG5vdGUpO1xuICAgICAgICB9XG4gICAgICAgIGlmIChub3RlLnJhbmdlT2Zmc2V0ID4gbm90ZS50bykge1xuICAgICAgICAgICAgbm90ZS5kb25lID0gdHJ1ZTtcbiAgICAgICAgICAgIHJldHVybiB1bmRlZmluZWQ7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gbm90ZS5yYW5nZU9mZnNldCsrO1xuICAgIH1cblxuICAgIC8vIFByaW1pdGl2ZSB2YWx1ZVxuICAgIGVsc2Uge1xuICAgICAgICBub3RlLmRvbmUgPSB0cnVlO1xuICAgICAgICByZXR1cm4ga2V5U2V0O1xuICAgIH1cbn07XG5cbmZ1bmN0aW9uIGluaXRpYWxpemVSYW5nZShrZXksIG1lbW8pIHtcbiAgICB2YXIgZnJvbSA9IG1lbW8uZnJvbSA9IGtleS5mcm9tIHx8IDA7XG4gICAgdmFyIHRvID0gbWVtby50byA9IGtleS50byB8fFxuICAgICAgICAodHlwZW9mIGtleS5sZW5ndGggPT09ICdudW1iZXInICYmXG4gICAgICAgIG1lbW8uZnJvbSArIGtleS5sZW5ndGggLSAxIHx8IDApO1xuICAgIG1lbW8ucmFuZ2VPZmZzZXQgPSBtZW1vLmZyb207XG4gICAgbWVtby5sb2FkZWQgPSB0cnVlO1xuICAgIGlmIChmcm9tID4gdG8pIHtcbiAgICAgICAgbWVtby5lbXB0eSA9IHRydWU7XG4gICAgfVxufVxuXG5mdW5jdGlvbiBpbml0aWFsaXplTm90ZShrZXksIG5vdGUpIHtcbiAgICBub3RlLmRvbmUgPSBmYWxzZTtcbiAgICB2YXIgaXNPYmplY3QgPSBub3RlLmlzT2JqZWN0ID0gISEoa2V5ICYmIHR5cGVvZiBrZXkgPT09ICdvYmplY3QnKTtcbiAgICBub3RlLmlzQXJyYXkgPSBpc09iamVjdCAmJiBpc0FycmF5KGtleSk7XG4gICAgbm90ZS5hcnJheU9mZnNldCA9IDA7XG59XG5cblxuXG4vKioqKioqKioqKioqKioqKipcbiAqKiBXRUJQQUNLIEZPT1RFUlxuICoqIC4vfi9mYWxjb3ItcGF0aC11dGlscy9saWIvaXRlcmF0ZUtleVNldC5qc1xuICoqIG1vZHVsZSBpZCA9IDZcbiAqKiBtb2R1bGUgY2h1bmtzID0gMFxuICoqLyIsInZhciBpdGVyYXRlS2V5U2V0ID0gcmVxdWlyZSgnLi8uLi9saWIvaXRlcmF0ZUtleVNldCcpO1xudmFyIGlzQXJyYXkgPSBBcnJheS5pc0FycmF5O1xuXG4vKipcbiAqIEBwYXJhbSB7QXJyYXl9IHBhdGhzIC1cbiAqIEByZXR1cm5zIHtPYmplY3R9IC1cbiAqL1xubW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiB0b1RyZWUocGF0aHMpIHtcbiAgICByZXR1cm4gcGF0aHMucmVkdWNlKGZ1bmN0aW9uKGFjYywgcGF0aCkge1xuICAgICAgICBpbm5lclRvVHJlZShhY2MsIHBhdGgsIDApO1xuICAgICAgICByZXR1cm4gYWNjO1xuICAgIH0sIHt9KTtcbn07XG5cbmZ1bmN0aW9uIGlubmVyVG9UcmVlKHNlZWQsIHBhdGgsIGRlcHRoKSB7XG5cbiAgICB2YXIga2V5U2V0ID0gcGF0aFtkZXB0aF07XG4gICAgdmFyIGl0ZXJhdG9yTm90ZSA9IHt9O1xuICAgIHZhciBrZXk7XG4gICAgdmFyIG5leHREZXB0aCA9IGRlcHRoICsgMTtcblxuICAgIGtleSA9IGl0ZXJhdGVLZXlTZXQoa2V5U2V0LCBpdGVyYXRvck5vdGUpO1xuXG4gICAgZG8ge1xuXG4gICAgICAgIHZhciBuZXh0ID0gc2VlZFtrZXldO1xuICAgICAgICBpZiAoIW5leHQpIHtcbiAgICAgICAgICAgIGlmIChuZXh0RGVwdGggPT09IHBhdGgubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgc2VlZFtrZXldID0gbnVsbDtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgbmV4dCA9IHNlZWRba2V5XSA9IHt9O1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgaWYgKG5leHREZXB0aCA8IHBhdGgubGVuZ3RoKSB7XG4gICAgICAgICAgICBpbm5lclRvVHJlZShuZXh0LCBwYXRoLCBuZXh0RGVwdGgpO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKCFpdGVyYXRvck5vdGUuZG9uZSkge1xuICAgICAgICAgICAga2V5ID0gaXRlcmF0ZUtleVNldChrZXlTZXQsIGl0ZXJhdG9yTm90ZSk7XG4gICAgICAgIH1cbiAgICB9IHdoaWxlICghaXRlcmF0b3JOb3RlLmRvbmUpO1xufVxuXG5cblxuXG4vKioqKioqKioqKioqKioqKipcbiAqKiBXRUJQQUNLIEZPT1RFUlxuICoqIC4vfi9mYWxjb3ItcGF0aC11dGlscy9saWIvdG9UcmVlLmpzXG4gKiogbW9kdWxlIGlkID0gN1xuICoqIG1vZHVsZSBjaHVua3MgPSAwXG4gKiovIiwidmFyIGhhc0ludGVyc2VjdGlvbiA9IHJlcXVpcmUoJy4vaGFzSW50ZXJzZWN0aW9uJyk7XG5cbi8qKlxuICogQ29tcGFyZXMgdGhlIHBhdGhzIHBhc3NlZCBpbiB3aXRoIHRoZSB0cmVlLiAgQW55IG9mIHRoZSBwYXRocyB0aGF0IGFyZSBpblxuICogdGhlIHRyZWUgd2lsbCBiZSBzdHJpcHBlZCBmcm9tIHRoZSBwYXRocy5cbiAqXG4gKiAqKkRvZXMgbm90IG11dGF0ZSoqIHRoZSBpbmNvbWluZyBwYXRocyBvYmplY3QuXG4gKiAqKlByb3BlciBzdWJzZXQqKiBvbmx5IG1hdGNoaW5nLlxuICpcbiAqIEBwYXJhbSB7QXJyYXl9IHBhdGhzIC0gQSBsaXN0IG9mIHBhdGhzIChjb21wbGV4IG9yIHNpbXBsZSkgdG8gc3RyaXAgdGhlXG4gKiBpbnRlcnNlY3Rpb25cbiAqIEBwYXJhbSB7T2JqZWN0fSB0cmVlIC1cbiAqIEBwdWJsaWNcbiAqL1xubW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiBwYXRoc0NvbXBsZW1lbnRGcm9tVHJlZShwYXRocywgdHJlZSkge1xuICAgIHZhciBvdXQgPSBbXTtcbiAgICB2YXIgb3V0TGVuZ3RoID0gLTE7XG5cbiAgICBmb3IgKHZhciBpID0gMCwgbGVuID0gcGF0aHMubGVuZ3RoOyBpIDwgbGVuOyArK2kpIHtcbiAgICAgICAgLy8gSWYgdGhpcyBkb2VzIG5vdCBpbnRlcnNlY3QgdGhlbiBhZGQgaXQgdG8gdGhlIG91dHB1dC5cbiAgICAgICAgaWYgKCFoYXNJbnRlcnNlY3Rpb24odHJlZSwgcGF0aHNbaV0sIDApKSB7XG4gICAgICAgICAgICBvdXRbKytvdXRMZW5ndGhdID0gcGF0aHNbaV07XG4gICAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIG91dDtcbn07XG5cblxuXG5cbi8qKioqKioqKioqKioqKioqKlxuICoqIFdFQlBBQ0sgRk9PVEVSXG4gKiogLi9+L2ZhbGNvci1wYXRoLXV0aWxzL2xpYi9wYXRoc0NvbXBsZW1lbnRGcm9tVHJlZS5qc1xuICoqIG1vZHVsZSBpZCA9IDlcbiAqKiBtb2R1bGUgY2h1bmtzID0gMFxuICoqLyIsInZhciBpdGVyYXRlS2V5U2V0ID0gcmVxdWlyZSgnLi9pdGVyYXRlS2V5U2V0Jyk7XG5cbi8qKlxuICogVGVzdHMgdG8gc2VlIGlmIHRoZSBpbnRlcnNlY3Rpb24gc2hvdWxkIGJlIHN0cmlwcGVkIGZyb20gdGhlXG4gKiB0b3RhbCBwYXRocy4gIFRoZSBvbmx5IHdheSB0aGlzIGhhcHBlbnMgY3VycmVudGx5IGlzIGlmIHRoZSBlbnRpcmV0eVxuICogb2YgdGhlIHBhdGggaXMgY29udGFpbmVkIGluIHRoZSB0cmVlLlxuICogQHByaXZhdGVcbiAqL1xubW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiBoYXNJbnRlcnNlY3Rpb24odHJlZSwgcGF0aCwgZGVwdGgpIHtcbiAgICB2YXIgY3VycmVudCA9IHRyZWU7XG4gICAgdmFyIGludGVyc2VjdHMgPSB0cnVlO1xuXG4gICAgLy8gQ29udGludWUgaXRlcmF0aXZlbHkgZ29pbmcgZG93biBhIHBhdGggdW50aWwgYSBjb21wbGV4IGtleSBpc1xuICAgIC8vIGVuY291bnRlcmVkLCB0aGVuIHJlY3Vyc2UuXG4gICAgZm9yICg7aW50ZXJzZWN0cyAmJiBkZXB0aCA8IHBhdGgubGVuZ3RoOyArK2RlcHRoKSB7XG4gICAgICAgIHZhciBrZXkgPSBwYXRoW2RlcHRoXTtcbiAgICAgICAgdmFyIGtleVR5cGUgPSB0eXBlb2Yga2V5O1xuXG4gICAgICAgIC8vIFdlIGhhdmUgdG8gaXRlcmF0ZSBrZXkgc2V0XG4gICAgICAgIGlmIChrZXkgJiYga2V5VHlwZSA9PT0gJ29iamVjdCcpIHtcbiAgICAgICAgICAgIHZhciBub3RlID0ge307XG4gICAgICAgICAgICB2YXIgaW5uZXJLZXkgPSBpdGVyYXRlS2V5U2V0KGtleSwgbm90ZSk7XG4gICAgICAgICAgICB2YXIgbmV4dERlcHRoID0gZGVwdGggKyAxO1xuXG4gICAgICAgICAgICAvLyBMb29wIHRocm91Z2ggdGhlIGlubmVyS2V5cyBzZXR0aW5nIHRoZSBpbnRlcnNlY3RzIGZsYWdcbiAgICAgICAgICAgIC8vIHRvIGVhY2ggcmVzdWx0LiAgQnJlYWsgb3V0IG9uIGZhbHNlLlxuICAgICAgICAgICAgZG8ge1xuICAgICAgICAgICAgICAgIHZhciBuZXh0ID0gY3VycmVudFtpbm5lcktleV07XG4gICAgICAgICAgICAgICAgaW50ZXJzZWN0cyA9IG5leHQgIT09IHVuZGVmaW5lZDtcblxuICAgICAgICAgICAgICAgIGlmIChpbnRlcnNlY3RzKSB7XG4gICAgICAgICAgICAgICAgICAgIGludGVyc2VjdHMgPSBoYXNJbnRlcnNlY3Rpb24obmV4dCwgcGF0aCwgbmV4dERlcHRoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaW5uZXJLZXkgPSBpdGVyYXRlS2V5U2V0KGtleSwgbm90ZSk7XG4gICAgICAgICAgICB9IHdoaWxlIChpbnRlcnNlY3RzICYmICFub3RlLmRvbmUpO1xuXG4gICAgICAgICAgICAvLyBTaW5jZSB3ZSByZWN1cnNlZCwgd2Ugc2hhbGwgbm90IHBhc3MgYW55IGZ1cnRoZXIhXG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIEl0cyBhIHNpbXBsZSBrZXksIGp1c3QgbW92ZSBmb3J3YXJkIHdpdGggdGhlIHRlc3RpbmcuXG4gICAgICAgIGN1cnJlbnQgPSBjdXJyZW50W2tleV07XG4gICAgICAgIGludGVyc2VjdHMgPSBjdXJyZW50ICE9PSB1bmRlZmluZWQ7XG4gICAgfVxuXG4gICAgcmV0dXJuIGludGVyc2VjdHM7XG59O1xuXG5cblxuLyoqKioqKioqKioqKioqKioqXG4gKiogV0VCUEFDSyBGT09URVJcbiAqKiAuL34vZmFsY29yLXBhdGgtdXRpbHMvbGliL2hhc0ludGVyc2VjdGlvbi5qc1xuICoqIG1vZHVsZSBpZCA9IDEwXG4gKiogbW9kdWxlIGNodW5rcyA9IDBcbiAqKi8iLCJ2YXIgaGFzSW50ZXJzZWN0aW9uID0gcmVxdWlyZSgnLi9oYXNJbnRlcnNlY3Rpb24nKTtcblxuLyoqXG4gKiBDb21wYXJlcyB0aGUgcGF0aHMgcGFzc2VkIGluIHdpdGggdGhlIHRyZWUuICBBbnkgb2YgdGhlIHBhdGhzIHRoYXQgYXJlIGluXG4gKiB0aGUgdHJlZSB3aWxsIGJlIHN0cmlwcGVkIGZyb20gdGhlIHBhdGhzLlxuICpcbiAqICoqRG9lcyBub3QgbXV0YXRlKiogdGhlIGluY29taW5nIHBhdGhzIG9iamVjdC5cbiAqICoqUHJvcGVyIHN1YnNldCoqIG9ubHkgbWF0Y2hpbmcuXG4gKlxuICogQHBhcmFtIHtBcnJheX0gcGF0aHMgLSBBIGxpc3Qgb2YgcGF0aHMgKGNvbXBsZXggb3Igc2ltcGxlKSB0byBzdHJpcCB0aGVcbiAqIGludGVyc2VjdGlvblxuICogQHBhcmFtIHtPYmplY3R9IHRyZWUgLVxuICogQHB1YmxpY1xuICovXG5tb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uIHBhdGhzQ29tcGxlbWVudEZyb21MZW5ndGhUcmVlKHBhdGhzLCB0cmVlKSB7XG4gICAgdmFyIG91dCA9IFtdO1xuICAgIHZhciBvdXRMZW5ndGggPSAtMTtcblxuICAgIGZvciAodmFyIGkgPSAwLCBsZW4gPSBwYXRocy5sZW5ndGg7IGkgPCBsZW47ICsraSkge1xuICAgICAgICAvLyBJZiB0aGlzIGRvZXMgbm90IGludGVyc2VjdCB0aGVuIGFkZCBpdCB0byB0aGUgb3V0cHV0LlxuICAgICAgICB2YXIgcGF0aCA9IHBhdGhzW2ldO1xuICAgICAgICBpZiAoIWhhc0ludGVyc2VjdGlvbih0cmVlW3BhdGgubGVuZ3RoXSwgcGF0aCwgMCkpIHtcbiAgICAgICAgICAgIG91dFsrK291dExlbmd0aF0gPSBwYXRoO1xuICAgICAgICB9XG4gICAgfVxuICAgIHJldHVybiBvdXQ7XG59O1xuXG5cblxuXG4vKioqKioqKioqKioqKioqKipcbiAqKiBXRUJQQUNLIEZPT1RFUlxuICoqIC4vfi9mYWxjb3ItcGF0aC11dGlscy9saWIvcGF0aHNDb21wbGVtZW50RnJvbUxlbmd0aFRyZWUuanNcbiAqKiBtb2R1bGUgaWQgPSAxMVxuICoqIG1vZHVsZSBjaHVua3MgPSAwXG4gKiovIiwidmFyIGlzQXJyYXkgPSBBcnJheS5pc0FycmF5O1xudmFyIHR5cGVPZk9iamVjdCA9IFwib2JqZWN0XCI7XG5cbi8qIGpzaGludCBmb3JpbjogZmFsc2UgKi9cbm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24gdG9QYXRocyhsZW5ndGhzKSB7XG4gICAgdmFyIHBhdGhtYXA7XG4gICAgdmFyIGFsbFBhdGhzID0gW107XG4gICAgdmFyIGFsbFBhdGhzTGVuZ3RoID0gMDtcbiAgICBmb3IgKHZhciBsZW5ndGggaW4gbGVuZ3Rocykge1xuICAgICAgICBpZiAoaXNOdW1iZXIobGVuZ3RoKSAmJiBpc09iamVjdChwYXRobWFwID0gbGVuZ3Roc1tsZW5ndGhdKSkge1xuICAgICAgICAgICAgdmFyIHBhdGhzID0gY29sbGFwc2VQYXRoTWFwKHBhdGhtYXAsIDAsIHBhcnNlSW50KGxlbmd0aCwgMTApKS5zZXRzO1xuICAgICAgICAgICAgdmFyIHBhdGhzSW5kZXggPSAtMTtcbiAgICAgICAgICAgIHZhciBwYXRoc0NvdW50ID0gcGF0aHMubGVuZ3RoO1xuICAgICAgICAgICAgd2hpbGUgKCsrcGF0aHNJbmRleCA8IHBhdGhzQ291bnQpIHtcbiAgICAgICAgICAgICAgICBhbGxQYXRoc1thbGxQYXRoc0xlbmd0aCsrXSA9IGNvbGxhcHNlUGF0aFNldEluZGV4ZXMocGF0aHNbcGF0aHNJbmRleF0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuICAgIHJldHVybiBhbGxQYXRocztcbn07XG5cbmZ1bmN0aW9uIGlzT2JqZWN0KHZhbHVlKSB7XG4gICAgcmV0dXJuIHZhbHVlICE9PSBudWxsICYmIHR5cGVvZiB2YWx1ZSA9PT0gdHlwZU9mT2JqZWN0O1xufVxuXG5mdW5jdGlvbiBjb2xsYXBzZVBhdGhNYXAocGF0aG1hcCwgZGVwdGgsIGxlbmd0aCkge1xuXG4gICAgdmFyIGtleTtcbiAgICB2YXIgY29kZSA9IGdldEhhc2hDb2RlKFN0cmluZyhkZXB0aCkpO1xuICAgIHZhciBzdWJzID0gT2JqZWN0LmNyZWF0ZShudWxsKTtcblxuICAgIHZhciBjb2RlcyA9IFtdO1xuICAgIHZhciBjb2Rlc0luZGV4ID0gLTE7XG4gICAgdmFyIGNvZGVzQ291bnQgPSAwO1xuXG4gICAgdmFyIHBhdGhzZXRzID0gW107XG4gICAgdmFyIHBhdGhzZXRzQ291bnQgPSAwO1xuXG4gICAgdmFyIHN1YlBhdGgsIHN1YkNvZGUsXG4gICAgICAgIHN1YktleXMsIHN1YktleXNJbmRleCwgc3ViS2V5c0NvdW50LFxuICAgICAgICBzdWJTZXRzLCBzdWJTZXRzSW5kZXgsIHN1YlNldHNDb3VudCxcbiAgICAgICAgcGF0aHNldCwgcGF0aHNldEluZGV4LCBwYXRoc2V0Q291bnQsXG4gICAgICAgIGZpcnN0U3ViS2V5LCBwYXRoc2V0Q2xvbmU7XG5cbiAgICBzdWJLZXlzID0gW107XG4gICAgc3ViS2V5c0luZGV4ID0gLTE7XG5cbiAgICBpZiAoZGVwdGggPCBsZW5ndGggLSAxKSB7XG5cbiAgICAgICAgc3ViS2V5c0NvdW50ID0gZ2V0U29ydGVkS2V5cyhwYXRobWFwLCBzdWJLZXlzKTtcblxuICAgICAgICB3aGlsZSAoKytzdWJLZXlzSW5kZXggPCBzdWJLZXlzQ291bnQpIHtcbiAgICAgICAgICAgIGtleSA9IHN1YktleXNbc3ViS2V5c0luZGV4XTtcbiAgICAgICAgICAgIHN1YlBhdGggPSBjb2xsYXBzZVBhdGhNYXAocGF0aG1hcFtrZXldLCBkZXB0aCArIDEsIGxlbmd0aCk7XG4gICAgICAgICAgICBzdWJDb2RlID0gc3ViUGF0aC5jb2RlO1xuICAgICAgICAgICAgaWYoc3Vic1tzdWJDb2RlXSkge1xuICAgICAgICAgICAgICAgIHN1YlBhdGggPSBzdWJzW3N1YkNvZGVdO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBjb2Rlc1tjb2Rlc0NvdW50KytdID0gc3ViQ29kZTtcbiAgICAgICAgICAgICAgICBzdWJQYXRoID0gc3Vic1tzdWJDb2RlXSA9IHtcbiAgICAgICAgICAgICAgICAgICAga2V5czogW10sXG4gICAgICAgICAgICAgICAgICAgIHNldHM6IHN1YlBhdGguc2V0c1xuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjb2RlID0gZ2V0SGFzaENvZGUoY29kZSArIGtleSArIHN1YkNvZGUpO1xuXG4gICAgICAgICAgICBpc051bWJlcihrZXkpICYmXG4gICAgICAgICAgICAgICAgc3ViUGF0aC5rZXlzLnB1c2gocGFyc2VJbnQoa2V5LCAxMCkpIHx8XG4gICAgICAgICAgICAgICAgc3ViUGF0aC5rZXlzLnB1c2goa2V5KTtcbiAgICAgICAgfVxuXG4gICAgICAgIHdoaWxlKCsrY29kZXNJbmRleCA8IGNvZGVzQ291bnQpIHtcblxuICAgICAgICAgICAga2V5ID0gY29kZXNbY29kZXNJbmRleF07XG4gICAgICAgICAgICBzdWJQYXRoID0gc3Vic1trZXldO1xuICAgICAgICAgICAgc3ViS2V5cyA9IHN1YlBhdGgua2V5cztcbiAgICAgICAgICAgIHN1YktleXNDb3VudCA9IHN1YktleXMubGVuZ3RoO1xuXG4gICAgICAgICAgICBpZiAoc3ViS2V5c0NvdW50ID4gMCkge1xuXG4gICAgICAgICAgICAgICAgc3ViU2V0cyA9IHN1YlBhdGguc2V0cztcbiAgICAgICAgICAgICAgICBzdWJTZXRzSW5kZXggPSAtMTtcbiAgICAgICAgICAgICAgICBzdWJTZXRzQ291bnQgPSBzdWJTZXRzLmxlbmd0aDtcbiAgICAgICAgICAgICAgICBmaXJzdFN1YktleSA9IHN1YktleXNbMF07XG5cbiAgICAgICAgICAgICAgICB3aGlsZSAoKytzdWJTZXRzSW5kZXggPCBzdWJTZXRzQ291bnQpIHtcblxuICAgICAgICAgICAgICAgICAgICBwYXRoc2V0ID0gc3ViU2V0c1tzdWJTZXRzSW5kZXhdO1xuICAgICAgICAgICAgICAgICAgICBwYXRoc2V0SW5kZXggPSAtMTtcbiAgICAgICAgICAgICAgICAgICAgcGF0aHNldENvdW50ID0gcGF0aHNldC5sZW5ndGg7XG4gICAgICAgICAgICAgICAgICAgIHBhdGhzZXRDbG9uZSA9IG5ldyBBcnJheShwYXRoc2V0Q291bnQgKyAxKTtcbiAgICAgICAgICAgICAgICAgICAgcGF0aHNldENsb25lWzBdID0gc3ViS2V5c0NvdW50ID4gMSAmJiBzdWJLZXlzIHx8IGZpcnN0U3ViS2V5O1xuXG4gICAgICAgICAgICAgICAgICAgIHdoaWxlICgrK3BhdGhzZXRJbmRleCA8IHBhdGhzZXRDb3VudCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcGF0aHNldENsb25lW3BhdGhzZXRJbmRleCArIDFdID0gcGF0aHNldFtwYXRoc2V0SW5kZXhdO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgcGF0aHNldHNbcGF0aHNldHNDb3VudCsrXSA9IHBhdGhzZXRDbG9uZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgICBzdWJLZXlzQ291bnQgPSBnZXRTb3J0ZWRLZXlzKHBhdGhtYXAsIHN1YktleXMpO1xuICAgICAgICBpZiAoc3ViS2V5c0NvdW50ID4gMSkge1xuICAgICAgICAgICAgcGF0aHNldHNbcGF0aHNldHNDb3VudCsrXSA9IFtzdWJLZXlzXTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHBhdGhzZXRzW3BhdGhzZXRzQ291bnQrK10gPSBzdWJLZXlzO1xuICAgICAgICB9XG4gICAgICAgIHdoaWxlICgrK3N1YktleXNJbmRleCA8IHN1YktleXNDb3VudCkge1xuICAgICAgICAgICAgY29kZSA9IGdldEhhc2hDb2RlKGNvZGUgKyBzdWJLZXlzW3N1YktleXNJbmRleF0pO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIHtcbiAgICAgICAgY29kZTogY29kZSxcbiAgICAgICAgc2V0czogcGF0aHNldHNcbiAgICB9O1xufVxuXG5mdW5jdGlvbiBjb2xsYXBzZVBhdGhTZXRJbmRleGVzKHBhdGhzZXQpIHtcblxuICAgIHZhciBrZXlzZXRJbmRleCA9IC0xO1xuICAgIHZhciBrZXlzZXRDb3VudCA9IHBhdGhzZXQubGVuZ3RoO1xuXG4gICAgd2hpbGUgKCsra2V5c2V0SW5kZXggPCBrZXlzZXRDb3VudCkge1xuICAgICAgICB2YXIga2V5c2V0ID0gcGF0aHNldFtrZXlzZXRJbmRleF07XG4gICAgICAgIGlmIChpc0FycmF5KGtleXNldCkpIHtcbiAgICAgICAgICAgIHBhdGhzZXRba2V5c2V0SW5kZXhdID0gY29sbGFwc2VJbmRleChrZXlzZXQpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIHBhdGhzZXQ7XG59XG5cbi8qKlxuICogQ29sbGFwc2UgcmFuZ2UgaW5kZXhlcnMsIGUuZy4gd2hlbiB0aGVyZSBpcyBhIGNvbnRpbnVvdXNcbiAqIHJhbmdlIGluIGFuIGFycmF5LCB0dXJuIGl0IGludG8gYW4gb2JqZWN0IGluc3RlYWQ6XG4gKlxuICogWzEsMiwzLDQsNSw2XSA9PiB7XCJmcm9tXCI6MSwgXCJ0b1wiOjZ9XG4gKlxuICogQHByaXZhdGVcbiAqL1xuZnVuY3Rpb24gY29sbGFwc2VJbmRleChrZXlzZXQpIHtcblxuICAgIC8vIERvIHdlIG5lZWQgdG8gZGVkdXBlIGFuIGluZGV4ZXIga2V5c2V0IGlmIHRoZXkncmUgZHVwbGljYXRlIGNvbnNlY3V0aXZlIGludGVnZXJzP1xuICAgIC8vIHZhciBoYXNoID0ge307XG4gICAgdmFyIGtleUluZGV4ID0gLTE7XG4gICAgdmFyIGtleUNvdW50ID0ga2V5c2V0Lmxlbmd0aCAtIDE7XG4gICAgdmFyIGlzU3BhcnNlUmFuZ2UgPSBrZXlDb3VudCA+IDA7XG5cbiAgICB3aGlsZSAoKytrZXlJbmRleCA8PSBrZXlDb3VudCkge1xuXG4gICAgICAgIHZhciBrZXkgPSBrZXlzZXRba2V5SW5kZXhdO1xuXG4gICAgICAgIGlmICghaXNOdW1iZXIoa2V5KSAvKiB8fCBoYXNoW2tleV0gPT09IHRydWUqLyApIHtcbiAgICAgICAgICAgIGlzU3BhcnNlUmFuZ2UgPSBmYWxzZTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgICAgIC8vIGhhc2hba2V5XSA9IHRydWU7XG4gICAgICAgIC8vIENhc3QgbnVtYmVyIGluZGV4ZXMgdG8gaW50ZWdlcnMuXG4gICAgICAgIGtleXNldFtrZXlJbmRleF0gPSBwYXJzZUludChrZXksIDEwKTtcbiAgICB9XG5cbiAgICBpZiAoaXNTcGFyc2VSYW5nZSA9PT0gdHJ1ZSkge1xuXG4gICAgICAgIGtleXNldC5zb3J0KHNvcnRMaXN0QXNjZW5kaW5nKTtcblxuICAgICAgICB2YXIgZnJvbSA9IGtleXNldFswXTtcbiAgICAgICAgdmFyIHRvID0ga2V5c2V0W2tleUNvdW50XTtcblxuICAgICAgICAvLyBJZiB3ZSByZS1pbnRyb2R1Y2UgZGVkdXBlZCBpbnRlZ2VyIGluZGV4ZXJzLCBjaGFuZ2UgdGhpcyBjb21wYXJzb24gdG8gXCI9PT1cIi5cbiAgICAgICAgaWYgKHRvIC0gZnJvbSA8PSBrZXlDb3VudCkge1xuICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICBmcm9tOiBmcm9tLFxuICAgICAgICAgICAgICAgIHRvOiB0b1xuICAgICAgICAgICAgfTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiBrZXlzZXQ7XG59XG5cbmZ1bmN0aW9uIHNvcnRMaXN0QXNjZW5kaW5nKGEsIGIpIHtcbiAgICByZXR1cm4gYSAtIGI7XG59XG5cbi8qIGpzaGludCBmb3JpbjogZmFsc2UgKi9cbmZ1bmN0aW9uIGdldFNvcnRlZEtleXMobWFwLCBrZXlzLCBzb3J0KSB7XG4gICAgdmFyIGxlbiA9IDA7XG4gICAgZm9yICh2YXIga2V5IGluIG1hcCkge1xuICAgICAgICBrZXlzW2xlbisrXSA9IGtleTtcbiAgICB9XG4gICAgaWYgKGxlbiA+IDEpIHtcbiAgICAgICAga2V5cy5zb3J0KHNvcnQpO1xuICAgIH1cbiAgICByZXR1cm4gbGVuO1xufVxuXG5mdW5jdGlvbiBnZXRIYXNoQ29kZShrZXkpIHtcbiAgICB2YXIgY29kZSA9IDUzODE7XG4gICAgdmFyIGluZGV4ID0gLTE7XG4gICAgdmFyIGNvdW50ID0ga2V5Lmxlbmd0aDtcbiAgICB3aGlsZSAoKytpbmRleCA8IGNvdW50KSB7XG4gICAgICAgIGNvZGUgPSAoY29kZSA8PCA1KSArIGNvZGUgKyBrZXkuY2hhckNvZGVBdChpbmRleCk7XG4gICAgfVxuICAgIHJldHVybiBTdHJpbmcoY29kZSk7XG59XG5cbi8qKlxuICogUmV0dXJuIHRydWUgaWYgYXJndW1lbnQgaXMgYSBudW1iZXIgb3IgY2FuIGJlIGNhc3QgdG8gYSBudW1iZXJcbiAqIEBwcml2YXRlXG4gKi9cbmZ1bmN0aW9uIGlzTnVtYmVyKHZhbCkge1xuICAgIC8vIHBhcnNlRmxvYXQgTmFOcyBudW1lcmljLWNhc3QgZmFsc2UgcG9zaXRpdmVzIChudWxsfHRydWV8ZmFsc2V8XCJcIilcbiAgICAvLyAuLi5idXQgbWlzaW50ZXJwcmV0cyBsZWFkaW5nLW51bWJlciBzdHJpbmdzLCBwYXJ0aWN1bGFybHkgaGV4IGxpdGVyYWxzIChcIjB4Li4uXCIpXG4gICAgLy8gc3VidHJhY3Rpb24gZm9yY2VzIGluZmluaXRpZXMgdG8gTmFOXG4gICAgLy8gYWRkaW5nIDEgY29ycmVjdHMgbG9zcyBvZiBwcmVjaXNpb24gZnJvbSBwYXJzZUZsb2F0ICgjMTUxMDApXG4gICAgcmV0dXJuICFpc0FycmF5KHZhbCkgJiYgKHZhbCAtIHBhcnNlRmxvYXQodmFsKSArIDEpID49IDA7XG59XG5cblxuXG5cbi8qKioqKioqKioqKioqKioqKlxuICoqIFdFQlBBQ0sgRk9PVEVSXG4gKiogLi9+L2ZhbGNvci1wYXRoLXV0aWxzL2xpYi90b1BhdGhzLmpzXG4gKiogbW9kdWxlIGlkID0gMTJcbiAqKiBtb2R1bGUgY2h1bmtzID0gMFxuICoqLyIsInZhciB0b1BhdGhzID0gcmVxdWlyZSgnLi90b1BhdGhzJyk7XG52YXIgdG9UcmVlID0gcmVxdWlyZSgnLi90b1RyZWUnKTtcblxubW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiBjb2xsYXBzZShwYXRocykge1xuICAgIHZhciBjb2xsYXBzZU1hcCA9IHBhdGhzLlxuICAgICAgICByZWR1Y2UoZnVuY3Rpb24oYWNjLCBwYXRoKSB7XG4gICAgICAgICAgICB2YXIgbGVuID0gcGF0aC5sZW5ndGg7XG4gICAgICAgICAgICBpZiAoIWFjY1tsZW5dKSB7XG4gICAgICAgICAgICAgICAgYWNjW2xlbl0gPSBbXTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGFjY1tsZW5dLnB1c2gocGF0aCk7XG4gICAgICAgICAgICByZXR1cm4gYWNjO1xuICAgICAgICB9LCB7fSk7XG5cbiAgICBPYmplY3QuXG4gICAgICAgIGtleXMoY29sbGFwc2VNYXApLlxuICAgICAgICBmb3JFYWNoKGZ1bmN0aW9uKGNvbGxhcHNlS2V5KSB7XG4gICAgICAgICAgICBjb2xsYXBzZU1hcFtjb2xsYXBzZUtleV0gPSB0b1RyZWUoY29sbGFwc2VNYXBbY29sbGFwc2VLZXldKTtcbiAgICAgICAgfSk7XG5cbiAgICByZXR1cm4gdG9QYXRocyhjb2xsYXBzZU1hcCk7XG59O1xuXG5cblxuLyoqKioqKioqKioqKioqKioqXG4gKiogV0VCUEFDSyBGT09URVJcbiAqKiAuL34vZmFsY29yLXBhdGgtdXRpbHMvbGliL2NvbGxhcHNlLmpzXG4gKiogbW9kdWxlIGlkID0gMTNcbiAqKiBtb2R1bGUgY2h1bmtzID0gMFxuICoqLyIsInZhciBpdGVyYXRlS2V5U2V0ID0gcmVxdWlyZSgnLi9pdGVyYXRlS2V5U2V0Jyk7XG52YXIgY2xvbmVBcnJheSA9IHJlcXVpcmUoJy4vc3VwcG9ydC9jbG9uZUFycmF5Jyk7XG52YXIgY2F0QW5kU2xpY2UgPSByZXF1aXJlKCcuL3N1cHBvcnQvY2F0QW5kU2xpY2UnKTtcbnZhciAkdHlwZXMgPSByZXF1aXJlKCcuL3N1cHBvcnQvdHlwZXMnKTtcbnZhciAkcmVmID0gJHR5cGVzLiRyZWY7XG52YXIgZm9sbG93UmVmZXJlbmNlID0gcmVxdWlyZSgnLi9mb2xsb3dSZWZlcmVuY2UnKTtcblxuLyoqXG4gKiBUaGUgZmFzdGVzdCBwb3NzaWJsZSBvcHRpbWl6ZSBvZiBwYXRocy5cbiAqXG4gKiBXaGF0IGl0IGRvZXM6XG4gKiAtIEFueSBhdG9tIHNob3J0LWNpcmN1aXQgLyBmb3VuZCB2YWx1ZSB3aWxsIGJlIHJlbW92ZWQgZnJvbSB0aGUgcGF0aC5cbiAqIC0gQWxsIHBhdGhzIHdpbGwgYmUgZXhwbG9kZWQgd2hpY2ggbWVhbnMgdGhhdCBjb2xsYXBzZSB3aWxsIG5lZWQgdG8gYmVcbiAqICAgcmFuIGFmdGVyd29yZHMuXG4gKiAtIEFueSBtaXNzaW5nIHBhdGggd2lsbCBiZSBvcHRpbWl6ZWQgYXMgbXVjaCBhcyBwb3NzaWJsZS5cbiAqL1xubW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiBvcHRpbWl6ZVBhdGhTZXRzKGNhY2hlLCBwYXRocywgbWF4UmVmRm9sbG93KSB7XG4gICAgdmFyIG9wdGltaXplZCA9IFtdO1xuICAgIHBhdGhzLmZvckVhY2goZnVuY3Rpb24ocCkge1xuICAgICAgICBvcHRpbWl6ZVBhdGhTZXQoY2FjaGUsIGNhY2hlLCBwLCAwLCBvcHRpbWl6ZWQsIFtdLCBtYXhSZWZGb2xsb3cpO1xuICAgIH0pO1xuXG4gICAgcmV0dXJuIG9wdGltaXplZDtcbn07XG5cblxuLyoqXG4gKiBvcHRpbWl6ZXMgb25lIHBhdGhTZXQgYXQgYSB0aW1lLlxuICovXG5mdW5jdGlvbiBvcHRpbWl6ZVBhdGhTZXQoY2FjaGUsIGNhY2hlUm9vdCwgcGF0aFNldCxcbiAgICAgICAgICAgICAgICAgICAgICAgICBkZXB0aCwgb3V0LCBvcHRpbWl6ZWRQYXRoLCBtYXhSZWZGb2xsb3cpIHtcblxuICAgIC8vIGF0IG1pc3NpbmcsIHJlcG9ydCBvcHRpbWl6ZWQgcGF0aC5cbiAgICBpZiAoY2FjaGUgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICBvdXRbb3V0Lmxlbmd0aF0gPSBjYXRBbmRTbGljZShvcHRpbWl6ZWRQYXRoLCBwYXRoU2V0LCBkZXB0aCk7XG4gICAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICAvLyBhbGwgb3RoZXIgc2VudGluZWxzIGFyZSBzaG9ydCBjaXJjdWl0ZWQuXG4gICAgLy8gT3Igd2UgZm91bmQgYSBwcmltaXRpdmUgKHdoaWNoIGluY2x1ZGVzIG51bGwpXG4gICAgaWYgKGNhY2hlID09PSBudWxsIHx8IChjYWNoZS4kdHlwZSAmJiBjYWNoZS4kdHlwZSAhPT0gJHJlZikgfHxcbiAgICAgICAgICAgICh0eXBlb2YgY2FjaGUgIT09ICdvYmplY3QnKSkge1xuICAgICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgLy8gSWYgdGhlIHJlZmVyZW5jZSBpcyB0aGUgbGFzdCBpdGVtIGluIHRoZSBwYXRoIHRoZW4gZG8gbm90XG4gICAgLy8gY29udGludWUgdG8gc2VhcmNoIGl0LlxuICAgIGlmIChjYWNoZS4kdHlwZSA9PT0gJHJlZiAmJiBkZXB0aCA9PT0gcGF0aFNldC5sZW5ndGgpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIHZhciBrZXlTZXQgPSBwYXRoU2V0W2RlcHRoXTtcbiAgICB2YXIgaXNLZXlTZXQgPSB0eXBlb2Yga2V5U2V0ID09PSAnb2JqZWN0JztcbiAgICB2YXIgbmV4dERlcHRoID0gZGVwdGggKyAxO1xuICAgIHZhciBpdGVyYXRvck5vdGUgPSBmYWxzZTtcbiAgICB2YXIga2V5ID0ga2V5U2V0O1xuICAgIGlmIChpc0tleVNldCkge1xuICAgICAgICBpdGVyYXRvck5vdGUgPSB7fTtcbiAgICAgICAga2V5ID0gaXRlcmF0ZUtleVNldChrZXlTZXQsIGl0ZXJhdG9yTm90ZSk7XG4gICAgfVxuICAgIHZhciBuZXh0LCBuZXh0T3B0aW1pemVkO1xuICAgIGRvIHtcbiAgICAgICAgbmV4dCA9IGNhY2hlW2tleV07XG4gICAgICAgIHZhciBvcHRpbWl6ZWRQYXRoTGVuZ3RoID0gb3B0aW1pemVkUGF0aC5sZW5ndGg7XG4gICAgICAgIGlmIChrZXkgIT09IG51bGwpIHtcbiAgICAgICAgICAgIG9wdGltaXplZFBhdGhbb3B0aW1pemVkUGF0aExlbmd0aF0gPSBrZXk7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAobmV4dCAmJiBuZXh0LiR0eXBlID09PSAkcmVmICYmIG5leHREZXB0aCA8IHBhdGhTZXQubGVuZ3RoKSB7XG4gICAgICAgICAgICB2YXIgcmVmUmVzdWx0cyA9XG4gICAgICAgICAgICAgICAgZm9sbG93UmVmZXJlbmNlKGNhY2hlUm9vdCwgbmV4dC52YWx1ZSwgbWF4UmVmRm9sbG93KTtcbiAgICAgICAgICAgIG5leHQgPSByZWZSZXN1bHRzWzBdO1xuXG4gICAgICAgICAgICAvLyBtdXN0IGNsb25lIHRvIGF2b2lkIHRoZSBtdXRhdGlvbiBmcm9tIGFib3ZlIGRlc3Ryb3lpbmcgdGhlIGNhY2hlLlxuICAgICAgICAgICAgbmV4dE9wdGltaXplZCA9IGNsb25lQXJyYXkocmVmUmVzdWx0c1sxXSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBuZXh0T3B0aW1pemVkID0gb3B0aW1pemVkUGF0aDtcbiAgICAgICAgfVxuXG4gICAgICAgIG9wdGltaXplUGF0aFNldChuZXh0LCBjYWNoZVJvb3QsIHBhdGhTZXQsIG5leHREZXB0aCxcbiAgICAgICAgICAgICAgICAgICAgICAgIG91dCwgbmV4dE9wdGltaXplZCwgbWF4UmVmRm9sbG93KTtcbiAgICAgICAgb3B0aW1pemVkUGF0aC5sZW5ndGggPSBvcHRpbWl6ZWRQYXRoTGVuZ3RoO1xuXG4gICAgICAgIGlmIChpdGVyYXRvck5vdGUgJiYgIWl0ZXJhdG9yTm90ZS5kb25lKSB7XG4gICAgICAgICAgICBrZXkgPSBpdGVyYXRlS2V5U2V0KGtleVNldCwgaXRlcmF0b3JOb3RlKTtcbiAgICAgICAgfVxuICAgIH0gd2hpbGUgKGl0ZXJhdG9yTm90ZSAmJiAhaXRlcmF0b3JOb3RlLmRvbmUpO1xufVxuXG5cblxuXG5cbi8qKioqKioqKioqKioqKioqKlxuICoqIFdFQlBBQ0sgRk9PVEVSXG4gKiogLi9+L2ZhbGNvci1wYXRoLXV0aWxzL2xpYi9vcHRpbWl6ZVBhdGhTZXRzLmpzXG4gKiogbW9kdWxlIGlkID0gMTRcbiAqKiBtb2R1bGUgY2h1bmtzID0gMFxuICoqLyIsImZ1bmN0aW9uIGNsb25lQXJyYXkoYXJyLCBpbmRleCkge1xuICAgIHZhciBhID0gW107XG4gICAgdmFyIGxlbiA9IGFyci5sZW5ndGg7XG4gICAgZm9yICh2YXIgaSA9IGluZGV4IHx8IDA7IGkgPCBsZW47IGkrKykge1xuICAgICAgICBhW2ldID0gYXJyW2ldO1xuICAgIH1cbiAgICByZXR1cm4gYTtcbn1cblxubW9kdWxlLmV4cG9ydHMgPSBjbG9uZUFycmF5O1xuXG5cblxuXG4vKioqKioqKioqKioqKioqKipcbiAqKiBXRUJQQUNLIEZPT1RFUlxuICoqIC4vfi9mYWxjb3ItcGF0aC11dGlscy9saWIvc3VwcG9ydC9jbG9uZUFycmF5LmpzXG4gKiogbW9kdWxlIGlkID0gMTVcbiAqKiBtb2R1bGUgY2h1bmtzID0gMFxuICoqLyIsIm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24gY2F0QW5kU2xpY2UoYSwgYiwgc2xpY2UpIHtcbiAgICB2YXIgbmV4dCA9IFtdLCBpLCBqLCBsZW47XG4gICAgZm9yIChpID0gMCwgbGVuID0gYS5sZW5ndGg7IGkgPCBsZW47ICsraSkge1xuICAgICAgICBuZXh0W2ldID0gYVtpXTtcbiAgICB9XG5cbiAgICBmb3IgKGogPSBzbGljZSB8fCAwLCBsZW4gPSBiLmxlbmd0aDsgaiA8IGxlbjsgKytqLCArK2kpIHtcbiAgICAgICAgbmV4dFtpXSA9IGJbal07XG4gICAgfVxuXG4gICAgcmV0dXJuIG5leHQ7XG59O1xuXG5cblxuXG4vKioqKioqKioqKioqKioqKipcbiAqKiBXRUJQQUNLIEZPT1RFUlxuICoqIC4vfi9mYWxjb3ItcGF0aC11dGlscy9saWIvc3VwcG9ydC9jYXRBbmRTbGljZS5qc1xuICoqIG1vZHVsZSBpZCA9IDE2XG4gKiogbW9kdWxlIGNodW5rcyA9IDBcbiAqKi8iLCJtb2R1bGUuZXhwb3J0cyA9IHtcbiAgICAkcmVmOiAncmVmJyxcbiAgICAkYXRvbTogJ2F0b20nLFxuICAgICRlcnJvcjogJ2Vycm9yJ1xufTtcblxuXG5cblxuLyoqKioqKioqKioqKioqKioqXG4gKiogV0VCUEFDSyBGT09URVJcbiAqKiAuL34vZmFsY29yLXBhdGgtdXRpbHMvbGliL3N1cHBvcnQvdHlwZXMuanNcbiAqKiBtb2R1bGUgaWQgPSAxN1xuICoqIG1vZHVsZSBjaHVua3MgPSAwXG4gKiovIiwidmFyIGNsb25lQXJyYXkgPSByZXF1aXJlKCcuL3N1cHBvcnQvY2xvbmVBcnJheScpO1xudmFyICRyZWYgPSByZXF1aXJlKCcuL3N1cHBvcnQvdHlwZXMnKS4kcmVmO1xudmFyIGVycm9ycyA9IHJlcXVpcmUoJy4vZXJyb3JzJyk7XG5cbi8qKlxuICogcGVyZm9ybXMgdGhlIHNpbXBsaWZpZWQgY2FjaGUgcmVmZXJlbmNlIGZvbGxvdy4gIFRoaXNcbiAqIGRpZmZlcnMgZnJvbSBnZXQgYXMgdGhlcmUgaXMganVzdCBmb2xsb3dpbmcgYW5kIHJlcG9ydGluZyxcbiAqIG5vdCBtdWNoIGVsc2UuXG4gKlxuICogQHBhcmFtIHtPYmplY3R9IGNhY2hlUm9vdFxuICogQHBhcmFtIHtBcnJheX0gcmVmXG4gKi9cbm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24gZm9sbG93UmVmZXJlbmNlKGNhY2hlUm9vdCwgcmVmLCBtYXhSZWZGb2xsb3cpIHtcbiAgICB2YXIgY3VycmVudCA9IGNhY2hlUm9vdDtcbiAgICB2YXIgcmVmUGF0aCA9IHJlZjtcbiAgICB2YXIgZGVwdGggPSAtMTtcbiAgICB2YXIgbGVuZ3RoID0gcmVmUGF0aC5sZW5ndGg7XG4gICAgdmFyIGtleSwgbmV4dCwgdHlwZTtcbiAgICB2YXIgcmVmZXJlbmNlQ291bnQgPSAwO1xuXG4gICAgd2hpbGUgKCsrZGVwdGggPCBsZW5ndGgpIHtcbiAgICAgICAga2V5ID0gcmVmUGF0aFtkZXB0aF07XG4gICAgICAgIG5leHQgPSBjdXJyZW50W2tleV07XG4gICAgICAgIHR5cGUgPSBuZXh0ICYmIG5leHQuJHR5cGU7XG5cbiAgICAgICAgaWYgKCFuZXh0IHx8IHR5cGUgJiYgdHlwZSAhPT0gJHJlZikge1xuICAgICAgICAgICAgY3VycmVudCA9IG5leHQ7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIFNob3cgc3RvcHBlciBleGNlcHRpb24uICBUaGlzIHJvdXRlIGlzIG1hbGZvcm1lZC5cbiAgICAgICAgaWYgKHR5cGUgJiYgdHlwZSA9PT0gJHJlZiAmJiBkZXB0aCArIDEgPCBsZW5ndGgpIHtcbiAgICAgICAgICAgIHZhciBlcnIgPSBuZXcgRXJyb3IoZXJyb3JzLmlubmVyUmVmZXJlbmNlcyk7XG4gICAgICAgICAgICBlcnIudGhyb3dUb05leHQgPSB0cnVlO1xuICAgICAgICAgICAgdGhyb3cgZXJyO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gcG90ZW50aWFsbHkgZm9sbG93IHJlZmVyZW5jZVxuICAgICAgICBpZiAoZGVwdGggKyAxID09PSBsZW5ndGgpIHtcbiAgICAgICAgICAgIGlmICh0eXBlID09PSAkcmVmKSB7XG4gICAgICAgICAgICAgICAgZGVwdGggPSAtMTtcbiAgICAgICAgICAgICAgICByZWZQYXRoID0gbmV4dC52YWx1ZTtcbiAgICAgICAgICAgICAgICBsZW5ndGggPSByZWZQYXRoLmxlbmd0aDtcbiAgICAgICAgICAgICAgICBuZXh0ID0gY2FjaGVSb290O1xuICAgICAgICAgICAgICAgIHJlZmVyZW5jZUNvdW50Kys7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmIChyZWZlcmVuY2VDb3VudCA+IG1heFJlZkZvbGxvdykge1xuICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihlcnJvcnMuY2lyY3VsYXJSZWZlcmVuY2UpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGN1cnJlbnQgPSBuZXh0O1xuICAgIH1cblxuICAgIHJldHVybiBbY3VycmVudCwgY2xvbmVBcnJheShyZWZQYXRoKV07XG59O1xuXG5cblxuXG4vKioqKioqKioqKioqKioqKipcbiAqKiBXRUJQQUNLIEZPT1RFUlxuICoqIC4vfi9mYWxjb3ItcGF0aC11dGlscy9saWIvZm9sbG93UmVmZXJlbmNlLmpzXG4gKiogbW9kdWxlIGlkID0gMThcbiAqKiBtb2R1bGUgY2h1bmtzID0gMFxuICoqLyIsIi8qZXNsaW50LWRpc2FibGUqL1xubW9kdWxlLmV4cG9ydHMgPSB7XG4gICAgaW5uZXJSZWZlcmVuY2VzOiAnUmVmZXJlbmNlcyB3aXRoIGlubmVyIHJlZmVyZW5jZXMgYXJlIG5vdCBhbGxvd2VkLicsXG4gICAgY2lyY3VsYXJSZWZlcmVuY2U6ICdUaGVyZSBhcHBlYXJzIHRvIGJlIGEgY2lyY3VsYXIgcmVmZXJlbmNlLCBtYXhpbXVtIHJlZmVyZW5jZSBmb2xsb3dpbmcgZXhjZWVkZWQuJ1xufTtcblxuXG5cblxuLyoqKioqKioqKioqKioqKioqXG4gKiogV0VCUEFDSyBGT09URVJcbiAqKiAuL34vZmFsY29yLXBhdGgtdXRpbHMvbGliL2Vycm9ycy9pbmRleC5qc1xuICoqIG1vZHVsZSBpZCA9IDE5XG4gKiogbW9kdWxlIGNodW5rcyA9IDBcbiAqKi8iLCJ2YXIgbm9PcCA9IGZ1bmN0aW9uIG5vT3AoKSB7fTtcbnZhciBlbXB0eURpc3Bvc2FibGUgPSB7ZGlzcG9zZTogbm9PcH07XG5cbi8qKlxuICogQSBNb2RlbFJlc3BvbnNlIGlzIGEgY29udGFpbmVyIGZvciB0aGUgcmVzdWx0cyBvZiBhIGdldCwgc2V0LCBvciBjYWxsIG9wZXJhdGlvbiBwZXJmb3JtZWQgb24gYSBNb2RlbC4gVGhlIE1vZGVsUmVzcG9uc2UgcHJvdmlkZXMgbWV0aG9kcyB3aGljaCBjYW4gYmUgdXNlZCB0byBzcGVjaWZ5IHRoZSBvdXRwdXQgZm9ybWF0IG9mIHRoZSBkYXRhIHJldHJpZXZlZCBmcm9tIGEgTW9kZWwsIGFzIHdlbGwgYXMgaG93IHRoYXQgZGF0YSBpcyBkZWxpdmVyZWQuXG4gKiBAY29uc3RydWN0b3IgTW9kZWxSZXNwb25zZVxuICogQGF1Z21lbnRzIE9ic2VydmFibGVcbiovXG5mdW5jdGlvbiBTdWJzY3JpYmFibGUoc3Vic2NyaWJlKSB7XG4gICAgdGhpcy5fc3Vic2NyaWJlID0gc3Vic2NyaWJlO1xufVxuXG5TdWJzY3JpYmFibGUucHJvdG90eXBlLnN1YnNjcmliZSA9IGZ1bmN0aW9uIHN1YnNjcmliZShhLCBiLCBjKSB7XG4gICAgdmFyIG9ic2VydmVyID0gYTtcbiAgICBpZiAoIW9ic2VydmVyIHx8IHR5cGVvZiBvYnNlcnZlciAhPT0gJ29iamVjdCcpIHtcbiAgICAgICAgb2JzZXJ2ZXIgPSB7XG4gICAgICAgICAgICBvbk5leHQ6IGEgfHwgbm9PcCxcbiAgICAgICAgICAgIG9uRXJyb3I6IGIgfHwgbm9PcCxcbiAgICAgICAgICAgIG9uQ29tcGxldGVkOiBjIHx8IG5vT3BcbiAgICAgICAgfTtcbiAgICB9XG4gICAgdmFyIHN1YnNjcmlwdGlvbiA9IHRoaXMuX3N1YnNjcmliZShvYnNlcnZlcik7XG5cbiAgICBzd2l0Y2ggKHR5cGVvZiBzdWJzY3JpcHRpb24pIHtcbiAgICAgICAgY2FzZSAnZnVuY3Rpb24nOlxuICAgICAgICAgICAgcmV0dXJuIHsgZGlzcG9zZTogc3Vic2NyaXB0aW9uIH07XG4gICAgICAgIGNhc2UgJ29iamVjdCc6XG4gICAgICAgICAgICByZXR1cm4gc3Vic2NyaXB0aW9uIHx8IGVtcHR5RGlzcG9zYWJsZTtcbiAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgIHJldHVybiBlbXB0eURpc3Bvc2FibGU7XG4gICAgfVxufTtcblxubW9kdWxlLmV4cG9ydHMgPSBTdWJzY3JpYmFibGU7XG5cblxuXG5cbi8qKioqKioqKioqKioqKioqKlxuICoqIFdFQlBBQ0sgRk9PVEVSXG4gKiogLi9zcmMvU3Vic2NyaWJhYmxlLmpzXG4gKiogbW9kdWxlIGlkID0gMjBcbiAqKiBtb2R1bGUgY2h1bmtzID0gMFxuICoqLyIsInZhciBNRVNTQUdFID0gJ1RoZSBEYXRhU291cmNlQ2hhaW5lciByZXF1aXJlcyBhdCBsZWFzdCBvbmUgZGF0YVNvdXJjZSAnICtcbiAgICAgICAgICAgICAgJ2luIGl0cyBjb25zdHJ1Y3Rvci4nO1xuLyoqXG4gKiBBIGRhdGEgc291cmNlIGNoYWluZXIgd2FzIGluaXRpYWxpemVkIHdpdGhvdXQgYW55IHNvdXJjZXMuXG4gKlxuICogQHByaXZhdGVcbiAqL1xuZnVuY3Rpb24gQXRMZWFzdE9uZURhdGFTb3VyY2VFcnJvcigpIHtcbiAgICB0aGlzLm1lc3NhZ2UgPSBNRVNTQUdFO1xuICAgIHRoaXMuc3RhY2sgPSAobmV3IEVycm9yKCkpLnN0YWNrO1xufVxuXG5BdExlYXN0T25lRGF0YVNvdXJjZUVycm9yLnByb3RvdHlwZSA9IG5ldyBFcnJvcigpO1xuQXRMZWFzdE9uZURhdGFTb3VyY2VFcnJvci5tZXNzYWdlID0gTUVTU0FHRTtcblxubW9kdWxlLmV4cG9ydHMgPSBBdExlYXN0T25lRGF0YVNvdXJjZUVycm9yO1xuXG5cblxuXG4vKioqKioqKioqKioqKioqKipcbiAqKiBXRUJQQUNLIEZPT1RFUlxuICoqIC4vc3JjL2Vycm9ycy9BdExlYXN0T25lRGF0YVNvdXJjZUVycm9yLmpzXG4gKiogbW9kdWxlIGlkID0gMjFcbiAqKiBtb2R1bGUgY2h1bmtzID0gMFxuICoqLyJdLCJzb3VyY2VSb290IjoiIn0=